*GitHub Repository "NEAR-Analytics/NEAR-ATLAS-VM"*

'''--- CHANGELOG.md ---
# Changelog

## 1.0.0

- BREAKING: Removed Wallet Selector dependency. `selector` object is required to pass into `initNear` from `useInitNear` hook. 

## 0.3.0

- Add support to hashtags for `Markdown` component. Expose `onHashtag` similar to `onMention`.

## 0.2.2

- Await for wallet selector before trying to build a commit message. This fixes an issue when the wallet selector is not ready before the commit message is initialized.

## 0.2.1

- Fixed `Markdown` component not rendering `code` sections when `syntaxHighlighterProps` is not passed.

## 0.2.0

- Added `syntaxHighlighterProps` props to `Markdown` component. This allows to pass props to the syntax highlighter component for `code` sections of the markdown. Allowed properties are `wrapLines`, `lineProps`, `showLineNumbers` and `lineNumberStyle`. 

'''
'''--- config/paths.js ---
const path = require("path");

const srcPath = path.resolve(__dirname, "../src");
const distPath = path.resolve(__dirname, "../dist");
const publicPath = path.resolve(__dirname, "../public");
const nodeModulesPath = path.resolve(__dirname, "../node_modules");

module.exports = {
  srcPath,
  distPath,
  publicPath,
  nodeModulesPath,
};

'''
'''--- config/presets/loadPreset.js ---
const { merge } = require("webpack-merge");

const loadPresets = (env = { presets: [] }) => {
  const presets = env.presets || [];
  /** @type {string[]} */
  const mergedPresets = [].concat(...[presets]);
  const mergedConfigs = mergedPresets.map((presetName) =>
    require(`./webpack.${presetName}.js`)(env)
  );

  return merge({}, ...mergedConfigs);
};
module.exports = loadPresets;

'''
'''--- config/presets/webpack.analyze.js ---
const WebpackBundleAnalyzer =
  require("webpack-bundle-analyzer").BundleAnalyzerPlugin;

module.exports = () => ({
  plugins: [new WebpackBundleAnalyzer()],
});

'''
'''--- config/webpack.development.js ---
const path = require("path");
const { HotModuleReplacementPlugin } = require("webpack");

module.exports = () => ({
  devtool: false,
  entry: {
    main: ['./src/global.css'],
  },
  module: {
    rules: [
      {
        test: /\.(scss|css)$/,
        use: [
          {
            // inject CSS to page
            loader: "style-loader",
          },
          {
            // translates CSS into CommonJS modules
            loader: "css-loader",
          },
          {
            // Run postcss actions
            loader: "postcss-loader",
            options: {
              // `postcssOptions` is needed for postcss 8.x;
              // if you use postcss 7.x skip the key
              postcssOptions: {
                // postcss plugins, can be exported to postcss.config.js
                plugins: function () {
                  return [
                    require("tailwindcss"),
                    require("autoprefixer"),
                  ];
                },
              },
            },
          },
          {
            // compiles Sass to CSS
            loader: "sass-loader",
          },
        ],
      },
    ],
  },
  devServer: {
    open: true,
    static: path.resolve(__dirname, "../dist"),
    port: 3000,
    compress: true,
  },
  plugins: [new HotModuleReplacementPlugin()],
});

'''
'''--- config/webpack.production.js ---
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const path = require("path");

module.exports = () => {
  return {
    // output: {
    //   path: path.resolve(__dirname, "../dist"),
    //   publicPath: "./",
    //   // filename: "[name].[contenthash].bundle.js",
    //   filename: "index.js",
    // },

    devtool: false,

    module: {
      rules: [
        // {
        //   test: /\.(css)$/,
        //   use: [MiniCssExtractPlugin.loader, "css-loader"],
        //   //   options: {
        //   //     sourceMap: false,
        //   //   },
        // },
        {
          test: /\.css$/i,
          use: ['style-loader', 'css-loader', 'postcss-loader'],
        },

        {
          test: /\.(scss|css)$/,
          use: [
            {
              // inject CSS to page
              loader: "style-loader",
            },
            {
              // translates CSS into CommonJS modules
              loader: "css-loader",
            },
            {
              // Run postcss actions
              loader: "postcss-loader",
              options: {
                // `postcssOptions` is needed for postcss 8.x;
                // if you use postcss 7.x skip the key
                postcssOptions: {
                  // postcss plugins, can be exported to postcss.config.js
                  plugins: function () {
                    return [
                      require("tailwindcss"),
                      require("autoprefixer"),
                    ];
                  },
                },
              },
            },
            {
              // compiles Sass to CSS
              loader: "sass-loader",
            },
          ],
        },
      ],
    },
    plugins: [
      new MiniCssExtractPlugin({
        filename: "styles/[name].[contenthash].css",
        chunkFilename: "[id].css",
      }),
    ],
    optimization: {
      minimize: true,
      minimizer: [new CssMinimizerPlugin(), "..."],
      // runtimeChunk: {
      //   name: "runtime",
      // },
    },
    performance: {
      hints: false,
      maxEntrypointSize: 512000,
      maxAssetSize: 512000,
    },
  };
};

'''
'''--- dist/index.js ---
/*! For license information please see index.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(global,(()=>(()=>{var t={663:()=>{},994:()=>{},703:()=>{},300:()=>{},415:(t,e)=>{"use strict";e.byteLength=function(t){var e=c(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){var e,r,i=c(t),a=i[0],u=i[1],l=new o(function(t,e,r){return 3*(e+r)/4-r}(0,a,u)),s=0,f=u>0?a-4:a;for(r=0;r<f;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],l[s++]=e>>16&255,l[s++]=e>>8&255,l[s++]=255&e;return 2===u&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,l[s++]=255&e),1===u&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,l[s++]=e>>8&255,l[s++]=255&e),l},e.fromByteArray=function(t){for(var e,n=t.length,o=n%3,i=[],a=16383,c=0,l=n-o;c<l;c+=a)i.push(u(t,c,c+a>l?l:c+a));return 1===o?(e=t[n-1],i.push(r[e>>2]+r[e<<4&63]+"==")):2===o&&(e=(t[n-2]<<8)+t[n-1],i.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),i.join("")};for(var r=[],n=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0;a<64;++a)r[a]=i[a],n[i.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function u(t,e,n){for(var o,i,a=[],c=e;c<n;c+=3)o=(t[c]<<16&16711680)+(t[c+1]<<8&65280)+(255&t[c+2]),a.push(r[(i=o)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return a.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},872:(t,e,r)=>{"use strict";const n=r(415),o=r(551),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.lW=u,e.h2=50;const a=2147483647;function c(t){if(t>a)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,u.prototype),e}function u(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return f(t)}return l(t,e,r)}function l(t,e,r){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!u.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const r=0|y(t,e);let n=c(r);const o=n.write(t,e);return o!==r&&(n=n.slice(0,o)),n}(t,e);if(ArrayBuffer.isView(t))return function(t){if(Y(t,Uint8Array)){const e=new Uint8Array(t);return p(e.buffer,e.byteOffset,e.byteLength)}return h(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(Y(t,ArrayBuffer)||t&&Y(t.buffer,ArrayBuffer))return p(t,e,r);if("undefined"!=typeof SharedArrayBuffer&&(Y(t,SharedArrayBuffer)||t&&Y(t.buffer,SharedArrayBuffer)))return p(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return u.from(n,e,r);const o=function(t){if(u.isBuffer(t)){const e=0|d(t.length),r=c(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||W(t.length)?c(0):h(t):"Buffer"===t.type&&Array.isArray(t.data)?h(t.data):void 0}(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return u.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function s(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function f(t){return s(t),c(t<0?0:0|d(t))}function h(t){const e=t.length<0?0:0|d(t.length),r=c(e);for(let n=0;n<e;n+=1)r[n]=255&t[n];return r}function p(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),Object.setPrototypeOf(n,u.prototype),n}function d(t){if(t>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|t}function y(t,e){if(u.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||Y(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let o=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return V(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return K(t).length;default:if(o)return n?-1:V(t).length;e=(""+e).toLowerCase(),o=!0}}function m(t,e,r){let n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return N(this,e,r);case"utf8":case"utf-8":return j(this,e,r);case"ascii":return I(this,e,r);case"latin1":case"binary":return L(this,e,r);case"base64":return O(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function v(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function g(t,e,r,n,o){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),W(r=+r)&&(r=o?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(o)return-1;r=t.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:b(t,e,r,n,o);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):b(t,[e],r,n,o);throw new TypeError("val must be string, number or Buffer")}function b(t,e,r,n,o){let i,a=1,c=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,c/=2,u/=2,r/=2}function l(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(o){let n=-1;for(i=r;i<c;i++)if(l(t,i)===l(e,-1===n?0:i-n)){if(-1===n&&(n=i),i-n+1===u)return n*a}else-1!==n&&(i-=i-n),n=-1}else for(r+u>c&&(r=c-u),i=r;i>=0;i--){let r=!0;for(let n=0;n<u;n++)if(l(t,i+n)!==l(e,n)){r=!1;break}if(r)return i}return-1}function w(t,e,r,n){r=Number(r)||0;const o=t.length-r;n?(n=Number(n))>o&&(n=o):n=o;const i=e.length;let a;for(n>i/2&&(n=i/2),a=0;a<n;++a){const n=parseInt(e.substr(2*a,2),16);if(W(n))return a;t[r+a]=n}return a}function E(t,e,r,n){return H(V(e,t.length-r),t,r,n)}function x(t,e,r,n){return H(function(t){const e=[];for(let r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function S(t,e,r,n){return H(K(e),t,r,n)}function k(t,e,r,n){return H(function(t,e){let r,n,o;const i=[];for(let a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,o=r%256,i.push(o),i.push(n);return i}(e,t.length-r),t,r,n)}function O(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function j(t,e,r){r=Math.min(t.length,r);const n=[];let o=e;for(;o<r;){const e=t[o];let i=null,a=e>239?4:e>223?3:e>191?2:1;if(o+a<=r){let r,n,c,u;switch(a){case 1:e<128&&(i=e);break;case 2:r=t[o+1],128==(192&r)&&(u=(31&e)<<6|63&r,u>127&&(i=u));break;case 3:r=t[o+1],n=t[o+2],128==(192&r)&&128==(192&n)&&(u=(15&e)<<12|(63&r)<<6|63&n,u>2047&&(u<55296||u>57343)&&(i=u));break;case 4:r=t[o+1],n=t[o+2],c=t[o+3],128==(192&r)&&128==(192&n)&&128==(192&c)&&(u=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&c,u>65535&&u<1114112&&(i=u))}}null===i?(i=65533,a=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),o+=a}return function(t){const e=t.length;if(e<=A)return String.fromCharCode.apply(String,t);let r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=A));return r}(n)}u.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),u.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(t,e,r){return l(t,e,r)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(t,e,r){return function(t,e,r){return s(t),t<=0?c(t):void 0!==e?"string"==typeof r?c(t).fill(e,r):c(t).fill(e):c(t)}(t,e,r)},u.allocUnsafe=function(t){return f(t)},u.allocUnsafeSlow=function(t){return f(t)},u.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==u.prototype},u.compare=function(t,e){if(Y(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),Y(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let r=t.length,n=e.length;for(let o=0,i=Math.min(r,n);o<i;++o)if(t[o]!==e[o]){r=t[o],n=e[o];break}return r<n?-1:n<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);let r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;const n=u.allocUnsafe(e);let o=0;for(r=0;r<t.length;++r){let e=t[r];if(Y(e,Uint8Array))o+e.length>n.length?(u.isBuffer(e)||(e=u.from(e)),e.copy(n,o)):Uint8Array.prototype.set.call(n,e,o);else{if(!u.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(n,o)}o+=e.length}return n},u.byteLength=y,u.prototype._isBuffer=!0,u.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)v(this,e,e+1);return this},u.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)v(this,e,e+3),v(this,e+1,e+2);return this},u.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)v(this,e,e+7),v(this,e+1,e+6),v(this,e+2,e+5),v(this,e+3,e+4);return this},u.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?j(this,0,t):m.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){let t="";const r=e.h2;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},i&&(u.prototype[i]=u.prototype.inspect),u.prototype.compare=function(t,e,r,n,o){if(Y(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),e<0||r>t.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&e>=r)return 0;if(n>=o)return-1;if(e>=r)return 1;if(this===t)return 0;let i=(o>>>=0)-(n>>>=0),a=(r>>>=0)-(e>>>=0);const c=Math.min(i,a),l=this.slice(n,o),s=t.slice(e,r);for(let t=0;t<c;++t)if(l[t]!==s[t]){i=l[t],a=s[t];break}return i<a?-1:a<i?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return g(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return g(this,t,e,r,!1)},u.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const o=this.length-e;if((void 0===r||r>o)&&(r=o),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let i=!1;for(;;)switch(n){case"hex":return w(this,t,e,r);case"utf8":case"utf-8":return E(this,t,e,r);case"ascii":case"latin1":case"binary":return x(this,t,e,r);case"base64":return S(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const A=4096;function I(t,e,r){let n="";r=Math.min(t.length,r);for(let o=e;o<r;++o)n+=String.fromCharCode(127&t[o]);return n}function L(t,e,r){let n="";r=Math.min(t.length,r);for(let o=e;o<r;++o)n+=String.fromCharCode(t[o]);return n}function N(t,e,r){const n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);let o="";for(let n=e;n<r;++n)o+=X[t[n]];return o}function T(t,e,r){const n=t.slice(e,r);let o="";for(let t=0;t<n.length-1;t+=2)o+=String.fromCharCode(n[t]+256*n[t+1]);return o}function C(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function _(t,e,r,n,o,i){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<i)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function P(t,e,r,n,o){q(e,n,o,t,r,7);let i=Number(e&BigInt(4294967295));t[r++]=i,i>>=8,t[r++]=i,i>>=8,t[r++]=i,i>>=8,t[r++]=i;let a=Number(e>>BigInt(32)&BigInt(4294967295));return t[r++]=a,a>>=8,t[r++]=a,a>>=8,t[r++]=a,a>>=8,t[r++]=a,r}function B(t,e,r,n,o){q(e,n,o,t,r,7);let i=Number(e&BigInt(4294967295));t[r+7]=i,i>>=8,t[r+6]=i,i>>=8,t[r+5]=i,i>>=8,t[r+4]=i;let a=Number(e>>BigInt(32)&BigInt(4294967295));return t[r+3]=a,a>>=8,t[r+2]=a,a>>=8,t[r+1]=a,a>>=8,t[r]=a,r+8}function M(t,e,r,n,o,i){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(t,e,r,n,i){return e=+e,r>>>=0,i||M(t,0,r,4),o.write(t,e,r,n,23,4),r+4}function R(t,e,r,n,i){return e=+e,r>>>=0,i||M(t,0,r,8),o.write(t,e,r,n,52,8),r+8}u.prototype.slice=function(t,e){const r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);const n=this.subarray(t,e);return Object.setPrototypeOf(n,u.prototype),n},u.prototype.readUintLE=u.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);let n=this[t],o=1,i=0;for(;++i<e&&(o*=256);)n+=this[t+i]*o;return n},u.prototype.readUintBE=u.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);let n=this[t+--e],o=1;for(;e>0&&(o*=256);)n+=this[t+--e]*o;return n},u.prototype.readUint8=u.prototype.readUInt8=function(t,e){return t>>>=0,e||C(t,1,this.length),this[t]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(t,e){return t>>>=0,e||C(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(t,e){return t>>>=0,e||C(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(t,e){return t>>>=0,e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(t,e){return t>>>=0,e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readBigUInt64LE=Z((function(t){z(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||J(t,this.length-8);const n=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,o=this[++t]+256*this[++t]+65536*this[++t]+r*2**24;return BigInt(n)+(BigInt(o)<<BigInt(32))})),u.prototype.readBigUInt64BE=Z((function(t){z(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||J(t,this.length-8);const n=e*2**24+65536*this[++t]+256*this[++t]+this[++t],o=this[++t]*2**24+65536*this[++t]+256*this[++t]+r;return(BigInt(n)<<BigInt(32))+BigInt(o)})),u.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);let n=this[t],o=1,i=0;for(;++i<e&&(o*=256);)n+=this[t+i]*o;return o*=128,n>=o&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);let n=e,o=1,i=this[t+--n];for(;n>0&&(o*=256);)i+=this[t+--n]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*e)),i},u.prototype.readInt8=function(t,e){return t>>>=0,e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){t>>>=0,e||C(t,2,this.length);const r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){t>>>=0,e||C(t,2,this.length);const r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return t>>>=0,e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return t>>>=0,e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readBigInt64LE=Z((function(t){z(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||J(t,this.length-8);const n=this[t+4]+256*this[t+5]+65536*this[t+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),u.prototype.readBigInt64BE=Z((function(t){z(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||J(t,this.length-8);const n=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(n)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+r)})),u.prototype.readFloatLE=function(t,e){return t>>>=0,e||C(t,4,this.length),o.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return t>>>=0,e||C(t,4,this.length),o.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return t>>>=0,e||C(t,8,this.length),o.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return t>>>=0,e||C(t,8,this.length),o.read(this,t,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||_(this,t,e,r,Math.pow(2,8*r)-1,0);let o=1,i=0;for(this[e]=255&t;++i<r&&(o*=256);)this[e+i]=t/o&255;return e+r},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||_(this,t,e,r,Math.pow(2,8*r)-1,0);let o=r-1,i=1;for(this[e+o]=255&t;--o>=0&&(i*=256);)this[e+o]=t/i&255;return e+r},u.prototype.writeUint8=u.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,1,255,0),this[e]=255&t,e+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},u.prototype.writeBigUInt64LE=Z((function(t,e=0){return P(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeBigUInt64BE=Z((function(t,e=0){return B(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){const n=Math.pow(2,8*r-1);_(this,t,e,r,n-1,-n)}let o=0,i=1,a=0;for(this[e]=255&t;++o<r&&(i*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+r},u.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){const n=Math.pow(2,8*r-1);_(this,t,e,r,n-1,-n)}let o=r-1,i=1,a=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},u.prototype.writeBigInt64LE=Z((function(t,e=0){return P(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeBigInt64BE=Z((function(t,e=0){return B(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeFloatLE=function(t,e,r){return U(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return U(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return R(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return R(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,n){if(!u.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);const o=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),o},u.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){const e=t.charCodeAt(0);("utf8"===n&&e<128||"latin1"===n)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;let o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{const i=u.isBuffer(t)?t:u.from(t,n),a=i.length;if(0===a)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<r-e;++o)this[o+e]=i[o%a]}return this};const F={};function D(t,e,r){F[t]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function G(t){let e="",r=t.length;const n="-"===t[0]?1:0;for(;r>=n+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function q(t,e,r,n,o,i){if(t>r||t<e){const n="bigint"==typeof e?"n":"";let o;throw o=i>3?0===e||e===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(i+1)}${n}`:`>= -(2${n} ** ${8*(i+1)-1}${n}) and < 2 ** ${8*(i+1)-1}${n}`:`>= ${e}${n} and <= ${r}${n}`,new F.ERR_OUT_OF_RANGE("value",o,t)}!function(t,e,r){z(e,"offset"),void 0!==t[e]&&void 0!==t[e+r]||J(e,t.length-(r+1))}(n,o,i)}function z(t,e){if("number"!=typeof t)throw new F.ERR_INVALID_ARG_TYPE(e,"number",t)}function J(t,e,r){if(Math.floor(t)!==t)throw z(t,r),new F.ERR_OUT_OF_RANGE(r||"offset","an integer",t);if(e<0)throw new F.ERR_BUFFER_OUT_OF_BOUNDS;throw new F.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${e}`,t)}D("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),D("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),D("ERR_OUT_OF_RANGE",(function(t,e,r){let n=`The value of "${t}" is out of range.`,o=r;return Number.isInteger(r)&&Math.abs(r)>2**32?o=G(String(r)):"bigint"==typeof r&&(o=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(o=G(o)),o+="n"),n+=` It must be ${e}. Received ${o}`,n}),RangeError);const $=/[^+/0-9A-Za-z-_]/g;function V(t,e){let r;e=e||1/0;const n=t.length;let o=null;const i=[];for(let a=0;a<n;++a){if(r=t.charCodeAt(a),r>55295&&r<57344){if(!o){if(r>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(e-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((e-=1)<0)break;i.push(r)}else if(r<2048){if((e-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function K(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace($,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function H(t,e,r,n){let o;for(o=0;o<n&&!(o+r>=e.length||o>=t.length);++o)e[o+r]=t[o];return o}function Y(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function W(t){return t!=t}const X=function(){const t="0123456789abcdef",e=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let o=0;o<16;++o)e[n+o]=t[r]+t[o]}return e}();function Z(t){return"undefined"==typeof BigInt?Q:t}function Q(){throw new Error("BigInt not supported")}},551:(t,e)=>{e.read=function(t,e,r,n,o){var i,a,c=8*o-n-1,u=(1<<c)-1,l=u>>1,s=-7,f=r?o-1:0,h=r?-1:1,p=t[e+f];for(f+=h,i=p&(1<<-s)-1,p>>=-s,s+=c;s>0;i=256*i+t[e+f],f+=h,s-=8);for(a=i&(1<<-s)-1,i>>=-s,s+=n;s>0;a=256*a+t[e+f],f+=h,s-=8);if(0===i)i=1-l;else{if(i===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),i-=l}return(p?-1:1)*a*Math.pow(2,i-n)},e.write=function(t,e,r,n,o,i){var a,c,u,l=8*i-o-1,s=(1<<l)-1,f=s>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:i-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,a=s):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=s?(c=0,a=s):a+f>=1?(c=(e*u-1)*Math.pow(2,o),a+=f):(c=e*Math.pow(2,f-1)*Math.pow(2,o),a=0));o>=8;t[r+p]=255&c,p+=d,c/=256,o-=8);for(a=a<<o|c,l+=o;l>0;t[r+p]=255&a,p+=d,a/=256,l-=8);t[r+p-d]|=128*y}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.r(n),r.d(n,{CommitButton:()=>kr,Widget:()=>No,useAccount:()=>Xt,useAccountId:()=>Zt,useCache:()=>hr,useInitNear:()=>Nt,useNear:()=>Tt,utils:()=>t});var t={};r.r(t),r.d(t,{ErrorFallback:()=>I,Loading:()=>A,MaxGasPerTransaction:()=>w,OneNear:()=>O,ReactKey:()=>nt,StorageCostPerByte:()=>E,TGas:()=>b,availableNearBalance:()=>G,bigMax:()=>B,bigMin:()=>P,bigToString:()=>M,computeWritePermission:()=>et,convertToStringLeaves:()=>Y,dateToString:()=>F,deepCopy:()=>it,deepEqual:()=>at,deepFreeze:()=>rt,displayGas:()=>R,displayNear:()=>U,displayTime:()=>D,estimateDataSize:()=>$,extractKeys:()=>V,indexMatch:()=>Q,ipfsUpload:()=>z,ipfsUrl:()=>J,isArray:()=>N,isObject:()=>T,isReactObject:()=>ot,isString:()=>C,isValidAccountId:()=>L,isoDate:()=>q,keysToCamel:()=>_,patternMatch:()=>Z,removeDuplicates:()=>K});const e=require("react");var o=r.n(e);const i=require("react-singleton-hook"),a=require("near-api-js"),c=require("big.js");var u=r.n(c);const l=require("deep-equal");var s=r.n(l),f=r(872).lW;function h(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||y(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||y(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function v(){v=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),c=new A(o||[]);return n(a,"_invoke",{value:S(t,r,c)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function h(){}function d(){}function y(){}var m={};u(m,i,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(I([])));b&&b!==e&&r.call(b,i)&&(m=b);var w=y.prototype=h.prototype=Object.create(m);function E(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function o(n,i,a,c){var u=s(t[n],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==p(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function S(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=k(a,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function k(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=s(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function I(t){if(t||""===t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}throw new TypeError(p(t)+" is not iterable")}return d.prototype=y,n(w,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:d,configurable:!0}),d.displayName=u(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,c,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},E(x.prototype),u(x.prototype,a,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new x(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(w),u(w,c,"Generator"),u(w,i,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=I,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:I(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function g(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}var b=u()(10).pow(12),w=b.mul(250),E=u()(10).pow(19),x=2,S=64,k=/^(([a-z\d]+[-_])*[a-z\d]+\.)*([a-z\d]+[-_])*[a-z\d]+$/,O=u()(10).pow(24),j=O.div(2),A=o().createElement("span",{className:"spinner-border spinner-border-sm text-info me-1",role:"status","aria-hidden":"true"}),I=function(t){var e=t.error;return o().createElement("div",{role:"alert"},o().createElement("p",null,"Something went wrong:"),o().createElement("pre",null,e.message))};function L(t){return t&&t.length>=x&&t.length<=S&&t.match(k)}var N=function(t){return Array.isArray(t)},T=function(t){return t===Object(t)&&!N(t)&&"function"!=typeof t},C=function(t){return"string"==typeof t},_=function t(e){if(T(e)){var r={};return Object.keys(e).forEach((function(n){var o;r[(o=n,o.replace(/([-_][a-z])/gi,(function(t){return t.toUpperCase().replace("-","").replace("_","")})))]=t(e[n])})),r}return N(e)?e.map((function(e){return t(e)})):e},P=function(t,e){return t&&e?t.lt(e)?t:e:t||e},B=function(t,e){return t&&e?t.gt(e)?t:e:t||e},M=function(t,e,r){if(null===t)return"???";var n=t.toFixed(),o=n.indexOf(".");if(e=e||6,r=r||7,o>0){var i=Math.min(e,Math.max(r-o,0));i>0&&(i+=1),o+i<n.length&&(n=n.substring(0,o+i))}else o=n.length;for(var a=o-4;a>=0;a-=3)n=n.slice(0,a+1)+","+n.slice(a+1);return"0.000000"===n&&6===e&&7===r?"<0.000001":n},U=function(t){return t?t.eq(1)?o().createElement(o().Fragment,null,"1 ",o().createElement("span",{className:"text-secondary"},"yoctoNEAR")):o().createElement(o().Fragment,null,M(t.div(O))," ",o().createElement("span",{className:"text-secondary"},"NEAR")):"???"},R=function(t){return t?o().createElement(o().Fragment,null,M(t.div(b))," ",o().createElement("span",{className:"text-secondary"},"TGas")):"???"},F=function(t){return t.toLocaleString("en-us",{day:"numeric",month:"short",year:"numeric"})},D=function(t){return t.toLocaleString()},G=function(t){if(t&&!t.loading&&t.state){var e=u()(t.state.amount).sub(u()(t.state.storage_usage).mul(u()(E)));if(e.gt(j))return e.sub(j)}return u()(0)},q=function(t){return t?new Date(t).toISOString().substring(0,10):""},z=function(){var t,e=(t=v().mark((function t(e){var r;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://ipfs.near.social/add",{method:"POST",headers:{Accept:"application/json"},body:e});case 2:return r=t.sent,t.next=5,r.json();case 5:return t.abrupt("return",t.sent.cid);case 6:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){g(i,n,o,a,c,"next",t)}function c(t){g(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return e.apply(this,arguments)}}(),J=function(t){return"https://ipfs.near.social/ipfs/".concat(t)},$=function t(e,r){return T(e)?Object.entries(e).reduce((function(e,n){var o=d(n,2),i=o[0],a=o[1],c=T(r)?r[i]:void 0;return e+(void 0!==c?t(a,c):2*i.length+t(a,void 0)+140)}),T(r)?0:98):((null==e?void 0:e.length)||8)-(C(r)?r.length:0)},V=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object.entries(e).map((function(e){var n=d(e,2),o=n[0],i=n[1];return T(i)?t(i,"".concat(r).concat(o,"/")):"".concat(r).concat(o)})).flat()},K=function t(e,r){var n=Object.entries(e).reduce((function(e,n){var o=d(n,2),i=o[0],a=o[1],c=T(r)?r[i]:void 0;if(T(a)){var u=T(c)?t(a,c):a;void 0!==u&&(e[i]=u)}else a!==c&&(e[i]=a);return e}),{});return Object.keys(n).length?n:void 0},H=function(t){return C(t)||null===t?t:JSON.stringify(t)},Y=function t(e){return T(e)?Object.entries(e).reduce((function(e,r){var n=d(r,2),o=n[0],i=n[1];return e[H(o)]=t(i),e}),{}):H(e)},W=function t(e,r){var n=r[0],o="**"===n;return o?1===r.length:("*"===n||o?Object.values(e):n in e?[e[n]]:[]).some((function(e){return T(e)?r.length>1?t(e,r.slice(1)):void 0!==e[""]:1===r.length}))},X=function t(e,r){var n=r[0];return("*"===n?Object.values(e):n in e?[e[n]]:[]).some((function(e){return 1===r.length||T(e)&&t(e,r.slice(1))}))},Z=function(t,e,r){var n=e.split("/");return"get"===t?W(r,n):"keys"===t&&X(r,n)},Q=function(t,e,r){return Object.values(r).some((function(r){var n,o=null==r||null===(n=r.index)||void 0===n?void 0:n[t];try{return o&&JSON.stringify(JSON.parse(o).key)===JSON.stringify(e)}catch(t){return!1}}))},tt={graph:!0,post:!0,index:!0,settings:!0},et=function(t,e){var r=T(t)?JSON.parse(JSON.stringify(t)):{};return T(e)&&Object.entries(e).forEach((function(t){var e=d(t,2),n=e[0],o=e[1];if(n in tt)if(T(o)){var i=r[n]=r[n]||{};Object.keys(o).forEach((function(t){i[t]=!0}))}else r[n]=!0;else r[n]=!0})),r},rt=function t(e){return Object.keys(e).forEach((function(r){(function(t,e){return!!Object.getOwnPropertyDescriptor(t,e).get})(e,r)||"object"!==p(e[r])||Object.isFrozen(e[r])||t(e[r])})),Object.freeze(e)},nt="$$typeof",ot=function(t){return null!==t&&"object"===p(t)&&!!t[nt]},it=function t(e){return Array.isArray(e)?e.map((function(e){return t(e)})):e instanceof Map?new Map(h(e.entries()).map((function(e){var r=d(e,2),n=r[0],o=r[1];return[t(n),t(o)]}))):e instanceof Set?new Set(h(e).map((function(e){return t(e)}))):f.isBuffer(e)?f.from(e):e instanceof URL?new URL(e):e instanceof File?new File([e],e.name,{type:e.type}):e instanceof Blob?new Blob([e],{type:e.type}):e instanceof Uint8Array||e instanceof ArrayBuffer?e.slice(0):T(e)?ot(e)?e:Object.fromEntries(Object.entries(e).map((function(e){var r=d(e,2),n=r[0],o=r[1];return[n,t(o)]}))):void 0===e||"function"==typeof e?e:JSON.parse(JSON.stringify(e))},at=s(),ct=r(872).lW;function ut(t){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function lt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return st(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?st(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function st(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ft(){ft=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),c=new O(o||[]);return n(a,"_invoke",{value:E(t,r,c)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function h(){}function p(){}function d(){}var y={};u(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(j([])));v&&v!==e&&r.call(v,i)&&(y=v);var g=d.prototype=h.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=s(t[n],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==ut(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=x(a,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function x(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=s(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function j(t){if(t||""===t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}throw new TypeError(ut(t)+" is not iterable")}return p.prototype=d,n(g,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:p,configurable:!0}),p.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},b(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(g),u(g,c,"Generator"),u(g,i,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=j,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:j(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function ht(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function pt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ht(i,n,o,a,c,"next",t)}function c(t){ht(i,n,o,a,c,"throw",t)}a(void 0)}))}}var dt={networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",archivalNodeUrl:"https://rpc.testnet.internal.near.org",contractName:"v1.social08.testnet",walletUrl:"https://wallet.testnet.near.org",wrapNearAccountId:"wrap.testnet",apiUrl:null,enableWeb4FastRpc:!1},yt={networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",archivalNodeUrl:"https://rpc.mainnet.internal.near.org",contractName:"social.near",walletUrl:"https://wallet.near.org",wrapNearAccountId:"wrap.near",apiUrl:"https://api.near.social",enableWeb4FastRpc:!1},mt={get:!0,keys:!0},vt=function(){var t=pt(ft().mark((function t(e,r,n,o,i){return ft().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.apiUrl&&r in mt){t.next=2;break}return t.abrupt("return",i());case 2:return n=n||{},o&&(n.blockHeight=o),t.prev=4,t.next=7,fetch("".concat(e.apiUrl,"/").concat(r),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 7:return t.next=9,t.sent.json();case 9:return t.abrupt("return",t.sent);case 12:return t.prev=12,t.t0=t.catch(4),console.log("API call failed",r,n),console.error(t.t0),t.abrupt("return",i());case 17:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(e,r,n,o,i){return t.apply(this,arguments)}}();function gt(t,e,r,n,o,i){return bt.apply(this,arguments)}function bt(){return(bt=pt(ft().mark((function t(e,r,n,o,i,a){var c;return ft().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.selector;case 3:return t.next=5,t.sent.wallet();case 5:return c=t.sent,t.next=8,c.signAndSendTransaction({receiverId:r,actions:[{type:"FunctionCall",params:{methodName:n,args:o,gas:null!=i?i:b.mul(30).toFixed(0),deposit:null!=a?a:"0"}}]});case 8:return t.abrupt("return",t.sent);case 11:throw t.prev=11,t.t0=t.catch(0),t.t0;case 14:case"end":return t.stop()}}),t,null,[[0,11]])})))).apply(this,arguments)}function wt(t,e){return Et.apply(this,arguments)}function Et(){return(Et=pt(ft().mark((function t(e,r){var n;return ft().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new a.Account(e.nearConnection.connection,r),t.next=3,n.state();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function xt(t,e){return St.apply(this,arguments)}function St(){return(St=pt(ft().mark((function t(e,r){var n,o,i;return ft().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.selector;case 3:return t.next=5,t.sent.wallet();case 5:return n=t.sent,o=[],i=u()(0),r.forEach((function(t){var e,r=t.contractName,n=t.methodName,a=t.args,c=t.gas,u=t.deposit,l=i.add(c),s={type:"FunctionCall",params:{methodName:n,args:a,gas:c.toFixed(0),deposit:u.toFixed(0)}};(null===(e=o[o.length-1])||void 0===e?void 0:e.receiverId)!==r||l.gt(w)?(o.push({receiverId:r,actions:[]}),i=c):i=l,o[o.length-1].actions.push(s)})),t.next=11,n.signAndSendTransactions({transactions:o});case 11:return t.abrupt("return",t.sent);case 14:throw t.prev=14,t.t0=t.catch(0),t.t0;case 17:case"end":return t.stop()}}),t,null,[[0,14]])})))).apply(this,arguments)}function kt(t,e,r){var n=r.viewMethods,o=void 0===n?[]:n,i=r.changeMethods,a=void 0===i?[]:i,c={near:t,contractId:e};return o.forEach((function(r){c[r]=function(n){return t.viewCall(e,r,n)}})),a.forEach((function(r){c[r]=function(n,o,i){return t.functionCall(e,r,n,o,i)}})),c}function Ot(t,e,r,n,o,i){return jt.apply(this,arguments)}function jt(){return(jt=pt(ft().mark((function t(e,r,n,o,i,a){var c;return ft().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=i||{},t.next=3,e.query({request_type:"call_function",account_id:n,method_name:o,args_base64:ct.from(JSON.stringify(i)).toString("base64"),block_id:r,finality:a});case 3:return c=t.sent,t.abrupt("return",c.result&&c.result.length>0&&JSON.parse(ct.from(c.result).toString()));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function At(t,e,r,n){return It.apply(this,arguments)}function It(){return(It=pt(ft().mark((function t(e,r,n,o){var i;return ft().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=n||{},i=new URL("https://rpc.web4.near.page/account/".concat(e,"/view/").concat(r)),Object.entries(n).forEach((function(t){var e=lt(t,2),r=e[0],n=e[1];void 0!==n&&i.searchParams.append("".concat(r,".json"),JSON.stringify(n))})),t.prev=3,t.next=6,fetch(i.toString());case 6:return t.next=8,t.sent.json();case 8:return t.abrupt("return",t.sent);case 11:return t.prev=11,t.t0=t.catch(3),console.log("Web4 view call failed",i.toString()),console.error(t.t0),t.abrupt("return",o());case 16:case"end":return t.stop()}}),t,null,[[3,11]])})))).apply(this,arguments)}function Lt(){return Lt=pt(ft().mark((function t(){var e,r,n,o,i,c,u,l,s,f=arguments;return ft().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(r=f.length>0&&void 0!==f[0]?f[0]:{}).networkId,o=r.config,i=r.keyStore,c=r.selector,o||(o={},n||(o.networkId="mainnet")),n&&!o.networkId&&(o.networkId=n),"mainnet"===o.networkId?o=Object.assign({},o,yt):"testnet"===o.networkId&&(o=Object.assign({},o,dt)),i=null!==(e=i)&&void 0!==e?e:new a.keyStores.BrowserLocalStorageKeyStore,t.next=7,a.connect(Object.assign({deps:{keyStore:i}},o));case 7:return u=t.sent,(l={config:o,selector:c,keyStore:i,nearConnection:u}).nearArchivalConnection=a.Connection.fromConfig({networkId:o.networkId,provider:{type:"JsonRpcProvider",args:{url:o.archivalNodeUrl}},signer:{type:"InMemorySigner",keyStore:i}}),s=function(t){return"optimistic"===t||"final"===t?{finality:t,blockId:void 0}:null!=t?{finality:void 0,blockId:parseInt(t)}:{finality:"optimistic",blockId:void 0}},l.viewCall=function(t,e,r,n){var i=s(n),a=i.blockId,c=i.finality,u=function(){return Ot(a?l.nearArchivalConnection.provider:l.nearConnection.connection.provider,null!=a?a:void 0,t,e,r,c)},f=function(){return"optimistic"===c&&o.enableWeb4FastRpc?At(t,e,r,u):u()};return t!==o.contractName||!a&&"final"!==c?f():vt(o,e,r,a,f)},l.block=function(t){var e=s(t);return(e.blockId?l.nearArchivalConnection.provider:l.nearConnection.connection.provider).block(e)},l.functionCall=function(t,e,r,n,o){return gt(l,t,e,r,n,o)},l.sendTransactions=function(t){return xt(l,t)},l.contract=kt(l,o.contractName,{viewMethods:["storage_balance_of","get","get_num_accounts","get_accounts_paged","is_write_permission_granted","keys"],changeMethods:["set","grant_write_permission","storage_deposit","storage_withdraw"]}),l.accountState=function(t){return wt(l,t)},t.abrupt("return",l);case 18:case"end":return t.stop()}}),t)}))),Lt.apply(this,arguments)}var Nt=(0,i.singletonHook)({},(function(){var t=lt((0,e.useState)(null),2),r=t[0],n=t[1];return{nearPromise:r,initNear:(0,e.useMemo)((function(){return function(t){return n(function(){return Lt.apply(this,arguments)}(t))}}),[])}})),Tt=(0,i.singletonHook)(null,(function(){var t=lt((0,e.useState)(null),2),r=t[0],n=t[1],o=Nt().nearPromise;return(0,e.useEffect)((function(){o&&o.then(n)}),[o]),r}));const Ct=require("local-storage");var _t,Pt,Bt,Mt,Ut=r.n(Ct);function Rt(t){return Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rt(t)}function Ft(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Dt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Dt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Gt(){Gt=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),c=new O(o||[]);return n(a,"_invoke",{value:E(t,r,c)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function h(){}function p(){}function d(){}var y={};u(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(j([])));v&&v!==e&&r.call(v,i)&&(y=v);var g=d.prototype=h.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=s(t[n],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Rt(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=x(a,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function x(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=s(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function j(t){if(t||""===t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}throw new TypeError(Rt(t)+" is not iterable")}return p.prototype=d,n(g,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:p,configurable:!0}),p.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},b(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(g),u(g,c,"Generator"),u(g,i,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=j,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:j(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function qt(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function zt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){qt(i,n,o,a,c,"next",t)}function c(t){qt(i,n,o,a,c,"throw",t)}a(void 0)}))}}var Jt="near-social-vm:v01:",$t=Jt+":accountId:",Vt=Jt+":pretendAccountId:",Kt={loading:!0,signedAccountId:null!==(_t=Ut().get($t))&&void 0!==_t?_t:void 0,pretendAccountId:null!==(Pt=Ut().get(Vt))&&void 0!==Pt?Pt:void 0,accountId:null!==(Bt=null!==(Mt=Ut().get(Vt))&&void 0!==Mt?Mt:Ut().get($t))&&void 0!==Bt?Bt:void 0,state:null,near:null};function Ht(t,e){return Yt.apply(this,arguments)}function Yt(){return(Yt=zt(Gt().mark((function t(e,r){var n,o,i,c,u,l,s,f,h,p,d;return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.connectedContractId=null===(n=r)||void 0===n||null===(o=n.contract)||void 0===o?void 0:o.contractId,!e.connectedContractId||e.connectedContractId===e.config.contractName){t.next=12;break}return t.next=4,e.selector;case 4:return s=t.sent,t.next=7,s.wallet();case 7:return f=t.sent,t.next=10,f.signOut();case 10:e.connectedContractId=null,r=s.store.getState();case 12:if(e.accountId=null!==(i=null===(c=r)||void 0===c||null===(u=c.accounts)||void 0===u||null===(l=u[0])||void 0===l?void 0:l.accountId)&&void 0!==i?i:null,e.accountId){e.publicKey=null;try{"here-wallet"===(null===(h=r)||void 0===h?void 0:h.selectedWalletId)&&(p=Ut().get("herewallet:keystore"),e.publicKey=a.KeyPair.fromString(p[e.config.networkId].accounts[e.accountId]).getPublicKey())}catch(t){console.error(t)}if(!e.publicKey)try{e.publicKey=a.KeyPair.fromString(Ut().get("meteor-wallet"===(null===(d=r)||void 0===d?void 0:d.selectedWalletId)?"_meteor_wallet".concat(e.accountId,":").concat(e.config.networkId):"near-api-js:keystore:".concat(e.accountId,":").concat(e.config.networkId))).getPublicKey()}catch(t){console.error(t)}}case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Wt=function(){var t=zt(Gt().mark((function t(e,r){var n,o,i,a,c,u,l,s;return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((o=e.accountId)?Ut().set($t,o):Ut().remove($t),i=null!==(n=Ut().get(Vt))&&void 0!==n?n:void 0,a={loading:!1,signedAccountId:o,pretendAccountId:i,accountId:null!=i?i:o,state:null,near:e,refresh:function(){var t=zt(Gt().mark((function t(){return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Wt(e,r);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),startPretending:function(){var t=zt(Gt().mark((function t(n){return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n?Ut().set(Vt,n):Ut().remove(Vt),t.next=3,Wt(e,r);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},!o){t.next=13;break}return t.next=7,Promise.all([e.contract.storage_balance_of({account_id:o}),e.accountState(o)]);case 7:c=t.sent,u=Ft(c,2),l=u[0],s=u[1],a.storageBalance=l,a.state=s;case 13:r(a);case 14:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),Xt=(0,i.singletonHook)(Kt,(function(){var t=Ft((0,e.useState)(Kt),2),r=t[0],n=t[1],o=Tt();return(0,e.useEffect)((function(){o&&o.selector.then((function(t){t.store.observable.subscribe(function(){var t=zt(Gt().mark((function t(e){return Gt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ht(o,e);case 2:return t.prev=2,t.next=5,Wt(o,n);case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(2),console.error(t.t0);case 10:case"end":return t.stop()}}),t,null,[[2,7]])})));return function(e){return t.apply(this,arguments)}}())}))}),[o]),r})),Zt=function(){return Xt().accountId};const Qt=require("acorn"),te=require("acorn-jsx");var ee=r.n(te);const re=require("react-bootstrap/Modal");var ne=r.n(re);const oe=require("remark-gfm");var ie=r.n(oe);const ae=require("react-markdown");var ce=r.n(ae);const ue=require("react-syntax-highlighter"),le=require("react-syntax-highlighter/dist/esm/styles/prism"),se=require("mdast-util-find-and-replace");var fe=/@((?:(?:[a-z\d]+[-_])*[a-z\d]+\.)*(?:[a-z\d]+[-_])*[a-z\d]+)/gi;function he(){function t(t,e,r){if(/[\w`]/.test(r.input.charAt(r.index-1))||/[/\w`]/.test(r.input.charAt(r.index+t.length))||e.length<2||e.length>64)return!1;var n={type:"text",value:t};return{type:"strong",children:[n],data:{hProperties:{accountId:e}}}}return function(e){return(0,se.findAndReplace)(e,fe,t),e}}var pe=/#(\w+)/gi;function de(){function t(t,e,r){if(/[\w`]/.test(r.input.charAt(r.index-1))||/[/\w`]/.test(r.input.charAt(r.index+t.length)))return!1;var n={type:"text",value:t};return{type:"strong",children:[n],data:{hProperties:{hashtag:e}}}}return function(e){return(0,se.findAndReplace)(e,pe,t),e}}var ye=["onLinkClick","text","onMention","onHashtag","syntaxHighlighterProps"],me=["node","children"],ve=["node"],ge=["node"],be=["node"],we=["node"],Ee=["node","inline","className","children"];function xe(){return xe=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},xe.apply(this,arguments)}function Se(t,e){if(null==t)return{};var r,n,o=function(t,e){if(null==t)return{};var r,n,o={},i=Object.keys(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||(o[r]=t[r]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}var ke=function(t){var e=t.onLinkClick,r=t.text,n=t.onMention,i=t.onHashtag,a=t.syntaxHighlighterProps,c=Se(t,ye);return o().createElement(ce(),xe({},c,{plugins:[],rehypePlugins:[],remarkPlugins:[ie(),he,de],children:r,components:{strong:function(t){var e,r,a,c,u=t.node,l=t.children,s=Se(t,me);return n&&null!==(e=u.properties)&&void 0!==e&&e.accountId?n(null===(a=u.properties)||void 0===a?void 0:a.accountId):i&&null!==(r=u.properties)&&void 0!==r&&r.hashtag?i(null===(c=u.properties)||void 0===c?void 0:c.hashtag):o().createElement("strong",s,l)},a:function(t){t.node;var r=Se(t,ve);return e?o().createElement("a",xe({onClick:e},r)):o().createElement("a",xe({target:"_blank"},r))},img:function(t){t.node;var e=Se(t,ge);return o().createElement("img",xe({className:"img-fluid"},e))},blockquote:function(t){t.node;var e=Se(t,be);return o().createElement("blockquote",xe({className:"blockquote"},e))},table:function(t){t.node;var e=Se(t,we);return o().createElement("table",xe({className:"table table-striped"},e))},code:function(t){t.node;var e=t.inline,r=t.className,n=t.children,i=Se(t,Ee),c=/language-(\w+)/.exec(r||""),u=null!=a?a:{},l=u.wrapLines,s=u.lineProps,f=u.showLineNumbers,h=u.lineNumberStyle;return!e&&c?o().createElement(ue.Prism,xe({children:String(n).replace(/\n$/,""),style:le.tomorrow,language:c[1],PreTag:"div",wrapLines:l,lineProps:s,showLineNumbers:f,lineNumberStyle:h},i)):o().createElement("code",xe({className:r},i),n)}}}))};const Oe=require("react-uuid");var je=r.n(Oe);function Ae(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Ie=function(t){var e=JSON.stringify(t,null,2);return"```json\n".concat(e,"\n```")};function Le(t){var r,n,i=(0,e.useState)(je()()),a=Tt(),c=(r=(0,e.useState)(!1),n=2,function(t){if(Array.isArray(t))return t}(r)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(r,n)||function(t,e){if(t){if("string"==typeof t)return Ae(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ae(t,e):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=c[0],l=c[1],s=t.onHide,f=t.transactions,h=!!f;return o().createElement(ne(),{size:"xl",centered:!0,scrollable:!0,show:h,onHide:s},o().createElement(ne().Header,{closeButton:!0},o().createElement(ne().Title,null,"Confirm Transaction")),o().createElement(ne().Body,null,f&&f.map((function(t,e){return o().createElement("div",{key:"".concat(i,"-").concat(e)},o().createElement("div",null,o().createElement("h4",null,"Transaction #",e+1)),o().createElement("div",null,o().createElement("span",{className:"text-secondary"},"Contract ID: "),o().createElement("span",{className:"font-monospace"},t.contractName)),o().createElement("div",null,o().createElement("span",{className:"text-secondary"},"Method name: "),o().createElement("span",{className:"font-monospace"},t.methodName)),t.deposit&&t.deposit.gt(0)&&o().createElement("div",null,o().createElement("span",{className:"text-secondary"},"Deposit: "),o().createElement("span",{className:"font-monospace"},U(t.deposit))),o().createElement("div",null,o().createElement("span",{className:"text-secondary"},"Gas: "),o().createElement("span",{className:"font-monospace"},R(t.gas))),o().createElement(ke,{text:Ie(t.args)}))}))),o().createElement(ne().Footer,null,o().createElement("button",{className:"btn btn-success",disabled:u,onClick:function(t){t.preventDefault(),l(!0),a.sendTransactions(f).then((function(){l(!1),s()}))}},u&&A," Confirm"),o().createElement("button",{className:"btn btn-secondary",onClick:s,disabled:u},"Close")))}const Ne=require("react-files");var Te=r.n(Ne);const Ce=require("@braintree/sanitize-url"),_e=require("react-infinite-scroller");var Pe=r.n(_e);function Be(t){return Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Be(t)}function Me(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ue(){Ue=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),c=new O(o||[]);return n(a,"_invoke",{value:E(t,r,c)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function h(){}function p(){}function d(){}var y={};u(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(j([])));v&&v!==e&&r.call(v,i)&&(y=v);var g=d.prototype=h.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=s(t[n],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Be(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=x(a,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function x(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=s(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function j(t){if(t||""===t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}throw new TypeError(Be(t)+" is not iterable")}return p.prototype=d,n(g,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:p,configurable:!0}),p.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},b(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(g),u(g,c,"Generator"),u(g,i,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=j,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:j(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function Re(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Fe(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Re(i,n,o,a,c,"next",t)}function c(t){Re(i,n,o,a,c,"throw",t)}a(void 0)}))}}var De=E.mul(2e3),Ge=E.mul(500),qe=E.mul(500),ze=E.mul(500),Je=function(){var t=Fe(Ue().mark((function t(e,r){var n;return Ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=V(r),t.next=3,e.contract.get({keys:n});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),$e=function(){var t=Fe(Ue().mark((function t(e,r,n,o){var i,a,c,l,s,f,h,p,d,y;return Ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.selector;case 2:if(i=e.accountId){t.next=6;break}return alert("You're not logged in. Sign in to commit data."),t.abrupt("return");case 6:return t.next=8,Promise.all([e.viewCall(e.config.contractName,"storage_balance_of",{account_id:i}),i!==r?e.viewCall(e.config.contractName,"is_write_permission_granted",{predecessor_id:i,key:r}):e.publicKey?e.viewCall(e.config.contractName,"is_write_permission_granted",{public_key:e.publicKey.toString(),key:r}):Promise.resolve(!1)]);case 8:if(a=t.sent,w=2,c=function(t){if(Array.isArray(t))return t}(b=a)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(b,w)||function(t,e){if(t){if("string"==typeof t)return Me(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Me(t,e):void 0}}(b,w)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),l=c[0],s=c[1],f=u()((null==l?void 0:l.available)||"0"),m={},v=r,g=Y(n),(v=function(t){var e=function(t,e){if("object"!==Be(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Be(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Be(e)?e:String(e)}(v))in m?Object.defineProperty(m,v,{value:g,enumerable:!0,configurable:!0,writable:!0}):m[v]=g,h=m,p={},o){t.next=20;break}return t.next=18,Je(e,h);case 18:p=t.sent,h=K(h,p);case 20:return d=E.mul($(h,p)).add(l?u()(0):Ge).add(s?u()(0):ze).add(qe),y=B(d.sub(f),s?u()(0):l?u()(1):De),t.abrupt("return",{originalData:n,accountId:r,storageBalance:l,availableStorage:f,currentData:p,data:h,expectedDataBalance:d,deposit:y,permissionGranted:s});case 23:case"end":return t.stop()}var m,v,g,b,w}),t)})));return function(e,r,n,o){return t.apply(this,arguments)}}(),Ve=function(){var t=Fe(Ue().mark((function t(e,r,n){return Ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Committing data",r),t.next=3,e.contract.set({data:r},b.mul(100).toFixed(0),n.toFixed(0));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}(),Ke=function(){var t=Fe(Ue().mark((function t(e,r,n){var o,i;return Ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.selector;case 2:return t.next=4,t.sent.wallet();case 4:return o=t.sent,i=[],e.publicKey&&(i.push({type:"FunctionCall",params:{methodName:"grant_write_permission",args:{public_key:e.publicKey.toString(),keys:[e.accountId]},gas:b.mul(100).toFixed(0),deposit:n.gt(0)?n.toFixed(0):"1"}}),n=u()(0)),i.push({type:"FunctionCall",params:{methodName:"set",args:{data:r},gas:b.mul(100).toFixed(0),deposit:n.gt(0)?n.toFixed(0):"1"}}),t.next=10,o.signAndSendTransaction({receiverId:e.config.contractName,actions:i});case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}();const He=require("react-bootstrap"),Ye=require("idb");function We(t){return We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},We(t)}function Xe(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ze(){Ze=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),c=new O(o||[]);return n(a,"_invoke",{value:E(t,r,c)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function h(){}function p(){}function d(){}var y={};u(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(j([])));v&&v!==e&&r.call(v,i)&&(y=v);var g=d.prototype=h.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=s(t[n],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==We(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=x(a,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function x(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=s(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function j(t){if(t||""===t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}throw new TypeError(We(t)+" is not iterable")}return p.prototype=d,n(g,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:p,configurable:!0}),p.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},b(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(g),u(g,c,"Generator"),u(g,i,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=j,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:j(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function Qe(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function tr(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Qe(i,n,o,a,c,"next",t)}function c(t){Qe(i,n,o,a,c,"throw",t)}a(void 0)}))}}function er(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==We(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==We(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===We(o)?o:String(o)),n)}var o}var rr="ViewCall",nr="Fetch",or="LocalStorage",ir="NotStarted",ar="InProgress",cr="Done",ur="Invalidated",lr="cache-v1",sr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.dbPromise=(0,Ye.openDB)("cacheDb",1,{upgrade:function(t){t.createObjectStore(lr)}}),this.cache={},this.finalSynchronizationDelayMs=e}var e,r,n,o,i;return e=t,r=[{key:"invalidateCallbacks",value:function(t,e){var r;if(null!==(r=t.invalidationCallbacks)&&void 0!==r&&r.length){var n=t.invalidationCallbacks;t.invalidationCallbacks=[],setTimeout((function(){n.forEach((function(t){try{t()}catch(t){}}))}),e?this.finalSynchronizationDelayMs+50:50)}}},{key:"innerGet",value:(i=tr(Ze().mark((function t(e){return Ze().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.dbPromise;case 2:return t.abrupt("return",t.sent.get(lr,e));case 3:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"innerSet",value:(o=tr(Ze().mark((function t(e,r){return Ze().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.dbPromise;case 2:return t.abrupt("return",t.sent.put(lr,r,e));case 3:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"cachedPromise",value:function(t,e,r,n){var o=this;t=JSON.stringify(t);var i=this.cache[t]||{status:ir,invalidationCallbacks:[],result:null,time:(new Date).getTime()};return this.cache[t]=i,T(r)||(r={onInvalidate:r}),r.onInvalidate&&i.invalidationCallbacks.push(r.onInvalidate),!i.subscription&&r.subscribe&&function t(){i.subscription=setTimeout((function(){document.hidden?t():(i.subscription=null,i.status=ur,o.invalidateCallbacks(i,!1))}),5e3)}(),i.status===ar||i.status===cr&&i.time+3e5>(new Date).getTime()||(i.status===ir&&this.innerGet(t).then((function(t){(t||n)&&i.status===ar&&(i.result=t,i.time=(new Date).getTime(),o.invalidateCallbacks(i,!1))})),i.status=ar,e&&e().then((function(e){i.status=cr,i.time=(new Date).getTime(),JSON.stringify(e)!==JSON.stringify(i.result)&&(i.result=e,o.innerSet(t,e),o.invalidateCallbacks(i,!1))})).catch((function(e){console.error(e),i.status=cr;var r=void 0;i.time=(new Date).getTime(),JSON.stringify(r)!==JSON.stringify(i.result)&&(i.result=r,o.innerSet(t,r),o.invalidateCallbacks(i,!1))}))),i.result}},{key:"invalidateCache",value:function(t,e){var r=this,n=[],o="".concat(t.config.apiUrl,"/index");Object.keys(this.cache).forEach((function(r){var i;try{i=JSON.parse(r)}catch(t){return void console.error("Key deserialization failed",r)}if(i.action===rr&&i.contractId===t.config.contractName&&(!i.blockId||"optimistic"===i.blockId||"final"===i.blockId))try{var a;(null===(a=i.args)||void 0===a?void 0:a.keys).some((function(t){return Z(i.methodName,t,e)}))&&n.push([r,"final"===i.blockId])}catch(t){}if(i.action===nr&&i.url===o)try{var c,u=JSON.parse(null===(c=i.options)||void 0===c?void 0:c.body),l=u.action,s=u.key;l&&s&&Q(l,s,e)&&n.push([r,!0])}catch(t){}})),console.log("Cache invalidation",n),n.forEach((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(e,n)||function(t,e){if(t){if("string"==typeof t)return Xe(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Xe(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1],c=r.cache[i];c.status=ur,r.invalidateCallbacks(c,a)}))}},{key:"cachedBlock",value:function(t,e,r){return this.cachedPromise({action:"Block",blockId:e},(function(){return t.block(e)}),r)}},{key:"cachedViewCall",value:function(t,e,r,n,o,i){return this.cachedPromise({action:rr,contractId:e,methodName:r,args:n,blockId:o},(function(){return t.viewCall(e,r,n,o)}),i)}},{key:"asyncFetch",value:(n=tr(Ze().mark((function t(e,r){var n,o,i,a,c,u,l,s,f,h,p;return Ze().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=null===(n=r)||void 0===n||null===(o=n.responseType)||void 0===o?void 0:o.toLowerCase(),r={method:null===(i=r)||void 0===i?void 0:i.method,headers:null===(a=r)||void 0===a?void 0:a.headers,body:null===(c=r)||void 0===c?void 0:c.body},t.prev=2,t.next=5,fetch(e,r);case 5:if(l=t.sent,s=l.status,f=l.ok,h=l.headers.get("content-type"),!f){t.next=15;break}return t.next=12,"arraybuffer"===u?l.arrayBuffer():"blob"===u?l.blob():"formdata"===u?l.formData():"json"===u?l.json():"text"===u?l.text():h&&-1!==h.indexOf("application/json")?l.json():l.text();case 12:t.t0=t.sent,t.next=16;break;case 15:t.t0=void 0;case 16:return p=t.t0,t.abrupt("return",{ok:f,status:s,contentType:h,body:p});case 20:return t.prev=20,t.t1=t.catch(2),t.abrupt("return",{ok:!1,error:t.t1.message});case 23:case"end":return t.stop()}}),t,null,[[2,20]])}))),function(t,e){return n.apply(this,arguments)})},{key:"cachedFetch",value:function(t,e,r){var n=this;return this.cachedPromise({action:nr,url:t,options:e},(function(){return n.asyncFetch(t,e)}),r)}},{key:"cachedCustomPromise",value:function(t,e,r){return this.cachedPromise({action:"CustomPromise",key:t},(function(){return e()}),r)}},{key:"socialGet",value:function(t,e,r,n,o,i){if(!t)return null;var a={keys:e=(e=Array.isArray(e)?e:[e]).map((function(t){return r?"".concat(t,"/**"):"".concat(t)})),options:o},c=this.cachedViewCall(t,t.config.contractName,"get",a,n,i);if(null===c)return null;if(1===e.length)for(var u=e[0].split("/"),l=0;l<u.length;l++){var s,f=u[l];if("*"===f||"**"===f)break;c=null===(s=c)||void 0===s?void 0:s[f]}return c}},{key:"socialIndex",value:function(t,e,r,n,o){var i=this.cachedFetch("".concat(t.config.apiUrl,"/index"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e,key:r,options:n})},o);return null!=i&&i.ok?i.body:null}},{key:"localStorageGet",value:function(t,e,r){return this.cachedPromise({action:or,domain:t,key:e},void 0,r,!0)}},{key:"asyncLocalStorageGet",value:function(t,e){return e=JSON.stringify({action:or,domain:t,key:e}),this.innerGet(e)}},{key:"localStorageSet",value:function(t,e,r){e=JSON.stringify({action:or,domain:t,key:e});var n=this.cache[e]||{status:ir,invalidationCallbacks:[],result:null,time:(new Date).getTime()};this.cache[e]=n,n.status=cr,JSON.stringify(r)!==JSON.stringify(n.result)&&(n.result=r,this.innerSet(e,r),this.invalidateCallbacks(n,!1))}}],r&&er(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),fr=new sr,hr=(0,i.singletonHook)(fr,(function(){return fr}));function pr(t){return pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pr(t)}var dr=["data","children","onClick","onCommit","onCancel","disabled","widgetSrc","force"];function yr(){return yr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},yr.apply(this,arguments)}function mr(){mr=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),c=new O(o||[]);return n(a,"_invoke",{value:E(t,r,c)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function h(){}function p(){}function d(){}var y={};u(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(j([])));v&&v!==e&&r.call(v,i)&&(y=v);var g=d.prototype=h.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=s(t[n],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==pr(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=x(a,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function x(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=s(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function j(t){if(t||""===t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}throw new TypeError(pr(t)+" is not iterable")}return p.prototype=d,n(g,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:p,configurable:!0}),p.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},b(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(g),u(g,c,"Generator"),u(g,i,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=j,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:j(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function vr(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function gr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return br(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?br(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function br(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var wr=function(t){var e=JSON.stringify(t,null,2);return"```json\n".concat(e,"\n```")},Er={page:"commit"},xr="write_permission",Sr=function(t){var r,n=Tt(),i=Zt(),a=hr(),c=gr((0,e.useState)(!1),2),u=c[0],l=c[1],s=gr((0,e.useState)(0),2),f=s[0],h=s[1],p=gr((0,e.useState)(!1),2),d=p[0],y=p[1],m=gr((0,e.useState)(null),2),v=m[0],g=m[1],b=gr((0,e.useState)(null),2),w=b[0],x=b[1],S=gr((0,e.useState)(null),2),k=S[0],O=S[1],j=gr((0,e.useState)(!0),2),I=j[0],L=j[1],N=t.show,T=t.onHide,C=function(){if(t.onCancel)try{t.onCancel()}catch(t){console.error(t)}T()},_=t.data,P=t.force,B=t.widgetSrc;(0,e.useEffect)((function(){B?(O(null),a.asyncLocalStorageGet(Er,{widgetSrc:B,accountId:i,type:xr}).then((function(t){return O(t)}))):O(!1)}),[B,i,a,N]),(0,e.useEffect)((function(){L(!1!==k)}),[k]),(0,e.useEffect)((function(){if(!d&&N&&i&&n){var t=JSON.stringify(null!=_?_:null);(P||t!==v)&&(g(t),x(null),$e(n,i,_,P).then(x))}}),[d,_,v,P,n,i,N]);var M=function(){var e,r=(e=mr().mark((function e(){var r,o;return mr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y(!0),r=I&&et(k,w.data[i]),a.localStorageSet(Er,{widgetSrc:B,accountId:i,type:xr},r),O(r),o=w.deposit.add(E.mul(f)),!w.permissionGranted){e.next=10;break}return e.next=8,Ve(n,w.data,o);case 8:e.next=16;break;case 10:if(i!==n.accountId){e.next=15;break}return e.next=13,Ke(n,w.data,o);case 13:e.next=16;break;case 15:alert("No permission to commit under given account");case 16:if(x(null),g(null),t.onCommit)try{t.onCommit(w.data)}catch(t){console.error(t)}a.invalidateCache(n,w.data),T(),y(!1);case 22:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(t){vr(i,n,o,a,c,"next",t)}function c(t){vr(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(){return r.apply(this,arguments)}}(),R=w&&!w.permissionGranted&&i!==n.accountId;return!d&&!R&&!u&&w&&N&&k&&w.data&&w.deposit.add(E.mul(f)).eq(0)&&w.permissionGranted&&JSON.stringify(et(k,w.data[i]))===JSON.stringify(k)&&(l(!0),M().then((function(){return l(!1)}))),w&&N&&!u&&null!==k?o().createElement("div",{className:"fixed top-0 left-0 w-full h-full flex justify-center items-center z-40"},o().createElement("div",{className:"bg-white rounded-lg overflow-y-auto max-h-full w-3/4 z-50"},o().createElement("div",{className:"flex justify-between items-center p-4 border-b border-gray-200"},o().createElement("h5",{className:"text-lg font-medium"},"Saving data"),o().createElement("button",{onClick:C,className:"text-gray-500 hover:text-gray-700 focus:outline-none"},"")),o().createElement("div",{className:"p-4"},R?o().createElement("div",null,o().createElement("h5",null,"Can't commit, because the account ",n.accountId," doesn't have permission to write under pretended account ",i)):w?o().createElement("div",null,o().createElement("div",null,w.data?o().createElement(ke,{text:wr(w.data)}):o().createElement("h5",null,"No new data to save")),w.data&&(null==w||null===(r=w.deposit)||void 0===r?void 0:r.gt(0))&&o().createElement("div",null,o().createElement("h6",null,"Required storage deposit"," ",o().createElement("small",{className:"text-secondary"},"(can be recovered later)")),o().createElement("div",{className:"mb-2"},w.deposit.div(E).toFixed(0)," bytes ="," ",U(w.deposit)),o().createElement("h6",null,"Optional storage deposit"," ",o().createElement("small",{className:"text-secondary"},"(can be used to avoid future wallet TX confirmation)")),o().createElement("div",null,o().createElement(He.ToggleButtonGroup,{type:"radio",name:"storageDeposit",value:f,onChange:h,disabled:d},o().createElement(He.ToggleButton,{id:"esd-0",variant:"outline-success",value:0},"No Deposit"),o().createElement(He.ToggleButton,{id:"esd-5000",variant:"outline-success",value:5e3},"0.05 NEAR (5Kb)"),o().createElement(He.ToggleButton,{id:"esd-20000",variant:"outline-success",value:2e4},"0.2 NEAR (20Kb)"),o().createElement(He.ToggleButton,{id:"esd-100000",variant:"outline-success",value:1e5},"1 NEAR (100Kb)")))),!R&&B&&w.data&&o().createElement("div",{className:"form-check form-switch"},o().createElement("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"dont-ask-for-widget",checked:I,onChange:function(t){L(t.target.checked)}}),o().createElement("label",{className:"form-check-label",htmlFor:"dont-ask-for-widget"},"Don't ask again for saving similar data by"," ",o().createElement("span",{className:"font-monospace"},B)))):A),o().createElement("div",{className:"flex justify-between p-4 border-t border-gray-200"},o().createElement("button",{className:"px-4 py-2 rounded-md text-white bg-green-500 hover:bg-green-600",disabled:!(null!=w&&w.data)||d||R,onClick:function(t){t.preventDefault(),M()}},d?"Loading...":"Save Data"),o().createElement("button",{className:"px-4 py-2 rounded-md text-gray-500 border border-gray-300 hover:bg-gray-100",onClick:C,disabled:d},"Close"))),o().createElement("div",{className:"fixed top-0 left-0 w-full h-full bg-black opacity-50 z-30",onClick:C})):null},kr=function(t){var r=Zt(),n=t.data,i=t.children,a=t.onClick,c=t.onCommit,u=t.onCancel,l=t.disabled,s=t.widgetSrc,f=t.force,h=function(t,e){if(null==t)return{};var r,n,o=function(t,e){if(null==t)return{};var r,n,o={},i=Object.keys(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||(o[r]=t[r]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}(t,dr),p=gr((0,e.useState)(null),2),d=p[0],y=p[1];return o().createElement(o().Fragment,null,o().createElement("button",yr({},h,{className:"px-4 py-2 ".concat(l||!n||d||!r?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 text-white"," rounded-md"),onClick:function(t){t.preventDefault(),y("function"==typeof n?n():n),a&&a()}}),d?"Loading...":i),o().createElement(Sr,{show:!!d,widgetSrc:s,data:d,force:f,onHide:function(){return y(null)},onCancel:u,onCommit:c}))};const Or=require("react-bootstrap-typeahead"),jr=require("styled-components");var Ar=r.n(jr);const Ir=require("elliptic"),Lr=require("bn.js");var Nr=r.n(Lr);const Tr=require("tweetnacl");function Cr(){return Cr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Cr.apply(this,arguments)}function _r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Pr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Pr(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Br(t){var r=t.className,n=t.style,i=t.src,a=t.srcDoc,c=t.title,u=t.message,l=t.onMessage,s={className:r,style:n,src:i,srcDoc:a,title:c},f=_r((0,e.useState)(!1),2),h=f[0],p=f[1],d=_r((0,e.useState)(void 0),2),y=d[0],m=d[1],v=o().useRef(),g=(0,e.useCallback)((function(t){t.source===v.current.contentWindow&&l&&l(t.data)}),[v,l]);return(0,e.useEffect)((function(){return window.addEventListener("message",g,!1),function(){window.removeEventListener("message",g,!1)}}),[g]),(0,e.useEffect)((function(){v.current&&h&&!at(y,u)&&(m(it(u)),v.current.contentWindow.postMessage(u,"*"))}),[u,v,h,y]),(0,e.useEffect)((function(){p(!1)}),[i,a]),o().createElement("iframe",Cr({},s,{ref:v,sandbox:"allow-scripts",onLoad:function(){return p(!0)}}))}function Mr(t){return function(t){if(Array.isArray(t))return Ur(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Ur(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ur(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ur(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Rr=function(t){var e=t.data,r=t.minRowsShown,n=void 0===r?5:r;if(!Array.isArray(e))return o().createElement("div",null,"Error: Data is not an array.");var i=e.reduce((function(t,e){return t[e.CREATED_MONTH]||(t[e.CREATED_MONTH]=[]),t[e.CREATED_MONTH].push(e),t}),{}),a=Math.max.apply(Math,Mr(e.map((function(t){return t.MONTHS_SINCE})))),c="".concat(50*n,"px"),u=150*(a+2),l=Math.max.apply(Math,Mr(e.map((function(t){return t.COHORT_SIZE})))),s=e.reduce((function(t,e){return t+(e.COHORT_SIZE||0)}),0),f=function(){var t=s/e.length/l*100;return"bg-gradient-to-b from-teal-400 via-teal-".concat(Math.min(900,Math.max(400,100*Math.round(t/10)))," to-teal-400")};return o().createElement("div",{className:"w-full h-[650px] overflow-x-auto overflow-y-auto border border-gray-700 rounded bg-gray-800 text-white"},o().createElement("div",{style:{minWidth:"".concat(u,"px"),maxHeight:c}},o().createElement("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(100px,1fr))] gap-2 p-2 border-t border-gray-600 hover:bg-gray-700"},o().createElement("div",{className:"col-span-1 p-2"},"Time"),o().createElement("div",{className:"col-span-1 p-2 ".concat(f())},"Users"),Array.from({length:a+1}).map((function(t,e){return o().createElement("div",{className:"col-span-1 p-2",key:e},"Month ",e)}))),Object.keys(i).sort((function(t,e){return new Date(e)-new Date(t)})).map((function(t){var e;return o().createElement("div",{key:t,className:"border-b border-gray-700"},o().createElement("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(100px,1fr))] gap-2 p-2 border-t border-gray-600 hover:bg-gray-700"},o().createElement("div",{className:"col-span-1 p-2"},"".concat(new Date(t).toLocaleString("default",{month:"long"})," / ").concat(new Date(t).getFullYear())),o().createElement("div",{className:"col-span-1 p-2 ".concat(f())},((null===(e=i[t].find((function(t){return 0===t.MONTHS_SINCE})))||void 0===e?void 0:e.COHORT_SIZE)||0).toLocaleString()),Array.from({length:a}).map((function(e,r){var n,a=i[t].find((function(t){return t.MONTHS_SINCE===r+1}));return o().createElement("div",{className:"col-span-1 p-2 border border-gray-500 ".concat(a?(n=a.RETENTION_RATE,n<=.1?"bg-teal-200 text-black":n<=.2?"bg-teal-300 text-black":n<=.3?"bg-teal-400 text-black":n<=.4?"bg-teal-500 text-white":n<=.5?"bg-teal-600 text-white":n<=.6?"bg-teal-700 text-white":n<=.7?"bg-teal-800 text-white":"bg-teal-900 text-white"):""),key:r},a?Math.round(100*a.RETENTION_RATE)+"%":"-")}))))}))))};const Fr=require("chart.js"),Dr=require("react-chartjs-2");Fr.Chart.register(Fr.CategoryScale,Fr.LinearScale,Fr.BarElement,Fr.Title,Fr.Tooltip,Fr.Legend);var Gr=function(t){var e=t.options,r=t.data;return o().createElement(Dr.Bar,{options:e,data:r})};Fr.Chart.register(Fr.LinearScale,Fr.CategoryScale,Fr.BarElement,Fr.PointElement,Fr.LineElement,Fr.Legend,Fr.Tooltip,Fr.LineController,Fr.BarController);var qr=function(t){var e=t.type,r=t.data,n=t.options;return o().createElement(Dr.Chart,{type:e,data:r,options:n})};Fr.Chart.register(Fr.ArcElement,Fr.Tooltip,Fr.Legend);var zr=function(t){var e=t.data;return o().createElement(Dr.Pie,{data:e})};Fr.Chart.register(Fr.LinearScale,Fr.PointElement,Fr.LineElement,Fr.Tooltip,Fr.Legend);var Jr=function(t){var e=t.options,r=t.data;return o().createElement(Dr.Scatter,{options:e,data:r})};Fr.Chart.register(Fr.LinearScale,Fr.PointElement,Fr.Tooltip,Fr.Legend);var $r=function(t){var e=t.options,r=t.data;return o().createElement(Dr.Bubble,{options:e,data:r})};Fr.Chart.register(Fr.CategoryScale,Fr.LinearScale,Fr.PointElement,Fr.LineElement,Fr.Title,Fr.Tooltip,Fr.Filler,Fr.Legend);var Vr=function(t){var e=t.options,r=t.data;return o().createElement(Dr.Line,{options:e,data:r})};const Kr=require("react-resizable");function Hr(t){return Hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hr(t)}function Yr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Wr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Yr(Object(r),!0).forEach((function(e){Xr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Yr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Xr(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==Hr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Hr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Hr(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Zr(t){var e=t.children,r=t.width,n=void 0===r?600:r,i=t.height,a=void 0===i?300:i,c=t.resizable,u=void 0===c||c,l=t.style,s=void 0===l?{}:l,f=t.className,h=void 0===f?"":f;return o().createElement("div",{style:{marginLeft:20}},o().createElement("div",{style:Wr({display:"inline-block",width:"auto",background:"white",padding:".5rem",borderRadius:"0.5rem",boxShadow:"0 30px 40px rgba(0,0,0,.1)"},s)},u?o().createElement(Kr.ResizableBox,{width:n,height:a},o().createElement("div",{style:{width:"100%",height:"100%"},className:h},e)):o().createElement("div",{style:{width:"".concat(n,"px"),height:"".concat(a,"px")},className:h},e)))}function Qr(t){return Qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qr(t)}function tn(t){return function(t){if(Array.isArray(t))return an(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||on(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function en(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function rn(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?en(Object(r),!0).forEach((function(e){nn(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):en(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function nn(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==Qr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Qr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Qr(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function on(t,e){if(t){if("string"==typeof t)return an(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?an(t,e):void 0}}function an(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}require("react-resizable/css/styles.css");var cn={elementType:["line","area","bar"],primaryAxisType:["linear","time","log","band"],secondaryAxisType:["linear","time","log","band"],primaryAxisPosition:["top","left","right","bottom"],secondaryAxisPosition:["top","left","right","bottom"],secondaryAxisStack:[!0,!1],primaryAxisShow:[!0,!1],secondaryAxisShow:[!0,!1],interactionMode:["primary","closest"],tooltipGroupingMode:["single","primary","secondary","series"],tooltipAnchor:["closest","top","bottom","left","right","center","gridTop","gridBottom","gridLeft","gridRight","gridCenter","pointer"],tooltipAlign:["auto","top","bottom","left","right","topLeft","topRight","bottomLeft","bottomRight","center"],snapCursor:[!0,!1]},un=Object.keys(cn);function ln(){var t,e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.series,i=r.datums,a=void 0===i?10:i,c=r.useR,u=r.show,l=void 0===u?[]:u,s=r.count,f=void 0===s?1:s,h=r.resizable,p=void 0===h||h,d=r.canRandomize,y=void 0===d||d,m=r.dataType,v=void 0===m?"time":m,g=r.elementType,b=void 0===g?"line":g,w=r.primaryAxisType,E=void 0===w?"time":w,x=r.secondaryAxisType,S=void 0===x?"linear":x,k=r.primaryAxisPosition,O=void 0===k?"bottom":k,j=r.secondaryAxisPosition,A=void 0===j?"left":j,I=r.primaryAxisStack,L=void 0!==I&&I,N=r.secondaryAxisStack,T=void 0===N||N,C=r.primaryAxisShow,_=void 0===C||C,P=r.secondaryAxisShow,B=void 0===P||P,M=r.tooltipAnchor,U=void 0===M?"closest":M,R=r.tooltipAlign,F=void 0===R?"auto":R,D=r.interactionMode,G=void 0===D?"primary":D,q=r.tooltipGroupingMode,z=void 0===q?"primary":q,J=r.snapCursor,$=void 0===J||J,V=(t=o().useState({count:f,resizable:p,canRandomize:y,dataType:v,elementType:b,primaryAxisType:E,secondaryAxisType:S,primaryAxisPosition:O,secondaryAxisPosition:A,primaryAxisStack:L,secondaryAxisStack:T,primaryAxisShow:_,secondaryAxisShow:B,tooltipAnchor:U,tooltipAlign:F,interactionMode:G,tooltipGroupingMode:z,snapCursor:$,datums:a,data:sn(v,n,a,c)}),e=2,function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||on(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),K=V[0],H=V[1];o().useEffect((function(){H((function(t){return rn(rn({},t),{},{data:sn(v,n,a,c)})}))}),[f,v,a,n,c]);var Y=un.filter((function(t){return l.indexOf(t)>-1})).map((function(t){return o().createElement("div",{key:t},t,": ",o().createElement("select",{value:K[t],onChange:function(e){var r=e.target.value;return H((function(e){return rn(rn({},e),{},nn({},t,"boolean"==typeof cn[t][0]?"true"===r:r))}))}},cn[t].map((function(t){return o().createElement("option",{value:t,key:t.toString()},t.toString())}))),o().createElement("br",null))}));return rn(rn({},K),{},{randomizeData:function(){return H((function(t){return rn(rn({},t),{},{data:sn(v,n,a,c)})}))},Options:Y})}function sn(t,e,r,n){return tn(new Array(e||Math.max(Math.round(5*Math.random()),1))).map((function(e,o){return function(t,e,r,n){var o=new Date;o.setUTCHours(0),o.setUTCMinutes(0),o.setUTCSeconds(0),o.setUTCMilliseconds(0);var i=r;return{label:"Series ".concat(t+1),data:tn(new Array(i)).map((function(t,r){return{primary:"ordinal"===e?"Ordinal Group ".concat(0+r):"time"===e?new Date(o.getTime()+864e5*r):"linear"===e?Math.random()<0?null:0+Math.round(100*Math.random()):0+r,secondary:Math.random()<0?null:0+Math.round(100*Math.random()),radius:n?20-Math.floor(Math.log(Math.random()*(Math.pow(1.1,20)-2)+2)/Math.log(1.1)):void 0}}))}}(o,t,r,n)}))}const fn=require("react-charts");function hn(){var t=ln({series:10,dataType:"time"}),e=t.data,r=t.randomizeData,n=o().useMemo((function(){return{getValue:function(t){return t.primary}}}),[]),i=o().useMemo((function(){return[{getValue:function(t){return t.secondary},stacked:!0}]}),[]);return console.log("data",e),console.log("primaryAxis",n),console.log("secondaryAxes",i),o().createElement(o().Fragment,null,o().createElement("button",{onClick:r},"Randomize Data"),o().createElement("br",null),o().createElement("br",null),o().createElement(Zr,null,o().createElement(fn.Chart,{options:{data:e,primaryAxis:n,secondaryAxes:i}})))}var pn=r(663),dn=r.n(pn);function yn(){var t=ln({series:3,dataType:"ordinal"}),e=t.data,r=t.randomizeData,n=o().useMemo((function(){return{getValue:function(t){return t.primary}}}),[]),i=o().useMemo((function(){return[{getValue:function(t){return t.secondary}}]}),[]);return console.log("data",e),console.log("primaryAxis",n),console.log("secondaryAxes",i),o().createElement(o().Fragment,null,o().createElement("button",{onClick:r},"Randomize Data"),o().createElement("br",null),o().createElement("br",null),o().createElement(Zr,null,o().createElement(fn.Chart,{options:{data:e,primaryAxis:n,secondaryAxes:i}})))}var mn=r(994),vn=r.n(mn);function gn(){var t=ln({series:10,dataType:"linear",useR:!0}),e=t.data,r=t.randomizeData,n=o().useMemo((function(){return{getValue:function(t){return t.primary}}}),[]),i=o().useMemo((function(){return[{getValue:function(t){return t.secondary},elementType:"bubble"}]}),[]);return console.log("data",e),console.log("primaryAxis",n),console.log("secondaryAxes",i),o().createElement(o().Fragment,null,o().createElement("button",{onClick:r},"Randomize Data"),o().createElement("br",null),o().createElement("br",null),o().createElement(Zr,null,o().createElement(fn.Chart,{options:{data:e,primaryAxis:n,secondaryAxes:i,interactionMode:"closest",getDatumStyle:function(t){return{circle:{r:t.originalDatum.radius}}}}})))}var bn=r(703),wn=r.n(bn);function En(){var t=ln({series:10,dataType:"time"}),e=t.data,r=t.randomizeData,n=o().useMemo((function(){return{getValue:function(t){return t.primary}}}),[]),i=o().useMemo((function(){return[{getValue:function(t){return t.secondary}}]}),[]);return console.log("data",e),console.log("primaryAxis",n),console.log("secondaryAxes",i),o().createElement(o().Fragment,null,o().createElement("button",{onClick:r},"Randomize Data"),o().createElement("br",null),o().createElement("br",null),o().createElement(Zr,{style:{background:"rgba(0, 27, 45, 0.9)",padding:".5rem",borderRadius:"5px"}},o().createElement("div",{style:{width:"100%",height:"100%"}},o().createElement(fn.Chart,{options:{data:e,primaryAxis:n,secondaryAxes:i,dark:!0}}))))}function xn(){var t=ln({series:10,dataType:"time"}),e=t.data,r=t.randomizeData,n=o().useMemo((function(){return{getValue:function(t){return t.primary}}}),[]),i=o().useMemo((function(){return[{getValue:function(t){return t.secondary}}]}),[]);return console.log("data",e),console.log("primaryAxis",n),console.log("secondaryAxes",i),o().createElement(o().Fragment,null,o().createElement("p",null,"This example demos a chart's ability to position itself responsively in elements while respecting the box-model (margin, padding, and borders). It also showcases the tooltip's ability to portal outside of an overflow element (the blue border-box)."),o().createElement("button",{onClick:r},"Randomize Data"),o().createElement("br",null),o().createElement("br",null),o().createElement("div",{style:{display:"flex",flexDirection:"column",padding:"12px",border:"2px solid black",height:"400px"}},o().createElement("div",{style:{flex:"0 0 auto",padding:"10px",border:"1px solid red"}},"Header"),o().createElement("div",{style:{flex:2,border:"5px solid blue",maxHeight:"400px",margin:"10px",overflow:"hidden"}},o().createElement(fn.Chart,{options:{data:e,primaryAxis:n,secondaryAxes:i}}))))}var Sn=r(300),kn=r.n(Sn);function On(){var t=ln({series:6,dataType:"time"}),e=t.data,r=t.randomizeData;e.forEach((function(t,e){return t.secondaryAxisId=e>2?"2":void 0}));var n=o().useMemo((function(){return{getValue:function(t){return t.primary},padBandRange:!0}}),[]),i=o().useMemo((function(){return[{getValue:function(t){return t.secondary},elementType:"bar"},{id:"2",getValue:function(t){return t.secondary},elementType:"line"}]}),[]);return console.log("data",e),console.log("primaryAxis",n),console.log("secondaryAxes",i),o().createElement(o().Fragment,null,o().createElement("button",{onClick:r},"Randomize Data"),o().createElement("br",null),o().createElement("br",null),o().createElement(Zr,null,o().createElement(fn.Chart,{options:{data:e,primaryAxis:n,secondaryAxes:i}})))}function jn(){var t=ln({series:6,dataType:"time"}),e=t.data,r=t.randomizeData;e.forEach((function(t,e){return t.secondaryAxisId=e>2?"2":void 0}));var n=o().useMemo((function(){return{getValue:function(t){return t.primary},padBandRange:!0}}),[]),i=o().useMemo((function(){return[{getValue:function(t){return t.secondary},elementType:"bar"},{id:"2",getValue:function(t){return t.secondary},elementType:"line"}]}),[]);return console.log("data",e),console.log("primaryAxis",n),console.log("secondaryAxes",i),o().createElement(o().Fragment,null,o().createElement("button",{onClick:r},"Randomize Data"),o().createElement("br",null),o().createElement("br",null),o().createElement(Zr,null,o().createElement(fn.Chart,{options:{data:e,primaryAxis:n,secondaryAxes:i}})))}function An(){var t=ln({series:3,dataType:"ordinal"}),e=t.data,r=t.randomizeData,n=o().useMemo((function(){return{position:"left",getValue:function(t){return t.primary}}}),[]),i=o().useMemo((function(){return[{position:"bottom",getValue:function(t){return t.secondary}}]}),[]);return console.log("data",e),console.log("primaryAxis",n),console.log("secondaryAxes",i),o().createElement(o().Fragment,null,o().createElement("button",{onClick:r},"Randomize Data"),o().createElement("br",null),o().createElement("br",null),o().createElement(Zr,null,o().createElement(fn.Chart,{options:{data:e,primaryAxis:n,secondaryAxes:i}})))}function In(){var t=ln({series:10,dataType:"ordinal"}),e=t.data,r=t.randomizeData,n=o().useMemo((function(){return{getValue:function(t){return t.primary}}}),[]),i=o().useMemo((function(){return[{getValue:function(t){return t.secondary},stacked:!0}]}),[]);return console.log("data",e),console.log("primaryAxis",n),console.log("secondaryAxes",i),o().createElement(o().Fragment,null,o().createElement("button",{onClick:r},"Randomize Data"),o().createElement("br",null),o().createElement("br",null),o().createElement(Zr,null,o().createElement(fn.Chart,{options:{data:e,primaryAxis:n,secondaryAxes:i}})))}function Ln(t){var e,r,n=t.data,i=t.options;return null!=i&&i.primaryAxis?(e=i.primaryAxis,console.log("primaryAxis is in options")):(e={getValue:function(t){return t.primary}},console.log("primaryAxis is not in options")),null!=i&&i.secondaryAxes?(r=i.secondaryAxes,console.log("secondaryAxes is in options")):(r=[{getValue:function(t){return t.secondary}}],console.log("secondaryAxes is not in options")),console.log("props",t),o().createElement(o().Fragment,null,o().createElement("div",{style:{display:"flex",flexDirection:"column",padding:"12px",minHeight:"400px"}},o().createElement("div",{style:{flex:2,minHeight:i.minHeight}},o().createElement(fn.Chart,{options:{data:n,primaryAxis:e,secondaryAxes:r,dark:!0}}))))}vn(),dn(),kn(),wn();var Nn=function(t){var e=t.chart_name,r=t.options,n=t.data;return o().createElement(o().Fragment,null,"BarCustom"===e&&o().createElement(Ln,{options:r,data:n}),"Line"===e&&o().createElement(On,null),"Bar"===e&&o().createElement(yn,null),"Bar (Stacked)"===e&&o().createElement(vn(),null),"Bar (Horizontal)"===e&&o().createElement(An,null),"Bar (Horizontal + Stacked)"===e&&o().createElement(In,null),"Band"===e&&o().createElement(dn(),null),"Area"===e&&o().createElement(hn,null),"Bubble"===e&&o().createElement(gn,null),"Multiple Axes"===e&&o().createElement(jn,null),"Interaction Modes"===e&&o().createElement(kn(),null),"Dark Mode"===e&&o().createElement(En,null),"Dynamic / Overflow Container"===e&&o().createElement(xn,null),"Custom Styles"===e&&o().createElement(wn(),null))};const Tn=require("@table-library/react-table-library/compact"),Cn=require("@table-library/react-table-library/theme"),_n=require("@table-library/react-table-library/baseline"),Pn=require("@table-library/react-table-library/sort");var Bn,Mn=function(t){var e=t.columns,r=t.data,n=t.sortFns,i=(0,Cn.useTheme)((0,_n.getTheme)()),a=(0,Pn.useSort)(r,{onChange:function(t,e){console.log(t,e)}},{sortFns:n});return o().createElement(o().Fragment,null,o().createElement(Tn.CompactTable,{columns:e,data:r,theme:i,sort:a}))},Un=r(872).lW;function Rn(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Kn(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function Fn(t,e,r){return Fn=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&Dn(o,r.prototype),o},Fn.apply(null,arguments)}function Dn(t,e){return Dn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Dn(t,e)}function Gn(){return Gn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Gn.apply(this,arguments)}function qn(t){return function(t){if(Array.isArray(t))return Hn(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Kn(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Qn(n.key),n)}}function $n(t,e,r){return e&&Jn(t.prototype,e),r&&Jn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Vn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||Kn(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kn(t,e){if(t){if("string"==typeof t)return Hn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Hn(t,e):void 0}}function Hn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Yn(t){return Yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yn(t)}function Wn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Xn(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Wn(Object(r),!0).forEach((function(e){Zn(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Wn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Zn(t,e,r){return(e=Qn(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Qn(t){var e=function(t,e){if("object"!==Yn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Yn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Yn(e)?e:String(e)}var to=Object.freeze({randomBytes:rt(Tr.randomBytes),secretbox:rt(Tr.secretbox),scalarMult:rt(Tr.scalarMult),box:rt(Tr.box),sign:rt(Tr.sign),hash:rt(Tr.hash),verify:rt(Tr.verify)}),eo=Object.freeze({version:rt(Ir.version),utils:rt(Ir.utils),curve:rt(Ir.curve),curves:rt(Ir.curves),ec:Object.freeze(Ir.ec),eddsa:Object.freeze(Ir.eddsa)}),ro="state",no="private",oo="public",io={em:!0,nav:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,div:!0,span:!0,strong:!0,sub:!0,sup:!0,pre:!0,i:!0,b:!0,p:!0,input:!0,button:!0,ul:!0,ol:!0,li:!0,table:!0,tr:!0,th:!0,td:!0,thead:!0,tbody:!0,tfoot:!0,br:!1,hr:!1,img:!1,textarea:!0,select:!0,option:!0,label:!0,small:!0,svg:!0,animate:!1,animateMotion:!1,animateTransform:!1,defs:!0,circle:!0,clipPath:!0,ellipse:!0,g:!0,image:!1,line:!0,linearGradient:!0,marker:!0,mask:!0,mpath:!1,path:!0,pattern:!0,polyline:!0,radialGradient:!0,rect:!0,set:!1,stop:!1,symbol:!0,text:!0,textPath:!0,tspan:!0,use:!1,a:!0},ao=Xn(Xn({},io),{Widget:!1,CommitButton:!0,IpfsImageUpload:!1,Markdown:!1,Fragment:!0,InfiniteScroll:!0,Typeahead:!1,Tooltip:!0,OverlayTrigger:!0,Files:!0,iframe:!1,BarEl:!0,CohortEl:!0,ChartEl:!0,BasicTable:!0,RTable:!0,PieEl:!0,ScatterEl:!0,BubbleEl:!0,LineEl:!0,ReactChart:!0}),co={JSON:!0,Social:!0,Storage:!0,Near:!0,State:!0,console:!0,styled:!0,Object:!0,Date,Number,Big:u(),Math,Buffer:Un,Audio,Image,File,Blob,FileReader,URL,Array,BN:Nr(),Uint8Array,Map,Set,clipboard:!0},uo=(Zn(Bn={},nt,!0),Zn(Bn,"constructor",!0),Zn(Bn,"prototype",!0),Zn(Bn,"__proto__",!0),Zn(Bn,"__defineGetter__",!0),Zn(Bn,"__defineSetter__",!0),Zn(Bn,"__lookupGetter__",!0),Zn(Bn,"__lookupSetter__",!0),Bn),lo=function(t){if(!0===uo[t])throw new Error("".concat(t," is reserved and can't be used"))},so=function(t){if(ot(t))throw new Error("React objects shouldn't dereferenced")},fo=function t(e){null!==e&&"object"===Yn(e)&&Object.entries(e).forEach((function(e){var r=Vn(e,2),n=r[0],o=r[1];lo(n),t(o)}))},ho=function(t,e){return t&&(null==e||"final"===e||"optimistic"===e)},po=function(t){if("Identifier"!==t.type)throw new Error("Non identifier: "+t.type);var e=t.name;if(lo(e),e in co)throw new Error("Cannot use keyword: "+e);return{type:"Identifier",name:e}},yo=function(t){if("JSXIdentifier"!==t.type)throw new Error("Non JSXIdentifier: "+t.type);return t.name},mo=function t(e){if("Identifier"===e.type)return po(e);if("ArrayPattern"===e.type)return{type:"ArrayPattern",elements:e.elements.map(t)};if("ObjectPattern"===e.type)return{type:"ObjectPattern",properties:e.properties.map((function(e){if("Property"===e.type)return{key:po(e.key),value:t(e.value)};if("RestElement"===e.type)return{type:"RestElement",argument:po(e.argument)};throw new Error("Unknown property type: "+e.type)}))};if("RestElement"===e.type)return{type:"RestElement",argument:po(e.argument)};throw new Error("Unknown pattern: "+e.type)},vo=function(){function t(e,r){zn(this,t),this.prevStack=e,this.state=r}return $n(t,[{key:"findObj",value:function(t){return t in this.state?this.state:this.prevStack?this.prevStack.findObj(t):void 0}},{key:"get",value:function(t){return t in this.state?this.state[t]:this.prevStack?this.prevStack.get(t):void 0}}]),t}(),go=function(){function t(e,r,n,o){zn(this,t),this.gIndex=0,this.vm=e,this.isTrusted=!!o,this.stack=new vo(r,n)}return $n(t,[{key:"newStack",value:function(e){return new t(this.vm,this.stack,{},this.isTrusted||!!e)}},{key:"executeExpression",value:function(t){return this.executeExpressionInternal(t)}},{key:"renderElement",value:function(t){var e,r=this,n="JSXFragment"===t.type?"Fragment":yo(t.openingElement.name),i=ao[n],a=void 0===i&&this.stack.get(n);if(void 0===i){if(void 0===a)throw new Error("Unknown element: "+n);if(!(0,jr.isStyledComponent)(a))throw new Error("Not a styled component: "+n)}var c={},u={};"input"===n?c.className="form-control":"CommitButton"===n?c.className="btn btn-success":"button"===n?c.className="btn btn-primary":"IpfsImageUpload"===n&&(c.className="btn btn-outline-primary");var l={};("JSXFragment"===t.type?t.openingFragment:t.openingElement).attributes.forEach((function(t){if("JSXAttribute"===t.type){var e=yo(t.name);c[e]=null===t.value||r.executeExpression(t.value),"value"!==e&&"image"!==e&&"onChange"!==e||(l[e]=t.value)}else{if("JSXSpreadAttribute"!==t.type)throw new Error("Unknown attribute type: "+t.type);var n=r.executeExpression(t.argument);Object.assign(c,n)}})),Object.entries(l).forEach((function(t){var e=Vn(t,2),o=e[0],i=e[1];if("value"!==o||"input"!==n||"text"!==c.type||"JSXExpressionContainer"!==i.type||"onChange"in l){if("image"===o&&"IpfsImageUpload"===n&&"JSXExpressionContainer"===i.type){var a=r.resolveMemberExpression(i.expression,{requireState:!0,left:!0}),s=a.obj,f=a.key;u.img=s[f],c.onChange=function(t){(null==t?void 0:t.length)>0?(s[f]={uploading:!0,cid:null},r.vm.setReactState(r.vm.state.state),z(t[0]).then((function(t){if(r.vm.alive){var e=r.vm.vmStack.resolveMemberExpression(i.expression,{requireState:!0,left:!0});e.obj[e.key]={cid:t},r.vm.setReactState(r.vm.state.state)}}))):(s[f]=null,r.vm.setReactState(r.vm.state.state))}}}else{var h=r.resolveMemberExpression(i.expression,{requireState:!0,left:!0}),p=h.obj,d=h.key;c.value=(null==p?void 0:p[d])||"",c.onChange=function(t){t.preventDefault(),p[d]=t.target.value,r.vm.setReactState(r.vm.state.state)}}})),c.key=null!==(e=c.key)&&void 0!==e?e:"".concat(this.vm.widgetSrc,"-").concat(n,"-").concat(this.vm.gIndex),delete c.dangerouslySetInnerHTML;var s,f=(null==a?void 0:a.target)||n;if(c.as&&!io[c.as]&&delete c.as,c.forwardedAs&&!io[c.forwardedAs]&&delete c.forwardedAs,"img"===f?c.alt=null!==(s=c.alt)&&void 0!==s?s:"not defined":"a"===f?"href"in c&&(c.href=(0,Ce.sanitizeUrl)(c.href)):"Widget"===n&&(c.depth=this.vm.depth+1,c.config=[c.config].concat(qn(this.vm.widgetConfigs)).filter(Boolean)),!1===i&&t.children.length)throw new Error("And element '"+n+"' contains children, but shouldn't");var h,p,d,y,m=t.children.map((function(t,e){return r.vm.gIndex=e,r.executeExpression(t)}));if("Widget"===n)return o().createElement(No,c);if("CommitButton"===n)return o().createElement(kr,Gn({},c,{widgetSrc:this.vm.widgetSrc}),m);if("InfiniteScroll"===n)return o().createElement(Pe(),c,m);if("Tooltip"===n)return o().createElement(He.Tooltip,c,m);if("OverlayTrigger"===n)return o().createElement(He.OverlayTrigger,c,m.filter((function(t){return!C(t)||!!t.trim()}))[0]);if("Typeahead"===n)return o().createElement(Or.Typeahead,c);if("Markdown"===n)return o().createElement(ke,c);if("Fragment"===n)return o().createElement(o().Fragment,c,m);if("BarEl"===n)return o().createElement(Gr,c);if("CohortEl"===n)return o().createElement(Rr,c);if("ChartEl"===n)return o().createElement(qr,c);if("ScatterEl"===n)return o().createElement(Jr,c);if("LineEl"===n)return o().createElement(Vr,c);if("BubbleEl"===n)return o().createElement($r,c);if("PieEl"===n)return o().createElement(zr,c);if("BasicTable"===n)return o().createElement(Mn,c);if("ReactChart"===n)return o().createElement(Nn,c);if("IpfsImageUpload"===n)return o().createElement("div",{className:"d-inline-block",key:c.key},(null===(h=u.img)||void 0===h?void 0:h.cid)&&o().createElement("div",{className:"d-inline-block me-2 overflow-hidden align-middle",style:{width:"2.5em",height:"2.5em"}},o().createElement("img",{className:"rounded w-100 h-100",style:{objectFit:"cover"},src:J(null===(p=u.img)||void 0===p?void 0:p.cid),alt:"upload preview"})),o().createElement(Te(),Gn({multiple:!1,accepts:["image/*"],minFileSize:1,clickable:!0},c),null!==(d=u.img)&&void 0!==d&&d.uploading?o().createElement(o().Fragment,null,A," Uploading"):null!==(y=u.img)&&void 0!==y&&y.cid?"Replace":"Upload an Image"));if("Files"===n)return o().createElement(Te(),c,m);if("iframe"===n)return o().createElement(Br,c);if(a)return o().createElement.apply(o(),[a,Xn({},c)].concat(qn(m)));if(!0===i)return o().createElement.apply(o(),[n,Xn({},c)].concat(qn(m)));if(!1===i)return o().createElement(n,Xn({},c));throw new Error("Unsupported element: "+n)}},{key:"resolveKey",value:function(t,e){var r=e||"Identifier"!==t.type?this.executeExpression(t):t.name;return lo(r),r}},{key:"callFunction",value:function(t,e,r,n,o){var i=this,a=co[t];if(!0===a||void 0===a){if("Social"===t&&"getr"===e||"socialGetr"===e){if(r.length<1)throw new Error("Missing argument 'keys' for Social.getr");return this.vm.cachedSocialGet(r[0],!0,r[1],r[2])}if("Social"===t&&"get"===e||"socialGet"===e){if(r.length<1)throw new Error("Missing argument 'keys' for Social.get");return this.vm.cachedSocialGet(r[0],!1,r[1],r[2])}if("Social"===t&&"keys"===e){if(r.length<1)throw new Error("Missing argument 'keys' for Social.keys");return this.vm.cachedSocialKeys(r[0],r[1],r[2])}if("Social"===t&&"index"===e){if(r.length<2)throw new Error("Missing argument 'action' and 'key` for Social.index");return this.vm.cachedIndex(r[0],r[1],r[2])}if("Social"===t&&"set"===e){if(r.length<1)throw new Error("Missing argument 'data' for Social.set");return this.vm.socialSet(r[0],r[1])}if("Near"===t&&"view"===e){if(r.length<2)throw new Error("Method: Near.view. Required arguments: 'contractName', 'methodName'. Optional: 'args', 'blockId/finality', 'subscribe'");var c=Vn(r,5),u=c[0],l=c[1],s=c[2],f=c[3],h=c[4];return this.vm.cachedNearView(u,l,s,f,ho(h,f))}if("Near"===t&&"asyncView"===e){var p;if(r.length<2)throw new Error("Method: Near.asyncView. Required arguments: 'contractName', 'methodName'. Optional: 'args', 'blockId/finality'");return(p=this.vm).asyncNearView.apply(p,qn(r))}if("Near"===t&&"block"===e){var d=Vn(r,2),y=d[0],m=d[1];return this.vm.cachedNearBlock(y,ho(m,y))}if("Near"===t&&"call"===e){if(1===r.length){if(T(r[0]))return this.vm.confirmTransactions([r[0]]);if(N(r[0]))return this.vm.confirmTransactions(r[0]);throw new Error("Method: Near.call. Required argument: 'tx/txs'. A single argument call requires an TX object or an array of TX objects.")}var v;if(r.length<2||r.length>5)throw new Error("Method: Near.call. Required argument: 'contractName'. If the first argument is a string: 'methodName'. Optional: 'args', 'gas' (defaults to 300Tg), 'deposit' (defaults to 0)");return this.vm.confirmTransactions([{contractName:r[0],methodName:r[1],args:null!==(v=r[2])&&void 0!==v?v:{},gas:r[3],deposit:r[4]}])}if("fetch"===e){var g;if(r.length<1)throw new Error("Method: fetch. Required arguments: 'url'. Optional: 'options'");return(g=this.vm).cachedFetch.apply(g,qn(r))}if("asyncFetch"===e){var b;if(r.length<1)throw new Error("Method: asyncFetch. Required arguments: 'url'. Optional: 'options'");return(b=this.vm).asyncFetch.apply(b,qn(r))}if("useCache"===e){var w;if(r.length<2)throw new Error("Method: useCache. Required arguments: 'promiseGenerator', 'dataKey'. Optional: 'options'");if(!(r[0]instanceof Function))throw new Error("Method: useCache. The first argument 'promiseGenerator' must be a function");return(w=this.vm).useCache.apply(w,qn(r))}if("parseInt"===e)return parseInt.apply(void 0,qn(r));if("parseFloat"===e)return parseFloat.apply(void 0,qn(r));if("isNaN"===e)return isNaN.apply(void 0,qn(r));if("setTimeout"===e){var E=Vn(r,2),x=E[0],S=E[1],k=setTimeout((function(){i.vm.alive&&x()}),S);return this.vm.timeouts.add(k),k}if("setInterval"===e){if(this.vm.intervals.size>=16)throw new Error("Too many intervals. Max allowed: ".concat(16));var O=Vn(r,2),j=O[0],A=O[1],I=setInterval((function(){i.vm.alive&&j()}),A);return this.vm.intervals.add(I),I}if("clearTimeout"===e){var L=r[0];return this.vm.timeouts.delete(L),clearTimeout(L)}if("clearInterval"===e){var C=r[0];return this.vm.intervals.delete(C),clearInterval(C)}if("JSON"===t&&"stringify"===e||"stringify"===e){if(r.length<1)throw new Error("Missing argument 'obj' for JSON.stringify");return so(r[0]),JSON.stringify(r[0],r[1],r[2])}if("JSON"===t&&"parse"===e){if(r.length<1)throw new Error("Missing argument 's' for JSON.parse");try{var _=JSON.parse(r[0]);return fo(_),_}catch(t){return null}}else if("Object"===t){if("keys"===e){if(r.length<1)throw new Error("Missing argument 'obj' for Object.keys");return so(r[0]),Object.keys(r[0])}if("values"===e){if(r.length<1)throw new Error("Missing argument 'obj' for Object.values");return so(r[0]),Object.values(r[0])}if("entries"===e){if(r.length<1)throw new Error("Missing argument 'obj' for Object.entries");return so(r[0]),Object.entries(r[0])}if("assign"===e){r.forEach((function(t){return so(t)}));var P=Object.assign.apply(Object,qn(r));return fo(P),P}if("fromEntries"===e){var B=Object.fromEntries(r[0]);return fo(B),B}}else{if("State"===t&&"init"===e||"initState"===e){if(r.length<1)throw new Error("Missing argument 'initialState' for State.init");if(null===r[0]||"object"!==Yn(r[0])||ot(r[0]))throw new Error("'initialState' is not an object");if(void 0===this.vm.state.state){var M=r[0];this.vm.state.state=M,this.vm.setReactState(M)}return this.vm.state.state}if("State"===t&&"update"===e){var U;if(T(r[0]))this.vm.state.state=null!==(U=this.vm.state.state)&&void 0!==U?U:{},Object.assign(this.vm.state.state,it(r[0]));else if(r[0]instanceof Function){var R;this.vm.state.state=null!==(R=this.vm.state.state)&&void 0!==R?R:{},this.vm.state.state=r[0](this.vm.state.state)}if(void 0===this.vm.state.state)throw new Error("The state was not initialized");return this.vm.setReactState(this.vm.state.state),this.vm.state.state}if("Storage"===t&&"privateSet"===e){if(r.length<2)throw new Error("Missing argument 'key' or 'value' for Storage.privateSet");return this.vm.storageSet({src:this.vm.widgetSrc,type:no},r[0],r[1])}if("Storage"===t&&"privateGet"===e){if(r.length<1)throw new Error("Missing argument 'key' for Storage.privateGet");return this.vm.storageGet({src:this.vm.widgetSrc,type:no},r[0])}if("Storage"===t&&"set"===e){if(r.length<2)throw new Error("Missing argument 'key' or 'value' for Storage.set");return this.vm.storageSet({src:this.vm.widgetSrc,type:oo},r[0],r[1])}if("Storage"===t&&"get"===e){var F;if(r.length<1)throw new Error("Missing argument 'key' for Storage.get");return this.vm.storageGet({src:null!==(F=r[1])&&void 0!==F?F:this.vm.widgetSrc,type:oo},r[0])}var D,G;if("console"===t&&"log"===e)return(D=console).log.apply(D,[this.vm.widgetSrc].concat(qn(r)));if("clipboard"===t&&"writeText"===e)return this.isTrusted?(G=navigator.clipboard).writeText.apply(G,qn(r)):Promise.reject(new Error("Not trusted (not a click)"))}}else{var q=e===t?a:a[e];if("function"==typeof q)return o?Fn(q,qn(r)):q.apply(void 0,qn(r))}if(!n)throw new Error(t&&t!==e?"Unsupported callee method '".concat(t,".").concat(e,"'"):"Unsupported callee method '".concat(e,"'"))}},{key:"resolveMemberExpression",value:function(t,e){if("Identifier"===t.type){var r,n=t.name;if(lo(n),null!=e&&e.requireState&&n!==ro)throw new Error("The top object should be ".concat(ro));var o=null!==(r=this.stack.findObj(n))&&void 0!==r?r:this.stack.state;if(so(o),o===this.stack.state&&n in co){if(null!=e&&e.left)throw new Error("Cannot assign to keyword '"+n+"'");return{obj:o,key:n,keyword:n}}if(null!=e&&e.left&&(!o||!(n in o)))throw new Error("Accessing undeclared identifier '".concat(t.name,"'"));return{obj:o,key:n}}if("MemberExpression"===t.type){var i;if("Identifier"===(null===(i=t.object)||void 0===i?void 0:i.type)){var a=t.object.name;if(a in co){if(null==e||!e.callee)throw new Error("Cannot dereference keyword '"+a+"' in non-call expression");return{obj:this.stack.state,key:this.resolveKey(t.property,t.computed),keyword:a}}}var c=this.executeExpression(t.object);return so(c),{obj:c,key:this.resolveKey(t.property,t.computed)}}throw new Error("Unsupported member type: '"+t.type+"'")}},{key:"getArray",value:function(t){var e=this,r=[];return t.forEach((function(t){"SpreadElement"===t.type?r.push.apply(r,qn(e.executeExpression(t.argument))):r.push(e.executeExpression(t))})),r}},{key:"executeExpressionInternal",value:function(t){var e=this;if(!t)return null;var r=null==t?void 0:t.type;if("AssignmentExpression"===r){var n,o=this.resolveMemberExpression(t.left,{left:!0}),i=o.obj,a=o.key,c=this.executeExpression(t.right);if("="===t.operator)return i[a]=c;if("+="===t.operator)return i[a]+=c;if("-="===t.operator)return i[a]-=c;if("*="===t.operator)return i[a]*=c;if("/="===t.operator)return i[a]/=c;if("??="===t.operator)return null!==(n=i[a])&&void 0!==n?n:i[a]=c;throw new Error("Unknown AssignmentExpression operator '"+t.operator+"'")}if("ChainExpression"===r)return this.executeExpression(t.expression);if("MemberExpression"===r){var u=this.resolveMemberExpression(t),l=u.obj,s=u.key;return null==l?void 0:l[s]}if("Identifier"===r)return this.stack.get(t.name);if("JSXExpressionContainer"===r)return this.executeExpression(t.expression);if("TemplateLiteral"===r){for(var f=[],h=0;h<t.quasis.length;h++){var p=t.quasis[h];if("TemplateElement"!==p.type)throw new Error("Unknown quasis type: "+p.type);f.push(p.value.cooked),p.tail||f.push(this.executeExpression(t.expressions[h]))}return f.join("")}if("CallExpression"===r||"NewExpression"===r){var d="NewExpression"===r,y=this.resolveMemberExpression(t.callee,{callee:!0}),m=y.obj,v=y.key,g=y.keyword,b=this.getArray(t.arguments);if(!g&&(null==m?void 0:m[v])instanceof Function)return d?Fn(m[v],qn(b)):m[v].apply(m,qn(b));if(g||m===this.stack.state||m===this.vm.state)return this.callFunction(null!=g?g:"",v,b,t.optional,d);if(t.optional)return;throw new Error("Not a function call expression")}if("Literal"===r||"JSXText"===r)return t.value;if("JSXElement"===r||"JSXFragment"===r)return this.renderElement(t);if("JSXExpressionContainer"===r)return this.executeExpression(t.expression);if("BinaryExpression"===r){var w=this.executeExpression(t.left),E=this.executeExpression(t.right);if("+"===t.operator)return w+E;if("-"===t.operator)return w-E;if("%"===t.operator)return w%E;if("*"===t.operator)return w*E;if("/"===t.operator)return w/E;if("<"===t.operator)return w<E;if("|"===t.operator)return w|E;if("&"===t.operator)return w&E;if(">"===t.operator)return w>E;if("<="===t.operator)return w<=E;if(">="===t.operator)return w>=E;if("==="===t.operator||"=="===t.operator)return w===E;if("!=="===t.operator||"!="===t.operator)return w!==E;if("in"===t.operator)return w in E;throw new Error("Unknown BinaryExpression operator '"+t.operator+"'")}if("UnaryExpression"===r){if("delete"===t.operator){var x=this.resolveMemberExpression(t.argument,{left:!0}),S=x.obj,k=x.key;return null==S||delete S[k]}var O=this.executeExpression(t.argument);if("-"===t.operator)return-O;if("!"===t.operator)return!O;if("typeof"===t.operator)return Yn(O);throw new Error("Unknown UnaryExpression operator '"+t.operator+"'")}if("LogicalExpression"===r){var j=this.executeExpression(t.left);if("||"===t.operator)return j||this.executeExpression(t.right);if("&&"===t.operator)return j&&this.executeExpression(t.right);if("??"===t.operator)return null!=j?j:this.executeExpression(t.right);throw new Error("Unknown LogicalExpression operator '"+t.operator+"'")}if("ConditionalExpression"===r)return this.executeExpression(t.test)?this.executeExpression(t.consequent):this.executeExpression(t.alternate);if("UpdateExpression"===r){var A=this.resolveMemberExpression(t.argument,{left:!0}),I=A.obj,L=A.key;if("++"===t.operator)return t.prefix?++I[L]:I[L]++;if("--"===t.operator)return t.prefix?--I[L]:I[L]--;throw new Error("Unknown UpdateExpression operator '"+t.operator+"'")}if("ObjectExpression"===r)return t.properties.reduce((function(t,r){if("Property"===r.type)t[e.resolveKey(r.key,r.computed)]=e.executeExpression(r.value);else{if("SpreadElement"!==r.type)throw new Error("Unknown property type: "+r.type);var n=e.executeExpression(r.argument);so(n),Object.assign(t,n)}return t}),{});if("ArrayExpression"===r)return this.getArray(t.elements);if("JSXEmptyExpression"===r)return null;if("ArrowFunctionExpression"===r)return this.createFunction(t.params,t.body,t.expression);if("TaggedTemplateExpression"===r){var N,T;if("MemberExpression"!==t.tag.type&&"CallExpression"!==t.tag.type)throw new Error("TaggedTemplateExpression is only supported for `styled` components");var C=this.resolveMemberExpression("MemberExpression"===t.tag.type?t.tag:t.tag.callee,{callee:!0}),_=C.key;if("styled"!==C.keyword)throw new Error("TaggedTemplateExpression is only supported for `styled` components");if("CallExpression"===t.tag.type){var P=this.getArray(t.tag.arguments),B=null==P?void 0:P[0];if(!(0,jr.isStyledComponent)(B))throw new Error("styled() can only take `styled` components");N=Ar()(B)}else{if("keyframes"===_)N=jr.keyframes;else{if(!(_ in io))throw new Error("Unsupported styled tag: "+_);N=Ar()(_)}T=_}if("TemplateLiteral"!==t.quasi.type)throw new Error("Unknown quasi type: "+t.quasi.type);var M=t.quasi.quasis.map((function(t){if("TemplateElement"!==t.type)throw new Error("Unknown quasis type: "+t.type);return t.value.cooked})),U=0===t.quasi.expressions.length&&"CallExpression"!==t.tag.type,R=JSON.stringify([T].concat(qn(M)));if(U&&this.vm.cachedStyledComponents.has(R))return this.vm.cachedStyledComponents.get(R);var F=t.quasi.expressions.map((function(t){return e.executeExpression(t)}));if(N instanceof Function){var D=N.apply(void 0,[M].concat(qn(F)));return U&&this.vm.cachedStyledComponents.set(R,D),D}throw new Error("styled error")}throw new Error("Unknown expression type '"+r+"'")}},{key:"createFunction",value:function(t,e,r){var n=this;return t=t.map(mo),function(){for(var o,i,a,c=arguments.length,u=new Array(c),l=0;l<c;l++)u[l]=arguments[l];if(n.vm.alive){var s=!!((null==u||null===(o=u[0])||void 0===o?void 0:o.nativeEvent)instanceof Event&&null!=u&&null!==(i=u[0])&&void 0!==i&&i.nativeEvent.isTrusted),f=n.newStack(s);return t.forEach((function(t,e){var r=void 0,n=null==u?void 0:u[e];if(void 0!==n)try{var o,i,a,c,l,s,h,p,d,y,m,v,g,b,w,E,x,S,k,O,j,A,I,L,N;(null===(o=n)||void 0===o?void 0:o.nativeEvent)instanceof Event&&(n.preventDefault(),n={target:{value:null===(i=n=n.nativeEvent)||void 0===i||null===(a=i.target)||void 0===a?void 0:a.value,id:null===(c=n)||void 0===c||null===(l=c.target)||void 0===l?void 0:l.id,dataset:null===(s=n)||void 0===s||null===(h=s.target)||void 0===h?void 0:h.dataset,href:null===(p=n)||void 0===p||null===(d=p.target)||void 0===d?void 0:d.href,checked:null===(y=n)||void 0===y||null===(m=y.target)||void 0===m?void 0:m.checked},data:null===(v=n)||void 0===v?void 0:v.data,code:null===(g=n)||void 0===g?void 0:g.code,key:null===(b=n)||void 0===b?void 0:b.key,ctrlKey:null===(w=n)||void 0===w?void 0:w.ctrlKey,altKey:null===(E=n)||void 0===E?void 0:E.altKey,shiftKey:null===(x=n)||void 0===x?void 0:x.shiftKey,metaKey:null===(S=n)||void 0===S?void 0:S.metaKey,button:null===(k=n)||void 0===k?void 0:k.button,buttons:null===(O=n)||void 0===O?void 0:O.buttons,clientX:null===(j=n)||void 0===j?void 0:j.clientX,clientY:null===(A=n)||void 0===A?void 0:A.clientY,screenX:null===(I=n)||void 0===I?void 0:I.screenX,screenY:null===(L=n)||void 0===L?void 0:L.screenY,touches:null===(N=n)||void 0===N?void 0:N.touches}),r=it(n)}catch(t){console.warn(t)}f.stackDeclare(t,r)})),r?f.executeExpression(e):null===(a=f.executeStatement(e))||void 0===a?void 0:a.result}}}},{key:"stackDeclare",value:function(t,e){var r=this;if("Identifier"===t.type)this.stack.state[t.name]=e;else if("ArrayPattern"===t.type)so(e),t.elements.forEach((function(t,n){"RestElement"===t.type?r.stackDeclare(t.argument,e.slice(n)):r.stackDeclare(t,null==e?void 0:e[n])}));else{if("ObjectPattern"!==t.type)throw new Error("Unknown pattern type: "+t.type);so(e);var n=new Set;t.properties.forEach((function(t){if("RestElement"===t.type){var o={};T(e)&&(Object.assign(o,e),n.forEach((function(t){return delete o[t]}))),r.stackDeclare(t.argument,o)}else r.stackDeclare(t.value,null==e?void 0:e[t.key.name]),n.add(t.key.name)}))}}},{key:"executeStatement",value:function(t){var e=this;if(!t||"EmptyStatement"===t.type)return null;if("VariableDeclaration"===t.type)t.declarations.forEach((function(t){if("VariableDeclarator"!==t.type)throw new Error("Unknown variable declaration type '"+t.type+"'");e.stackDeclare(mo(t.id),e.executeExpression(t.init))}));else{if("ReturnStatement"===t.type)return{result:this.executeExpression(t.argument)};if("FunctionDeclaration"===t.type)this.stackDeclare(po(t.id),this.createFunction(t.params,t.body,t.expression));else if("ExpressionStatement"===t.type)this.executeExpression(t.expression);else if("BlockStatement"===t.type||"Program"===t.type)for(var r=t.body,n=this.newStack(),o=0;o<r.length;o++){var i=n.executeStatement(r[o]);if(i)return i}else if("ForStatement"===t.type){var a=this.newStack();for(a.executeStatement(t.init);this.vm.loopLimit-- >0&&(!t.test||a.executeExpression(t.test));){var c=a.executeStatement(t.body);if(c){if(c.break)break;if(!c.continue)return c}a.executeExpression(t.update)}if(this.vm.loopLimit<=0)throw new Error("Exceeded loop limit")}else if("ForOfStatement"===t.type){var u=this.newStack(),l=u.executeExpression(t.right);so(l);var s,f=Rn(l);try{var h,p=function(){var r=s.value;if(e.vm.loopLimit--<=0)throw new Error("Exceeded loop limit");if("VariableDeclaration"===t.left.type){if(1!==t.left.declarations.length)throw new Error("Invalid for-of statement");t.left.declarations.forEach((function(t){if("VariableDeclarator"!==t.type)throw new Error("Unknown variable declaration type '"+t.type+"'");e.stackDeclare(mo(t.id),r)}))}else{var n=e.resolveMemberExpression(t.left,{left:!0});n.obj[n.key]=r}var o=u.executeStatement(t.body);if(o){if(o.break)return 0;if(!o.continue)return{v:o}}};for(f.s();!(s=f.n()).done&&0!==(h=p());)if(h)return h.v}catch(t){f.e(t)}finally{f.f()}}else if("WhileStatement"===t.type){for(var d=this.newStack();this.vm.loopLimit-- >0&&d.executeExpression(t.test);){var y=d.executeStatement(t.body);if(y){if(y.break)break;if(!y.continue)return y}}if(this.vm.loopLimit<=0)throw new Error("Exceeded loop limit")}else if("IfStatement"===t.type){var m=this.executeExpression(t.test),v=this.newStack(),g=m?v.executeStatement(t.consequent):v.executeStatement(t.alternate);if(g)return g}else{if("BreakStatement"===t.type)return{break:!0};if("ContinueStatement"===t.type)return{continue:!0};if("ThrowStatement"===t.type)throw this.executeExpression(t.argument);if("TryStatement"===t.type)try{var b=this.newStack().executeStatement(t.block);if(b)return b}catch(e){if(!this.vm.alive||!t.handler)return null;if("CatchClause"!==t.handler.type)throw new Error("Unknown try statement handler type '"+t.handler.type+"'");var w=this.newStack();t.handler.param&&w.stackDeclare(po(t.handler.param),it(e instanceof Error?{name:null==e?void 0:e.name,message:null==e?void 0:e.message,toString:function(){return e.toString()}}:e));var E=w.executeStatement(t.handler.body);if(E)return E}finally{this.vm.alive&&this.newStack().executeStatement(t.finalizer)}else{if("SwitchStatement"!==t.type)throw new Error("Unknown token type '"+t.type+"'");var x,S=this.executeExpression(t.discriminant),k=this.newStack(),O=!1,j=Rn(t.cases);try{for(j.s();!(x=j.n()).done;){var A=x.value;if("SwitchCase"!==A.type)throw new Error("Unknown switch case type '"+A.type+"'");if(!O&&A.test){if(k.executeExpression(A.test)!==S)continue;O=!0}if(O){var I,L=!1,N=Rn(A.consequent);try{for(N.s();!(I=N.n()).done;){var T=I.value,C=k.executeStatement(T);if(C){if(C.break){L=!0;break}return C}}}catch(t){N.e(t)}finally{N.f()}if(L)break}}}catch(t){j.e(t)}finally{j.f()}}}}return null}}]),t}(),bo=function(){function t(e){zn(this,t);var r=e.near,n=e.code,o=e.setReactState,i=e.cache,a=e.refreshCache,c=e.confirmTransactions,u=e.depth,l=e.widgetSrc,s=e.requestCommit,f=e.version,h=e.widgetConfigs;if(!n)throw new Error("Not a program");this.alive=!0,this.near=r,this.code=n,this.setReactState=function(t){return o(it(t))},this.cache=i,this.refreshCache=a,this.confirmTransactions=c,this.depth=u,this.widgetSrc=l,this.requestCommit=s,this.version=f,this.cachedStyledComponents=new Map,this.widgetConfigs=h,this.timeouts=new Set,this.intervals=new Set}return $n(t,[{key:"stop",value:function(){this.alive=!1,this.timeouts.forEach((function(t){return clearTimeout(t)})),this.intervals.forEach((function(t){return clearInterval(t)}))}},{key:"cachedPromise",value:function(t,e){var r=this;return it(t({onInvalidate:function(){r.alive&&r.refreshCache()},subscribe:!!e}))}},{key:"cachedSocialGet",value:function(t,e,r,n){var o=this;return t=Array.isArray(t)?t:[t],this.cachedPromise((function(i){return o.cache.socialGet(o.near,t,e,r,n,i)}),null==n?void 0:n.subscribe)}},{key:"storageGet",value:function(t,e){var r=this;return this.cachedPromise((function(n){return r.cache.localStorageGet(t,e,n)}))}},{key:"storageSet",value:function(t,e,r){return this.cache.localStorageSet(t,e,r)}},{key:"cachedSocialKeys",value:function(t,e,r){var n=this;return t=Array.isArray(t)?t:[t],this.cachedPromise((function(o){return n.cache.cachedViewCall(n.near,n.near.config.contractName,"keys",{keys:t,options:r},e,o)}),null==r?void 0:r.subscribe)}},{key:"asyncNearView",value:function(t,e,r,n){return this.near.viewCall(t,e,r,n)}},{key:"cachedNearView",value:function(t,e,r,n,o){var i=this;return this.cachedPromise((function(o){return i.cache.cachedViewCall(i.near,t,e,r,n,o)}),o)}},{key:"cachedNearBlock",value:function(t,e){var r=this;return this.cachedPromise((function(e){return r.cache.cachedBlock(r.near,t,e)}),e)}},{key:"asyncFetch",value:function(t,e){return this.cache.asyncFetch(t,e)}},{key:"cachedFetch",value:function(t,e){var r=this;return this.cachedPromise((function(n){return r.cache.cachedFetch(t,e,n)}),null==e?void 0:e.subscribe)}},{key:"cachedIndex",value:function(t,e,r){var n=this;return this.cachedPromise((function(o){return n.cache.socialIndex(n.near,t,e,r,o)}),null==r?void 0:r.subscribe)}},{key:"useCache",value:function(t,e,r){var n=this;return this.cachedPromise((function(r){return n.cache.cachedCustomPromise({widgetSrc:n.widgetSrc,dataKey:e},t,r)}),null==r?void 0:r.subscribe)}},{key:"socialSet",value:function(t,e){return this.requestCommit({data:t,force:null==e?void 0:e.force,onCommit:null==e?void 0:e.onCommit,onCancel:null==e?void 0:e.onCancel})}},{key:"renderCode",value:function(t){var e=t.props,r=t.context,n=t.state;if(this.depth>=32)return"Too deep";this.gIndex=0,this.state={props:it(e),context:r,state:it(n),nacl:to,elliptic:eo},this.loopLimit=1e6,this.vmStack=new go(this,void 0,this.state);var i=this.vmStack.executeStatement(this.code);if(null!=i&&i.break)throw new Error("BreakStatement outside of a loop");if(null!=i&&i.continue)throw new Error("ContinueStatement outside of a loop");var a=null==i?void 0:i.result;return ot(a)||"string"==typeof a||"number"==typeof a?a:o().createElement("pre",null,JSON.stringify(a,void 0,2))}}]),t}();const wo=require("react-error-boundary"),Eo=require("react-bootstrap-typeahead/types/utils");function xo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||So(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function So(t,e){if(t){if("string"==typeof t)return ko(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ko(t,e):void 0}}function ko(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Oo={ecmaVersion:13,allowReturnOutsideFunction:!0},jo={},Ao=Qt.Parser.extend(ee()()),Io=function(t){return t in jo?jo[t]:jo[t]=Ao.parse(t,Oo)},Lo=function(t,e,r){var n,o=t?{src:t}:e?{code:e}:null,i=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=So(t))){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}(r||[]);try{for(i.s();!(n=i.n()).done;){var a,c=n.value;if(null!==(a=o)&&void 0!==a&&a.src){var u,l=o.src,s=T(null==c?void 0:c.redirectMap)&&c.redirectMap[l];if(!s)try{s=(0,Eo.isFunction)(null==c?void 0:c.redirect)&&c.redirect(l)}catch(t){}if(C(s))o={src:s};else if(C(null===(u=s)||void 0===u?void 0:u.code))return{code:s.code}}}}catch(t){i.e(t)}finally{i.f()}return o};function No(t){var r=t.src,n=t.code,i=t.props,a=t.depth||0,c=t.config,l=xo((0,e.useState)(0),2),s=l[0],f=l[1],h=xo((0,e.useState)(null),2),p=h[0],d=h[1],y=xo((0,e.useState)(null),2),m=y[0],v=y[1],g=xo((0,e.useState)(void 0),2),w=g[0],E=g[1],x=xo((0,e.useState)(0),2),S=x[0],k=x[1],O=xo((0,e.useState)(null),2),j=O[0],L=O[1],N=xo((0,e.useState)({}),2),T=N[0],C=N[1],_=xo((0,e.useState)(null),2),P=_[0],B=_[1],M=xo((0,e.useState)(null),2),U=M[0],R=M[1],F=xo((0,e.useState)(null),2),D=F[0],G=F[1],q=xo((0,e.useState)(null),2),z=q[0],J=q[1],$=xo((0,e.useState)(null),2),V=$[0],K=$[1],H=xo((0,e.useState)(null),2),Y=H[0],W=H[1],X=hr(),Z=Tt(),Q=Zt(),tt=xo((0,e.useState)(null),2),et=tt[0],rt=tt[1];(0,e.useEffect)((function(){var t=c?Array.isArray(c)?c:[c]:[];at(t,V)||K(t)}),[c,V]),(0,e.useEffect)((function(){var t=Lo(r,n,V);at(t,Y)||W(t)}),[r,n,V,Y]),(0,e.useEffect)((function(){if(Z)if(null!=Y&&Y.src){var t=Y.src,e=X.socialGet(Z,t.toString(),!1,void 0,void 0,(function(){f(s+1)}));d(e),v(t)}else null!=Y&&Y.code&&(d(Y.code),v(null))}),[Z,Y,s]),(0,e.useEffect)((function(){if(B(null),rt(null),p)try{var t=Io(p);L({parsedCode:t})}catch(t){rt(o().createElement("div",{className:"alert alert-danger"},"Compilation error:",o().createElement("pre",null,t.message),o().createElement("pre",null,t.stack))),console.error(t)}else void 0===p&&rt(o().createElement("div",{className:"alert alert-danger"},'Source code for "',m,'" is not found'))}),[p,m]);var nt=(0,e.useCallback)((function(t){if(!Z||!t||0===t.length)return null;t=t.map((function(t){return{contractName:t.contractName,methodName:t.methodName,args:t.args||{},deposit:t.deposit?u()(t.deposit):u()(0),gas:t.gas?u()(t.gas):b.mul(30)}})),console.log("confirm txs",t),R(t)}),[Z]),ot=(0,e.useCallback)((function(t){if(!Z)return null;console.log("commit requested",t),G(t)}),[Z]);return(0,e.useEffect)((function(){if(Z&&j){E(void 0);var t=new bo({near:Z,code:j.parsedCode,setReactState:E,cache:X,refreshCache:function(){k((function(t){return t+1}))},confirmTransactions:nt,depth:a,widgetSrc:m,requestCommit:ot,version:je()(),widgetConfigs:V});return B(t),function(){t.stop()}}}),[m,Z,j,a,ot,nt,V]),(0,e.useEffect)((function(){Z&&C({loading:!1,accountId:null!=Q?Q:null,widgetSrc:m})}),[Z,Q,m]),(0,e.useLayoutEffect)((function(){if(P){var t={props:i||{},context:T,state:w,cacheNonce:S,version:P.version};if(!at(t,z)){J(it(t));try{var e;rt(null!==(e=P.renderCode(t))&&void 0!==e?e:"Execution failed")}catch(t){rt(o().createElement("div",{className:"alert alert-danger"},"Execution error:",o().createElement("pre",null,t.message),o().createElement("pre",null,t.stack))),console.error(t)}}}}),[P,i,T,w,S,z]),null!=et?o().createElement(wo.ErrorBoundary,{FallbackComponent:I,onReset:function(){rt(null)},resetKeys:[et]},o().createElement(o().Fragment,null,et,U&&o().createElement(Le,{transactions:U,onHide:function(){return R(null)}}),D&&o().createElement(Sr,{show:!0,widgetSrc:m,data:D.data,force:D.force,onHide:function(){return G(null)},onCommit:D.onCommit,onCancel:D.onCancel}))):A}})(),n})()));
'''
'''--- dist/index.js.LICENSE.txt ---
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */

/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */

/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */

'''
'''--- package.json ---
{
  "name": "near-atlas-vm",
  "version": "1.0.3",
  "description": "NEAR ATLAS VM",
  "main": "dist/index.js",
  "files": [
    "dist"
  ],
  "dependencies": {
    "@braintree/sanitize-url": "6.0.1",
    "@emotion/react": "^11.10.6",
    "@heroicons/react": "^2.0.18",
    "@table-library/react-table-library": "^4.1.0",
    "acorn": "^8.8.0",
    "acorn-jsx": "^5.3.2",
    "big.js": "^6.1.1",
    "bn.js": "^5.1.1",
    "bootstrap": "^5.2.1",
    "bootstrap-icons": "^1.9.0",
    "chart.js": "^4.2.1",
    "collections": "^5.1.12",
    "deep-equal": "^2.2.0",
    "elliptic": "^6.5.4",
    "idb": "^7.1.1",
    "local-storage": "^2.0.0",
    "mdast-util-find-and-replace": "^2.0.0",
    "near-api-js": "^0.45.1",
    "prettier": "^2.7.1",
    "react-bootstrap": "^2.5.0",
    "react-bootstrap-typeahead": "^6.0.0",
    "react-chartjs-2": "^5.2.0",
    "react-charts": "3.0.0-beta.55",
    "react-error-boundary": "^3.1.4",
    "react-files": "^3.0.0-alpha.3",
    "react-infinite-scroller": "^1.2.6",
    "react-markdown": "^7.1.0",
    "react-resizable": "^3.0.5",
    "react-singleton-hook": "^3.1.1",
    "react-syntax-highlighter": "^15.5.0",
    "react-table": "^7.8.0",
    "react-uuid": "^1.0.2",
    "remark-gfm": "^3.0.1",
    "styled-components": "^5.3.6",
    "tweetnacl": "^1.0.3"
  },
  "devDependencies": {
    "@babel/core": "^7.20.12",
    "@babel/preset-env": "^7.20.2",
    "@babel/preset-react": "^7.18.6",
    "@tailwindcss/forms": "^0.5.3",
    "@tailwindcss/typography": "^0.5.9",
    "autoprefixer": "^10.4.15",
    "babel-loader": "^9.1.2",
    "buffer": "^6.0.3",
    "clean-webpack-plugin": "^4.0.0",
    "copy-webpack-plugin": "^9.0.1",
    "cross-env": "^7.0.3",
    "crypto-browserify": "^3.12.0",
    "css-loader": "^6.2.0",
    "css-minimizer-webpack-plugin": "^3.0.2",
    "html-webpack-plugin": "^5.3.2",
    "https-browserify": "^1.0.0",
    "mini-css-extract-plugin": "^2.2.2",
    "node-sass": "^7.0.3",
    "os-browserify": "^0.3.0",
    "postcss": "^8.4.27",
    "postcss-import": "^15.1.0",
    "postcss-loader": "^7.0.1",
    "process": "^0.11.10",
    "sass-loader": "^13.1.0",
    "stream-browserify": "^3.0.0",
    "stream-http": "^3.2.0",
    "style-loader": "^3.2.1",
    "tailwindcss": "^3.3.2",
    "url": "^0.11.0",
    "webpack": "^5.76.0",
    "webpack-bundle-analyzer": "^4.4.2",
    "webpack-cli": "^4.8.0",
    "webpack-dev-server": "^4.1.0",
    "webpack-manifest-plugin": "^5.0.0",
    "webpack-merge": "^5.8.0",
    "webpack-node-externals": "^3.0.0"
  },
  "peerDependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "scripts": {
    "webpack": "webpack",
    "prod": "npm run webpack -- --env mode=production",
    "build": "npm run prod"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}

'''
'''--- postcss.config.js ---
module.exports = {
    plugins: {
      tailwindcss: {},
      autoprefixer: {},
    }
  }

'''
'''--- readme.md ---

'''
'''--- src/index.js ---
import React from "react";
import { useAccount, useAccountId } from "./lib/data/account";
import { useInitNear, useNear } from "./lib/data/near";
import { Widget } from "./lib/components/Widget";
import { useCache } from "./lib/data/cache";
import * as utils from "./lib/data/utils";
import { CommitButton } from "./lib/components/Commit";

export {
  Widget,
  CommitButton,
  useInitNear,
  useNear,
  useCache,
  useAccount,
  useAccountId,
  utils,
};

'''
'''--- src/lib/components/Commit.js ---
import React, { useCallback, useEffect, useState } from "react";
import {
  asyncCommit,
  prepareCommit,
  requestPermissionAndCommit,
} from "../data/commitData";
import {
  computeWritePermission,
  displayNear,
  Loading,
  StorageCostPerByte,
} from "../data/utils";
import Modal from "react-bootstrap/Modal";
import { Markdown } from "./Markdown";
import { useNear } from "../data/near";
import { ToggleButton, ToggleButtonGroup } from "react-bootstrap";
import { useCache } from "../data/cache";
import { useAccountId } from "../data/account";

const jsonMarkdown = (data) => {
  const json = JSON.stringify(data, null, 2);
  return `\`\`\`json
${json}
\`\`\``;
};

const StorageDomain = {
  page: "commit",
};

const StorageType = {
  WritePermission: "write_permission",
};

export const CommitModal = (props) => {
  const near = useNear();
  const accountId = useAccountId();
  const cache = useCache();

  const [asyncCommitStarted, setAsyncAsyncCommitStarted] = useState(false);
  const [extraStorage, setExtraStorage] = useState(0);
  const [commitInProgress, setCommitInProgress] = useState(false);

  const [lastData, setLastData] = useState(null);
  const [commit, setCommit] = useState(null);

  const [writePermission, setWritePermission] = useState(null);
  const [giveWritePermission, setGiveWritePermission] = useState(true);

  const showIntent = props.show;
  const onHide = props.onHide;
  const onCancel = () => {
    if (props.onCancel) {
      try {
        props.onCancel();
      } catch (e) {
        console.error(e);
      }
    }
    onHide();
  };
  const data = props.data;
  const force = props.force;
  const widgetSrc = props.widgetSrc;

  useEffect(() => {
    if (widgetSrc) {
      setWritePermission(null);
      cache
        .asyncLocalStorageGet(StorageDomain, {
          widgetSrc,
          accountId,
          type: StorageType.WritePermission,
        })
        .then((wp) => setWritePermission(wp));
    } else {
      setWritePermission(false);
    }
  }, [widgetSrc, accountId, cache, showIntent]);

  useEffect(() => {
    setGiveWritePermission(writePermission !== false);
  }, [writePermission]);

  useEffect(() => {
    if (commitInProgress || !showIntent || !accountId || !near) {
      return;
    }
    const jdata = JSON.stringify(data ?? null);
    if (!force && jdata === lastData) {
      return;
    }
    setLastData(jdata);
    setCommit(null);
    prepareCommit(near, accountId, data, force).then(setCommit);
  }, [commitInProgress, data, lastData, force, near, accountId, showIntent]);

  const onCommit = async () => {
    setCommitInProgress(true);

    const newWritePermission =
      giveWritePermission &&
      computeWritePermission(writePermission, commit.data[accountId]);
    cache.localStorageSet(
      StorageDomain,
      {
        widgetSrc,
        accountId,
        type: StorageType.WritePermission,
      },
      newWritePermission
    );
    setWritePermission(newWritePermission);

    const deposit = commit.deposit.add(StorageCostPerByte.mul(extraStorage));
    if (commit.permissionGranted) {
      await asyncCommit(near, commit.data, deposit);
    } else {
      if (accountId === near.accountId) {
        await requestPermissionAndCommit(near, commit.data, deposit);
      } else {
        // No permission for another account and not the owner. Can't commit.
        alert("No permission to commit under given account");
      }
    }
    setCommit(null);
    setLastData(null);
    if (props.onCommit) {
      try {
        props.onCommit(commit.data);
      } catch (e) {
        console.error(e);
      }
    }
    cache.invalidateCache(near, commit.data);
    onHide();
    setCommitInProgress(false);
  };

  const cantCommit =
    commit && !commit.permissionGranted && accountId !== near.accountId;

  if (
    !commitInProgress &&
    !cantCommit &&
    !asyncCommitStarted &&
    commit &&
    showIntent &&
    writePermission &&
    commit.data
  ) {
    const deposit = commit.deposit.add(StorageCostPerByte.mul(extraStorage));
    if (deposit.eq(0) && commit.permissionGranted) {
      if (
        JSON.stringify(
          computeWritePermission(writePermission, commit.data[accountId])
        ) === JSON.stringify(writePermission)
      ) {
        setAsyncAsyncCommitStarted(true);
        onCommit().then(() => setAsyncAsyncCommitStarted(false));
      }
    }
  }

  const show =
    !!commit && showIntent && !asyncCommitStarted && writePermission !== null;
    if (!show) return null;
    return (
      <div className="fixed top-0 left-0 w-full h-full flex justify-center items-center z-40">
        <div className="bg-white rounded-lg overflow-y-auto max-h-full w-3/4 z-50">
          <div className="flex justify-between items-center p-4 border-b border-gray-200">
            <h5 className="text-lg font-medium">Saving data</h5>
            <button onClick={onCancel} className="text-gray-500 hover:text-gray-700 focus:outline-none">
              &times;
            </button>
          </div>
          <div className="p-4">

        {cantCommit ? (
          <div>
            <h5>
              Can't commit, because the account {near.accountId} doesn't have
              permission to write under pretended account {accountId}
            </h5>
          </div>
        ) : commit ? (
          <div>
            <div>
              {commit.data ? (
                <Markdown text={jsonMarkdown(commit.data)} />
              ) : (
                <h5>No new data to save</h5>
              )}
            </div>
            {commit.data && commit?.deposit?.gt(0) && (
              <div>
                <h6>
                  Required storage deposit{" "}
                  <small className="text-secondary">
                    (can be recovered later)
                  </small>
                </h6>
                <div className="mb-2">
                  {commit.deposit.div(StorageCostPerByte).toFixed(0)} bytes ={" "}
                  {displayNear(commit.deposit)}
                </div>
                <h6>
                  Optional storage deposit{" "}
                  <small className="text-secondary">
                    (can be used to avoid future wallet TX confirmation)
                  </small>
                </h6>
                <div>
                  <ToggleButtonGroup
                    type="radio"
                    name="storageDeposit"
                    value={extraStorage}
                    onChange={setExtraStorage}
                    disabled={commitInProgress}
                  >
                    <ToggleButton
                      id="esd-0"
                      variant="outline-success"
                      value={0}
                    >
                      No Deposit
                    </ToggleButton>
                    <ToggleButton
                      id="esd-5000"
                      variant="outline-success"
                      value={5000}
                    >
                      0.05 NEAR (5Kb)
                    </ToggleButton>
                    <ToggleButton
                      id="esd-20000"
                      variant="outline-success"
                      value={20000}
                    >
                      0.2 NEAR (20Kb)
                    </ToggleButton>
                    <ToggleButton
                      id="esd-100000"
                      variant="outline-success"
                      value={100000}
                    >
                      1 NEAR (100Kb)
                    </ToggleButton>
                  </ToggleButtonGroup>
                </div>
              </div>
            )}
            {!cantCommit && widgetSrc && commit.data && (
              <div className="form-check form-switch">
                <input
                  className="form-check-input"
                  type="checkbox"
                  role="switch"
                  id="dont-ask-for-widget"
                  checked={giveWritePermission}
                  onChange={(e) => {
                    setGiveWritePermission(e.target.checked);
                  }}
                />
                <label
                  className="form-check-label"
                  htmlFor="dont-ask-for-widget"
                >
                  Don't ask again for saving similar data by{" "}
                  <span className="font-monospace">{widgetSrc}</span>
                </label>
              </div>
            )}
          </div>
        ) : (
          Loading
        )}

          </div>
          <div className="flex justify-between p-4 border-t border-gray-200">
            <button
              className="px-4 py-2 rounded-md text-white bg-green-500 hover:bg-green-600"
              disabled={!commit?.data || commitInProgress || cantCommit}
              onClick={(e) => {
                e.preventDefault();
                onCommit();
              }}
            >
              {commitInProgress ? "Loading..." : "Save Data"}
            </button>
            <button
              className="px-4 py-2 rounded-md text-gray-500 border border-gray-300 hover:bg-gray-100"
              onClick={onCancel}
              disabled={commitInProgress}
            >
              Close
            </button>
          </div>
        </div>
        <div className="fixed top-0 left-0 w-full h-full bg-black opacity-50 z-30" onClick={onCancel}></div>
      </div>
    );
};

export const CommitButton = (props) => {
  const accountId = useAccountId();

  const {
    data,
    children,
    onClick,
    onCommit,
    onCancel,
    disabled,
    widgetSrc,
    force,
    ...rest
  } = props;

  const [computedData, setComputedData] = useState(null);

  return (
    <>
      <button
        {...rest}
        className={`px-4 py-2 ${disabled || !data || !!computedData || !accountId ? "bg-gray-400 cursor-not-allowed" : "bg-blue-500 hover:bg-blue-600 text-white"} rounded-md`}
        onClick={(e) => {
          e.preventDefault();
          setComputedData(typeof data === "function" ? data() : data);
          if (onClick) {
            onClick();
          }
        }}
      >
        {!!computedData ? "Loading..." : children}
      </button>
      <CommitModal
        show={!!computedData}
        widgetSrc={widgetSrc}
        data={computedData}
        force={force}
        onHide={() => setComputedData(null)}
        onCancel={onCancel}
        onCommit={onCommit}
      />
    </>
  );
};

'''
'''--- src/lib/components/ConfirmTransactions.js ---
import React, { useState } from "react";
import Modal from "react-bootstrap/Modal";
import { Markdown } from "./Markdown";
import { displayGas, displayNear, Loading } from "../data/utils";
import { useNear } from "../data/near";
import uuid from "react-uuid";

const jsonMarkdown = (data) => {
  const json = JSON.stringify(data, null, 2);
  return `\`\`\`json
${json}
\`\`\``;
};

export default function ConfirmTransactions(props) {
  const gkey = useState(uuid());
  const near = useNear();
  const [loading, setLoading] = useState(false);

  const onHide = props.onHide;
  const transactions = props.transactions;
  const show = !!transactions;

  return (
    <Modal size="xl" centered scrollable show={show} onHide={onHide}>
      <Modal.Header closeButton>
        <Modal.Title>Confirm Transaction</Modal.Title>
      </Modal.Header>
      <Modal.Body>
        {transactions &&
          transactions.map((transaction, i) => (
            <div key={`${gkey}-${i}`}>
              <div>
                <h4>Transaction #{i + 1}</h4>
              </div>
              <div>
                <span className="text-secondary">Contract ID: </span>
                <span className="font-monospace">
                  {transaction.contractName}
                </span>
              </div>
              <div>
                <span className="text-secondary">Method name: </span>
                <span className="font-monospace">{transaction.methodName}</span>
              </div>
              {transaction.deposit && transaction.deposit.gt(0) && (
                <div>
                  <span className="text-secondary">Deposit: </span>
                  <span className="font-monospace">
                    {displayNear(transaction.deposit)}
                  </span>
                </div>
              )}
              <div>
                <span className="text-secondary">Gas: </span>
                <span className="font-monospace">
                  {displayGas(transaction.gas)}
                </span>
              </div>
              <Markdown text={jsonMarkdown(transaction.args)} />
            </div>
          ))}
      </Modal.Body>
      <Modal.Footer>
        <button
          className="btn btn-success"
          disabled={loading}
          onClick={(e) => {
            e.preventDefault();
            setLoading(true);
            near.sendTransactions(transactions).then(() => {
              setLoading(false);
              onHide();
            });
          }}
        >
          {loading && Loading} Confirm
        </button>
        <button
          className="btn btn-secondary"
          onClick={onHide}
          disabled={loading}
        >
          Close
        </button>
      </Modal.Footer>
    </Modal>
  );
}

'''
'''--- src/lib/components/Markdown.js ---
import gfm from "remark-gfm";
import ReactMarkdown from "react-markdown";
import { Prism as SyntaxHighlighter } from "react-syntax-highlighter";
import { tomorrow } from "react-syntax-highlighter/dist/esm/styles/prism";
import React from "react";
import mentions from "./remark/mentions";
import hashtags from "./remark/hashtags";

export const Markdown = (props) => {
  const { onLinkClick, text, onMention, onHashtag, syntaxHighlighterProps, ...rest } = props;
  return (
    <ReactMarkdown
      {...rest}
      plugins={[]}
      rehypePlugins={[]}
      remarkPlugins={[gfm, mentions, hashtags]}
      children={text}
      components={{
        strong({ node, children, ...props }) {
          if (onMention && node.properties?.accountId) {
            return onMention(node.properties?.accountId);
          } else if (onHashtag && node.properties?.hashtag) {
            return onHashtag(node.properties?.hashtag);
          }
          return <strong {...props}>{children}</strong>;
        },
        a: ({ node, ...props }) =>
          onLinkClick ? (
            <a onClick={onLinkClick} {...props} />
          ) : (
            <a target="_blank" {...props} />
          ),
        img: ({ node, ...props }) => <img className="img-fluid" {...props} />,
        blockquote: ({ node, ...props }) => (
          <blockquote className="blockquote" {...props} />
        ),
        table: ({ node, ...props }) => (
          <table className="table table-striped" {...props} />
        ),
        code({ node, inline, className, children, ...props }) {
          const match = /language-(\w+)/.exec(className || "");
          const {
            wrapLines,
            lineProps,
            showLineNumbers,
            lineNumberStyle
           } = syntaxHighlighterProps ?? {};

          return !inline && match ? (
            <SyntaxHighlighter
              children={String(children).replace(/\n$/, "")}
              style={tomorrow}
              language={match[1]}
              PreTag="div"
              {...{ wrapLines, lineProps, showLineNumbers, lineNumberStyle }}
              {...props}
            />
          ) : (
            <code className={className} {...props}>
              {children}
            </code>
          );
        },
      }}
    />
  );
};

'''
'''--- src/lib/components/SecureIframe.js ---
import React, { useCallback, useEffect, useState } from "react";
import { deepCopy, deepEqual } from "../data/utils";

export default function SecureIframe(allProps) {
  const { className, style, src, srcDoc, title, message, onMessage } = allProps;
  const usedProps = { className, style, src, srcDoc, title };

  const [loaded, setLoaded] = useState(false);
  const [prevMessage, setPrevMessage] = useState(undefined);
  const ref = React.useRef();

  const onMessageEvent = useCallback(
    (event) => {
      if (event.source !== ref.current.contentWindow) {
        return;
      }
      onMessage && onMessage(event.data);
    },
    [ref, onMessage]
  );

  useEffect(() => {
    window.addEventListener("message", onMessageEvent, false);
    return () => {
      window.removeEventListener("message", onMessageEvent, false);
    };
  }, [onMessageEvent]);

  useEffect(() => {
    if (ref.current && loaded && !deepEqual(prevMessage, message)) {
      setPrevMessage(deepCopy(message));
      ref.current.contentWindow.postMessage(message, "*");
    }
  }, [message, ref, loaded, prevMessage]);

  useEffect(() => {
    setLoaded(false);
  }, [src, srcDoc]);

  return (
    <iframe
      {...usedProps}
      ref={ref}
      sandbox="allow-scripts"
      onLoad={() => setLoaded(true)}
    />
  );
}

'''
'''--- src/lib/components/Widget.js ---
import React, {
  useCallback,
  useEffect,
  useLayoutEffect,
  useState,
} from "react";
import { Parser } from "acorn";
import jsx from "acorn-jsx";
import { useNear } from "../data/near";
import ConfirmTransactions from "./ConfirmTransactions";
import VM from "../vm/vm";
import {
  deepCopy,
  deepEqual,
  ErrorFallback,
  isObject,
  isString,
  Loading,
  TGas,
} from "../data/utils";
import { ErrorBoundary } from "react-error-boundary";
import { useCache } from "../data/cache";
import { CommitModal } from "./Commit";
import { useAccountId } from "../data/account";
import Big from "big.js";
import uuid from "react-uuid";
import { isFunction } from "react-bootstrap-typeahead/types/utils";

const AcornOptions = {
  ecmaVersion: 13,
  allowReturnOutsideFunction: true,
};

const ParsedCodeCache = {};
const JsxParser = Parser.extend(jsx());

const parseCode = (code) => {
  if (code in ParsedCodeCache) {
    return ParsedCodeCache[code];
  }
  return (ParsedCodeCache[code] = JsxParser.parse(code, AcornOptions));
};

const computeSrcOrCode = (src, code, configs) => {
  let srcOrCode = src ? { src } : code ? { code } : null;
  for (const config of configs || []) {
    if (srcOrCode?.src) {
      const src = srcOrCode.src;
      let value = isObject(config?.redirectMap) && config.redirectMap[src];
      if (!value) {
        try {
          value = isFunction(config?.redirect) && config.redirect(src);
        } catch {}
      }
      if (isString(value)) {
        srcOrCode = { src: value };
      } else if (isString(value?.code)) {
        return { code: value.code };
      }
    }
  }
  return srcOrCode;
};

export function Widget(props) {
  const propsSrc = props.src;
  const propsCode = props.code;
  const propsProps = props.props;
  const depth = props.depth || 0;
  const propsConfig = props.config;

  const [nonce, setNonce] = useState(0);
  const [code, setCode] = useState(null);
  const [src, setSrc] = useState(null);
  const [state, setState] = useState(undefined);
  const [cacheNonce, setCacheNonce] = useState(0);
  const [parsedCode, setParsedCode] = useState(null);
  const [context, setContext] = useState({});
  const [vm, setVm] = useState(null);
  const [transactions, setTransactions] = useState(null);
  const [commitRequest, setCommitRequest] = useState(null);
  const [prevVmInput, setPrevVmInput] = useState(null);
  const [configs, setConfigs] = useState(null);
  const [srcOrCode, setSrcOrCode] = useState(null);

  const cache = useCache();
  const near = useNear();
  const accountId = useAccountId();
  const [element, setElement] = useState(null);

  useEffect(() => {
    const newConfigs = propsConfig
      ? Array.isArray(propsConfig)
        ? propsConfig
        : [propsConfig]
      : [];
    if (!deepEqual(newConfigs, configs)) {
      setConfigs(newConfigs);
    }
  }, [propsConfig, configs]);

  useEffect(() => {
    const computedSrcOrCode = computeSrcOrCode(propsSrc, propsCode, configs);
    if (!deepEqual(computedSrcOrCode, srcOrCode)) {
      setSrcOrCode(computedSrcOrCode);
    }
  }, [propsSrc, propsCode, configs, srcOrCode]);

  useEffect(() => {
    if (!near) {
      return;
    }
    if (srcOrCode?.src) {
      const src = srcOrCode.src;
      const code = cache.socialGet(
        near,
        src.toString(),
        false,
        undefined,
        undefined,
        () => {
          setNonce(nonce + 1);
        }
      );
      setCode(code);
      setSrc(src);
    } else if (srcOrCode?.code) {
      setCode(srcOrCode.code);
      setSrc(null);
    }
  }, [near, srcOrCode, nonce]);

  useEffect(() => {
    setVm(null);
    setElement(null);
    if (!code) {
      if (code === undefined) {
        setElement(
          <div className="alert alert-danger">
            Source code for "{src}" is not found
          </div>
        );
      }
      return;
    }
    try {
      const parsedCode = parseCode(code);
      setParsedCode({ parsedCode });
    } catch (e) {
      setElement(
        <div className="alert alert-danger">
          Compilation error:
          <pre>{e.message}</pre>
          <pre>{e.stack}</pre>
        </div>
      );
      console.error(e);
    }
  }, [code, src]);

  const confirmTransactions = useCallback(
    (transactions) => {
      if (!near || !transactions || transactions.length === 0) {
        return null;
      }
      transactions = transactions.map((t) => ({
        contractName: t.contractName,
        methodName: t.methodName,
        args: t.args || {},
        deposit: t.deposit ? Big(t.deposit) : Big(0),
        gas: t.gas ? Big(t.gas) : TGas.mul(30),
      }));
      console.log("confirm txs", transactions);
      setTransactions(transactions);
    },
    [near]
  );

  const requestCommit = useCallback(
    (commitRequest) => {
      if (!near) {
        return null;
      }
      console.log("commit requested", commitRequest);
      setCommitRequest(commitRequest);
    },
    [near]
  );

  useEffect(() => {
    if (!near || !parsedCode) {
      return;
    }
    setState(undefined);
    const vm = new VM({
      near,
      code: parsedCode.parsedCode,
      setReactState: setState,
      cache,
      refreshCache: () => {
        setCacheNonce((cacheNonce) => cacheNonce + 1);
      },
      confirmTransactions,
      depth,
      widgetSrc: src,
      requestCommit,
      version: uuid(),
      widgetConfigs: configs,
    });
    setVm(vm);
    return () => {
      vm.stop();
    };
  }, [
    src,
    near,
    parsedCode,
    depth,
    requestCommit,
    confirmTransactions,
    configs,
  ]);

  useEffect(() => {
    if (!near) {
      return;
    }
    setContext({
      loading: false,
      accountId: accountId ?? null,
      widgetSrc: src,
    });
  }, [near, accountId, src]);

  useLayoutEffect(() => {
    if (!vm) {
      return;
    }
    const vmInput = {
      props: propsProps || {},
      context,
      state,
      cacheNonce,
      version: vm.version,
    };
    if (deepEqual(vmInput, prevVmInput)) {
      return;
    }
    setPrevVmInput(deepCopy(vmInput));
    try {
      setElement(vm.renderCode(vmInput) ?? "Execution failed");
    } catch (e) {
      setElement(
        <div className="alert alert-danger">
          Execution error:
          <pre>{e.message}</pre>
          <pre>{e.stack}</pre>
        </div>
      );
      console.error(e);
    }
  }, [vm, propsProps, context, state, cacheNonce, prevVmInput]);

  return element !== null && element !== undefined ? (
    <ErrorBoundary
      FallbackComponent={ErrorFallback}
      onReset={() => {
        setElement(null);
      }}
      resetKeys={[element]}
    >
      <>
        {element}
        {transactions && (
          <ConfirmTransactions
            transactions={transactions}
            onHide={() => setTransactions(null)}
          />
        )}
        {commitRequest && (
          <CommitModal
            show={true}
            widgetSrc={src}
            data={commitRequest.data}
            force={commitRequest.force}
            onHide={() => setCommitRequest(null)}
            onCommit={commitRequest.onCommit}
            onCancel={commitRequest.onCancel}
          />
        )}
      </>
    </ErrorBoundary>
  ) : (
    Loading
  );
}

'''
'''--- src/lib/components/graphs/BarEl.js ---

import React from "react";

import {
    Chart as ChartJS,
    CategoryScale,
    LinearScale,
    BarElement,
    Title,
    Tooltip,
    Legend,
  } from 'chart.js';

  import { Bar } from 'react-chartjs-2';

  ChartJS.register(
    CategoryScale,
    LinearScale,
    BarElement,
    Title,
    Tooltip,
    Legend
  );

  export const BarEl = (props) => {
    const { options, data } = props;
    return (
        <Bar options={options} data={data} />
    );
  }
'''
'''--- src/lib/components/graphs/BubbleEl.js ---
import React from 'react';

import {
    Chart as ChartJS,
    LinearScale,
    PointElement,
    Tooltip,
    Legend,
  } from 'chart.js';

  import { Bubble } from 'react-chartjs-2';

  ChartJS.register(LinearScale, PointElement, Tooltip, Legend);

  export const BubbleEl = (props) => {
    const { options, data } = props;
    return (
        <Bubble options={options} data={data} />
    );
  }
'''
'''--- src/lib/components/graphs/ChartEl.js ---
import React from "react";

import {
    Chart as ChartJS,
    LinearScale,
    CategoryScale,
    BarElement,
    PointElement,
    LineElement,
    Legend,
    Tooltip,
    LineController,
    BarController,
  } from 'chart.js';
  import { Chart } from 'react-chartjs-2';

  ChartJS.register(
    LinearScale,
    CategoryScale,
    BarElement,
    PointElement,
    LineElement,
    Legend,
    Tooltip,
    LineController,
    BarController
  );

  export const ChartEl = (props) => {
    const { type, data, options } = props;
    return (
        <Chart type={type} data={data} options={options} />
    );
  }
'''
'''--- src/lib/components/graphs/CohortEl.js ---
import React from "react";

export const CohortEl = (props) => {
  const { data, minRowsShown = 5 } = props; // add default value for minRowsShown

  // Ensure data is an array
  if (!Array.isArray(data)) {
    return <div>Error: Data is not an array.</div>;
  }

  // Transform data for easier rendering
  const transformedData = data.reduce((acc, curr) => {
    if (!acc[curr.CREATED_MONTH]) acc[curr.CREATED_MONTH] = [];
    acc[curr.CREATED_MONTH].push(curr);
    return acc;
  }, {});

  const maxMonths = Math.max(...data.map((item) => item.MONTHS_SINCE));

  function getColorForRetentionRate(rate) {
    if (rate <= 0.1) return "bg-teal-200 text-black";
    if (rate <= 0.2) return "bg-teal-300 text-black";
    if (rate <= 0.3) return "bg-teal-400 text-black";
    if (rate <= 0.4) return "bg-teal-500 text-white";
    if (rate <= 0.5) return "bg-teal-600 text-white";
    if (rate <= 0.6) return "bg-teal-700 text-white";
    if (rate <= 0.7) return "bg-teal-800 text-white";
    if (rate <= 0.8) return "bg-teal-900 text-white";
    return "bg-teal-900 text-white"; // default case if rate > 0.8
  }
  const calculatedHeight = `${minRowsShown * 50}px`;
  const minContainerWidth = (maxMonths + 2) * 150;
  const formatNumber = (num) => num.toLocaleString();
  // Determine the maximum cohort size for normalization
  const maxCohortSize = Math.max(...data.map((item) => item.COHORT_SIZE));

// Determine the total cohort size
const totalCohortSize = data.reduce((sum, item) => sum + (item.COHORT_SIZE || 0), 0);
// Function to get gradient color for the entire Users column
const getUsersColumnGradient = () => {
  const averageSize = totalCohortSize / data.length;
  const percentage = (averageSize / maxCohortSize) * 100;
  return `bg-gradient-to-b from-teal-400 via-teal-${Math.min(900, Math.max(400, Math.round(percentage / 10) * 100))} to-teal-400`;
};

return (
  <div className="w-full h-[650px] overflow-x-auto overflow-y-auto border border-gray-700 rounded bg-gray-800 text-white">
    <div style={{ minWidth: `${minContainerWidth}px`, maxHeight: calculatedHeight }}>
      <div className="grid grid-cols-[repeat(auto-fill,minmax(100px,1fr))] gap-2 p-2 border-t border-gray-600 hover:bg-gray-700">
        <div className="col-span-1 p-2">Time</div>
        <div className={`col-span-1 p-2 ${getUsersColumnGradient()}`}>Users</div>
        {Array.from({ length: maxMonths + 1 }).map((_, idx) => (
          <div className="col-span-1 p-2" key={idx}>
            Month {idx}
          </div>
        ))}
      </div>
      {Object.keys(transformedData)
        .sort((a, b) => new Date(b) - new Date(a))
        .map((cohortMonth) => (
          <div key={cohortMonth} className="border-b border-gray-700">
            <div className="grid grid-cols-[repeat(auto-fill,minmax(100px,1fr))] gap-2 p-2 border-t border-gray-600 hover:bg-gray-700">
              <div className="col-span-1 p-2">
                {`${new Date(cohortMonth).toLocaleString("default", { month: "long" })} / ${new Date(cohortMonth).getFullYear()}`}
              </div>
              <div className={`col-span-1 p-2 ${getUsersColumnGradient()}`}>
                {(transformedData[cohortMonth].find((entry) => entry.MONTHS_SINCE === 0)?.COHORT_SIZE || 0).toLocaleString()}
              </div>
              {Array.from({ length: maxMonths }).map((_, idx) => {
                const entry = transformedData[cohortMonth].find((entry) => entry.MONTHS_SINCE === idx + 1);
                return (
                  <div className={`col-span-1 p-2 border border-gray-500 ${entry ? getColorForRetentionRate(entry.RETENTION_RATE) : ""}`} key={idx}>
                    {entry ? Math.round(entry.RETENTION_RATE * 100) + "%" : "-"}
                  </div>
                );
              })}
            </div>
          </div>
        ))}
    </div>
  </div>
);

};

'''
'''--- src/lib/components/graphs/LineEl.js ---
import React from "react";

import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Title,
  Tooltip,
  Filler,
  Legend,
  } from 'chart.js';
  import { Line } from 'react-chartjs-2';

  ChartJS.register(
    CategoryScale,
    LinearScale,
    PointElement,
    LineElement,
    Title,
    Tooltip,
    Filler,
    Legend
  );

  export const LineEl = (props) => {
    const { options, data } = props;
    return (
        <Line options={options} data={data} />
    );
  }
'''
'''--- src/lib/components/graphs/PieEl.js ---
import React from "react";

import { Chart as ChartJS, ArcElement, Tooltip, Legend } from 'chart.js';
import { Pie } from 'react-chartjs-2';
ChartJS.register(ArcElement, Tooltip, Legend);

  export const PieEl = (props) => {
    const { data } = props;
    return (
        <Pie data={data} />
    );
  }
'''
'''--- src/lib/components/graphs/ScatterEl.js ---
import React from 'react';

import {
    Chart as ChartJS,
    LinearScale,
    PointElement,
    LineElement,
    Tooltip,
    Legend,
  } from 'chart.js';

  import { Scatter } from 'react-chartjs-2';

  ChartJS.register(LinearScale, PointElement, LineElement, Tooltip, Legend);

  export const ScatterEl = (props) => {
    const { options, data } = props;
    return (
        <Scatter options={options} data={data} />
    );
  }
'''
'''--- src/lib/components/react_chart/ResizableBox.js ---
import React from "react";
import { ResizableBox as ReactResizableBox } from "react-resizable";

import "react-resizable/css/styles.css";

export default function ResizableBox({
  children,
  width = 600,
  height = 300,
  resizable = true,
  style = {},
  className = "",
}) {
  return (
    <div style={{ marginLeft: 20 }}>
      <div
        style={{
          display: "inline-block",
          width: "auto",
          background: "white",
          padding: ".5rem",
          borderRadius: "0.5rem",
          boxShadow: "0 30px 40px rgba(0,0,0,.1)",
          ...style,
        }}
      >
        {resizable ? (
          <ReactResizableBox width={width} height={height}>
            <div
              style={{
                width: "100%",
                height: "100%",
              }}
              className={className}
            >
              {children}
            </div>
          </ReactResizableBox>
        ) : (
          <div
            style={{
              width: `${width}px`,
              height: `${height}px`,
            }}
            className={className}
          >
            {children}
          </div>
        )}
      </div>
    </div>
  );
}

'''
'''--- src/lib/components/react_chart/components/Area.js ---
import ResizableBox from "../ResizableBox";
import useDemoConfig from "../useDemoConfig";
import React from "react";
import { Chart } from "react-charts";

export default function Bar() {
  const { data, randomizeData } = useDemoConfig({
    series: 10,
    dataType: "time",
  });

  const primaryAxis = React.useMemo(
    () => ({
      getValue: (datum) => datum.primary,
    }),
    []
  );

  const secondaryAxes = React.useMemo(
    () => [
      {
        getValue: (datum) => datum.secondary,
        stacked: true,
        // OR
        // elementType: "area",
      },
    ],
    []
  );

console.log("data", data);
console.log("primaryAxis", primaryAxis);
console.log("secondaryAxes", secondaryAxes);

  return (
    <>
      <button onClick={randomizeData}>Randomize Data</button>
      <br />
      <br />
      <ResizableBox>
        <Chart
          options={{
            data,
            primaryAxis,
            secondaryAxes,
          }}
        />
      </ResizableBox>
    </>
  );
}

'''
'''--- src/lib/components/react_chart/components/Band.js ---

'''
'''--- src/lib/components/react_chart/components/Bar.js ---
import ResizableBox from "../ResizableBox";
import useDemoConfig from "../useDemoConfig";
import React from "react";
import { Chart } from "react-charts";

export default function Bar() {
  const { data, randomizeData } = useDemoConfig({
    series: 3,
    dataType: "ordinal",
  });

  const primaryAxis = React.useMemo(
    () => ({
      getValue: (datum) => datum.primary,
    }),
    []
  );

  const secondaryAxes = React.useMemo(
    () => [
      {
        getValue: (datum) => datum.secondary,
      },
    ],
    []
  );

  console.log("data", data);
  console.log("primaryAxis", primaryAxis);
  console.log("secondaryAxes", secondaryAxes);

  return (
    <>
      <button onClick={randomizeData}>Randomize Data</button>
      <br />
      <br />
      <ResizableBox>
        <Chart
          options={{
            data,
            primaryAxis,
            secondaryAxes,
          }}
        />
      </ResizableBox>
    </>
  );
}

'''
'''--- src/lib/components/react_chart/components/BarHorizontal.js ---
import ResizableBox from "../ResizableBox";
import useDemoConfig from "../useDemoConfig";
import React from "react";
import { Chart } from "react-charts";

export default function Bar() {
  const { data, randomizeData } = useDemoConfig({
    series: 3,
    dataType: "ordinal",
  });

  const primaryAxis = React.useMemo(
    () => ({
      position: "left",
      getValue: (datum) => datum.primary,
    }),
    []
  );

  const secondaryAxes = React.useMemo(
    () => [
      {
        position: "bottom",
        getValue: (datum) => datum.secondary,
      },
    ],
    []
  );

  console.log("data", data);
  console.log("primaryAxis", primaryAxis);
  console.log("secondaryAxes", secondaryAxes);

  return (
    <>
      <button onClick={randomizeData}>Randomize Data</button>
      <br />
      <br />
      <ResizableBox>
        <Chart
          options={{
            data,
            primaryAxis,
            secondaryAxes,
          }}
        />
      </ResizableBox>
    </>
  );
}

'''
'''--- src/lib/components/react_chart/components/BarHorizontalStacked.js ---
import ResizableBox from "../ResizableBox";
import useDemoConfig from "../useDemoConfig";
import React from "react";
import { Chart } from "react-charts";

export default function BarStacked() {
  const { data, randomizeData } = useDemoConfig({
    series: 10,
    dataType: "ordinal",
  });

  const primaryAxis = React.useMemo(
    () => ({
      getValue: (datum) => datum.primary,
    }),
    []
  );

  const secondaryAxes = React.useMemo(
    () => [
      {
        getValue: (datum) => datum.secondary,
        stacked: true,
      },
    ],
    []
  );

  console.log("data", data);
  console.log("primaryAxis", primaryAxis);
  console.log("secondaryAxes", secondaryAxes);

  return (
    <>
      <button onClick={randomizeData}>Randomize Data</button>
      <br />
      <br />
      <ResizableBox>
        <Chart
          options={{
            data,
            primaryAxis,
            secondaryAxes,
          }}
        />
      </ResizableBox>
    </>
  );
}

'''
'''--- src/lib/components/react_chart/components/BarStacked.js ---

'''
'''--- src/lib/components/react_chart/components/Bubble.js ---
import ResizableBox from "../ResizableBox";
import useDemoConfig from "../useDemoConfig";
import React from "react";
import { Chart } from "react-charts";

export default function Bubble() {
  const { data, randomizeData } = useDemoConfig({
    series: 10,
    dataType: "linear",
    useR: true,
  });

  const primaryAxis = React.useMemo(
    () => ({
      getValue: (datum) => datum.primary,
    }),
    []
  );

  const secondaryAxes = React.useMemo(
    () => [
      {
        getValue: (datum) => datum.secondary,
        elementType: "bubble",
      },
    ],
    []
  );

  console.log("data", data);
  console.log("primaryAxis", primaryAxis);
  console.log("secondaryAxes", secondaryAxes);

  return (
    <>
      <button onClick={randomizeData}>Randomize Data</button>
      <br />
      <br />
      <ResizableBox>
        <Chart
          options={{
            data,
            primaryAxis,
            secondaryAxes,
            interactionMode: "closest",
            getDatumStyle: (datum) => ({
              circle: { r: datum.originalDatum.radius },
            }),
          }}
        />
      </ResizableBox>
    </>
  );
}

'''
'''--- src/lib/components/react_chart/components/CustomStyles.js ---

'''
'''--- src/lib/components/react_chart/components/DarkMode.js ---
import ResizableBox from "../ResizableBox";
import useDemoConfig from "../useDemoConfig";
import React from "react";
import { Chart } from "react-charts";

export default function DarkMode() {
  const { data, randomizeData } = useDemoConfig({
    series: 10,
    dataType: "time",
  });

  const primaryAxis = React.useMemo(
    () => ({
      getValue: (datum) => datum.primary,
    }),
    []
  );

  const secondaryAxes = React.useMemo(
    () => [
      {
        getValue: (datum) => datum.secondary,
      },
    ],
    []
  );

  console.log("data", data);
  console.log("primaryAxis", primaryAxis);
  console.log("secondaryAxes", secondaryAxes);

  return (
    <>
      <button onClick={randomizeData}>Randomize Data</button>
      <br />
      <br />
      <ResizableBox
        style={{
          background: "rgba(0, 27, 45, 0.9)",
          padding: ".5rem",
          borderRadius: "5px",
        }}
      >
        <div style={{ width: "100%", height: "100%" }}>
          <Chart
            options={{
              data,
              primaryAxis,
              secondaryAxes,
              dark: true,
            }}
          />
        </div>
      </ResizableBox>
    </>
  );
}

'''
'''--- src/lib/components/react_chart/components/DynamicContainer.js ---
import useDemoConfig from "../useDemoConfig";
import React from "react";
import { Chart } from "react-charts";

export default function DyanmicContainer() {
  const { data, randomizeData } = useDemoConfig({
    series: 10,
    dataType: "time",
  });

  const primaryAxis = React.useMemo(
    () => ({
      getValue: (datum) => datum.primary,
    }),
    []
  );

  const secondaryAxes = React.useMemo(
    () => [
      {
        getValue: (datum) => datum.secondary,
      },
    ],
    []
  );

  console.log("data", data);
  console.log("primaryAxis", primaryAxis);
  console.log("secondaryAxes", secondaryAxes);

  return (
    <>
      <p>
        This example demos a chart's ability to position itself responsively in
        elements while respecting the box-model (margin, padding, and borders).
        It also showcases the tooltip's ability to portal outside of an overflow
        element (the blue border-box).
      </p>
      <button onClick={randomizeData}>Randomize Data</button>
      <br />
      <br />
      <div
        style={{
          display: "flex",
          flexDirection: "column",
          padding: "12px",
          border: "2px solid black",
          height: "400px",
        }}
      >
        <div
          style={{
            flex: "0 0 auto",
            padding: "10px",
            border: "1px solid red",
          }}
        >
          Header
        </div>
        <div
          style={{
            flex: 2,
            border: "5px solid blue",
            maxHeight: "400px",
            margin: "10px",
            overflow: "hidden",
          }}
        >
          <Chart
            options={{
              data,
              primaryAxis,
              secondaryAxes,
            }}
          />
        </div>
      </div>
    </>
  );
}

'''
'''--- src/lib/components/react_chart/components/InteractionMode.js ---

'''
'''--- src/lib/components/react_chart/components/Line.js ---
import ResizableBox from "../ResizableBox";
import useDemoConfig from "../useDemoConfig";
import React from "react";
import { Chart } from "react-charts";

export default function MultipleAxes() {
  const { data, randomizeData } = useDemoConfig({
    series: 6,
    dataType: "time",
  });

  data.forEach((d, i) => (d.secondaryAxisId = i > 2 ? "2" : undefined));

  const primaryAxis = React.useMemo(
    () => ({
      getValue: (datum) => datum.primary,
      // Pad the automatically detected time scale with half of the band-size
      padBandRange: true,
    }),
    []
  );

  const secondaryAxes = React.useMemo(
    () => [
      {
        getValue: (datum) => datum.secondary,
        elementType: "bar",
        // stacked: true,
      },
      {
        id: "2",
        getValue: (datum) => datum.secondary,
        elementType: "line",
      },
    ],
    []
  );

  console.log("data", data);
  console.log("primaryAxis", primaryAxis);
  console.log("secondaryAxes", secondaryAxes);

  return (
    <>
      <button onClick={randomizeData}>Randomize Data</button>
      <br />
      <br />
      <ResizableBox>
        <Chart
          options={{
            data,
            primaryAxis,
            secondaryAxes,
          }}
        />
      </ResizableBox>
    </>
  );
}

'''
'''--- src/lib/components/react_chart/components/MultipleAxes.js ---
import ResizableBox from "../ResizableBox";
import useDemoConfig from "../useDemoConfig";
import React from "react";
import { Chart } from "react-charts";

export default function MultipleAxes() {
  const { data, randomizeData } = useDemoConfig({
    series: 6,
    dataType: "time",
  });

  data.forEach((d, i) => (d.secondaryAxisId = i > 2 ? "2" : undefined));

  const primaryAxis = React.useMemo(
    () => ({
      getValue: (datum) => datum.primary,
      // Pad the automatically detected time scale with half of the band-size
      padBandRange: true,
    }),
    []
  );

  const secondaryAxes = React.useMemo(
    () => [
      {
        getValue: (datum) => datum.secondary,
        elementType: "bar",
        // stacked: true,
      },
      {
        id: "2",
        getValue: (datum) => datum.secondary,
        elementType: "line",
      },
    ],
    []
  );

  console.log("data", data);
  console.log("primaryAxis", primaryAxis);
  console.log("secondaryAxes", secondaryAxes);

  return (
    <>
      <button onClick={randomizeData}>Randomize Data</button>
      <br />
      <br />
      <ResizableBox>
        <Chart
          options={{
            data,
            primaryAxis,
            secondaryAxes,
          }}
        />
      </ResizableBox>
    </>
  );
}

'''
'''--- src/lib/components/react_chart/custom_charts/Bar.js ---
import ResizableBox from "../ResizableBox";
import React from "react";
import { Chart } from "react-charts";

export default function BarCustom(props) {
    const { data, options } = props;

    let primaryAxis;
    let secondaryAxes;

    if (options?.primaryAxis) {
      primaryAxis = options.primaryAxis;
      console.log("primaryAxis is in options");
    } else {
      primaryAxis = {
        getValue: (datum) => datum.primary,
      };
      console.log("primaryAxis is not in options");
    }

    if (options?.secondaryAxes) {
      secondaryAxes = options.secondaryAxes;
      console.log("secondaryAxes is in options");
    } else {
      secondaryAxes = [
        {
          getValue: (datum) => datum.secondary,
        },
      ];
      console.log("secondaryAxes is not in options");
    }

console.log("props", props);

return (
  <>

    <div
      style={{
        display: "flex",
        flexDirection: "column",
        padding: "12px",
        minHeight: "400px",
      }}
    >
      {/* <div
        style={{
          flex: "0 0 auto",
          padding: "10px",
        }}
      >
        {options.HeaderTitle}
      </div> */}
      <div
        style={{
          flex: 2,
          minHeight: options.minHeight,

        }}
      >
        <Chart
          options={{
            data,
            primaryAxis,
            secondaryAxes,
            dark: true,

          }}
        />
      </div>
    </div>
  </>
);

}

'''
'''--- src/lib/components/react_chart/main.js ---
// import "./styles.css";
import React from "react";

//

import Area from "./components/Area";
import Band from "./components/Band";
import Bar from "./components/Bar";
import BarStacked from "./components/BarStacked";
import Bubble from "./components/Bubble";
import CustomStyles from "./components/CustomStyles";
import DarkMode from "./components/DarkMode";
import DynamicContainer from "./components/DynamicContainer";
import InteractionMode from "./components/InteractionMode";
import Line from "./components/Line";
import MultipleAxes from "./components/MultipleAxes";
import BarHorizontal from "./components/BarHorizontal";
import BarHorizontalStacked from "./components/BarHorizontalStacked";

// help me import as as BarCustom
// no change the variable name while importing
//
// import BarCustom from "./custom_charts/Bar";

import BarCustom from "./custom_charts/Bar";

const components = {
  "Line": Line,
  "Bar": Bar,
  "Bar (Stacked)": BarStacked,
  "Bar (Horizontal)": BarHorizontal,
  "Bar (Horizontal + Stacked)": BarHorizontalStacked,
  "Band": Band,
  "Area": Area,
  "Bubble": Bubble,
  "Multiple Axes": MultipleAxes,
  "Interaction Modes": InteractionMode,
  "Dark Mode": DarkMode,
  "Dynamic / Overflow Container": DynamicContainer,
  "Custom Styles": CustomStyles,

};

export const ReactChart = (props) => {
    const { chart_name, options, data } = props;

    return (
      <>
        {/* only show by chart_name */}
        {/* {chart_name === "Line" && <Line options={options} data={data} />}
        {chart_name === "Bar" && <Bar options={options} data={data} />}
        {chart_name === "Bar (Stacked)" && <BarStacked options={options} data={data} />}
        {chart_name === "Bar (Horizontal)" && <BarHorizontal options={options} data={data} />}
        {chart_name === "Bar (Horizontal + Stacked)" && <BarHorizontalStacked options={options} data={data} />}
        {chart_name === "Band" && <Band options={options} data={data} />}
        {chart_name === "Area" && <Area options={options} data={data} />}
        {chart_name === "Bubble" && <Bubble options={options} data={data} />}
        {chart_name === "Multiple Axes" && <MultipleAxes options={options} data={data} />}
        {chart_name === "Interaction Modes" && <InteractionMode options={options} data={data} />}
        {chart_name === "Dark Mode" && <DarkMode options={options} data={data} />}
        {chart_name === "Dynamic / Overflow Container" && <DynamicContainer options={options} data={data} />}
        {chart_name === "Custom Styles" && <CustomStyles options={options} data={data} />} */}

        {chart_name === "BarCustom" && <BarCustom options={options} data={data} />}

        {chart_name === "Line" && <Line />}
        {chart_name === "Bar" && <Bar />}
        {chart_name === "Bar (Stacked)" && <BarStacked />}
        {chart_name === "Bar (Horizontal)" && <BarHorizontal />}
        {chart_name === "Bar (Horizontal + Stacked)" && <BarHorizontalStacked />}
        {chart_name === "Band" && <Band />}
        {chart_name === "Area" && <Area />}
        {chart_name === "Bubble" && <Bubble />}
        {chart_name === "Multiple Axes" && <MultipleAxes />}
        {chart_name === "Interaction Modes" && <InteractionMode />}
        {chart_name === "Dark Mode" && <DarkMode />}
        {chart_name === "Dynamic / Overflow Container" && <DynamicContainer />}
        {chart_name === "Custom Styles" && <CustomStyles />}

      </>
    );
  }
'''
'''--- src/lib/components/react_chart/useDemoConfig.js ---

import React from "react";

const options = {
  elementType: ["line", "area", "bar"],
  primaryAxisType: ["linear", "time", "log", "band"],
  secondaryAxisType: ["linear", "time", "log", "band"],
  primaryAxisPosition: ["top", "left", "right", "bottom"],
  secondaryAxisPosition: ["top", "left", "right", "bottom"],
  secondaryAxisStack: [true, false],
  primaryAxisShow: [true, false],
  secondaryAxisShow: [true, false],
  interactionMode: ["primary", "closest"],
  tooltipGroupingMode: ["single", "primary", "secondary", "series"],
  tooltipAnchor: [
    "closest",
    "top",
    "bottom",
    "left",
    "right",
    "center",
    "gridTop",
    "gridBottom",
    "gridLeft",
    "gridRight",
    "gridCenter",
    "pointer",
  ],
  tooltipAlign: [
    "auto",
    "top",
    "bottom",
    "left",
    "right",
    "topLeft",
    "topRight",
    "bottomLeft",
    "bottomRight",
    "center",
  ],
  snapCursor: [true, false],
};

const optionKeys = Object.keys(options);

export default function useChartConfig({
  series,
  datums = 10,
  useR,
  show = [],
  count = 1,
  resizable = true,
  canRandomize = true,
  dataType = "time",
  elementType = "line",
  primaryAxisType = "time",
  secondaryAxisType = "linear",
  primaryAxisPosition = "bottom",
  secondaryAxisPosition = "left",
  primaryAxisStack = false,
  secondaryAxisStack = true,
  primaryAxisShow = true,
  secondaryAxisShow = true,
  tooltipAnchor = "closest",
  tooltipAlign = "auto",
  interactionMode = "primary",
  tooltipGroupingMode = "primary",
  snapCursor = true,
} = {}) {
  const [state, setState] = React.useState({
    count,
    resizable,
    canRandomize,
    dataType,
    elementType,
    primaryAxisType,
    secondaryAxisType,
    primaryAxisPosition,
    secondaryAxisPosition,
    primaryAxisStack,
    secondaryAxisStack,
    primaryAxisShow,
    secondaryAxisShow,
    tooltipAnchor,
    tooltipAlign,
    interactionMode,
    tooltipGroupingMode,
    snapCursor,
    datums,
    data: makeDataFrom(dataType, series, datums, useR),
  });

  React.useEffect(() => {
    setState((old) => ({
      ...old,
      data: makeDataFrom(dataType, series, datums, useR),
    }));
  }, [count, dataType, datums, series, useR]);

  const randomizeData = () =>
    setState((old) => ({
      ...old,
      data: makeDataFrom(dataType, series, datums, useR),
    }));

  const Options = optionKeys
    .filter((option) => show.indexOf(option) > -1)
    .map((option) => (
      <div key={option}>
        {option}: &nbsp;
        <select
          value={state[option]}
          onChange={({ target: { value } }) =>
            setState((old) => ({
              ...old,
              [option]:
                typeof options[option][0] === "boolean"
                  ? value === "true"
                  : value,
            }))
          }
        >
          {options[option].map((d) => (
            <option value={d} key={d.toString()}>
              {d.toString()}
            </option>
          ))}
        </select>
        <br />
      </div>
    ));

  return {
    ...state,
    randomizeData,
    Options,
  };
}

function makeDataFrom(dataType, series, datums, useR) {
  return [
    ...new Array(series || Math.max(Math.round(Math.random() * 5), 1)),
  ].map((d, i) => makeSeries(i, dataType, datums, useR));
}

function makeSeries(i, dataType, datums, useR) {
  const start = 0;
  const startDate = new Date();
  // startDate.setFullYear(2020);
  startDate.setUTCHours(0);
  startDate.setUTCMinutes(0);
  startDate.setUTCSeconds(0);
  startDate.setUTCMilliseconds(0);
  // const length = 5 + Math.round(Math.random() * 15)
  const length = datums;
  const min = 0;
  const max = 100;
  const rMin = 2;
  const rMax = 20;
  const nullChance = 0;
  return {
    label: `Series ${i + 1}`,
    data: [...new Array(length)].map((_, i) => {
      let x;

      if (dataType === "ordinal") {
        x = `Ordinal Group ${start + i}`;
      } else if (dataType === "time") {
        x = new Date(startDate.getTime() + 60 * 1000 * 60 * 24 * i);
      } else if (dataType === "linear") {
        x =
          Math.random() < nullChance
            ? null
            : min + Math.round(Math.random() * (max - min));
      } else {
        x = start + i;
      }

      const distribution = 1.1;

      const y =
        Math.random() < nullChance
          ? null
          : min + Math.round(Math.random() * (max - min));

      const r = !useR
        ? undefined
        : rMax -
          Math.floor(
            Math.log(Math.random() * (distribution ** rMax - rMin) + rMin) /
              Math.log(distribution)
          );

      return {
        primary: x,
        secondary: y,
        radius: r,
      };
    }),
  };

}

'''
'''--- src/lib/components/remark/hashtags.js ---
import { findAndReplace } from "mdast-util-find-and-replace";

const hashtagRegex =
  /#(\w+)/gi;

export default function hashtags() {
  function replace(value, hashtag, match) {
    if (
      /[\w`]/.test(match.input.charAt(match.index - 1)) ||
      /[/\w`]/.test(match.input.charAt(match.index + value.length))
    ) {
      return false;
    }

    let node = { type: "text", value };
    node = {
      type: "strong",
      children: [node],
      data: {
        hProperties: { hashtag },
      },
    };

    return node;
  }

  function transform(markdownAST) {
    findAndReplace(markdownAST, hashtagRegex, replace);
    return markdownAST;
  }

  return transform;
}

'''
'''--- src/lib/components/remark/mentions.js ---
import { findAndReplace } from "mdast-util-find-and-replace";

const mentionRegex =
  /@((?:(?:[a-z\d]+[-_])*[a-z\d]+\.)*(?:[a-z\d]+[-_])*[a-z\d]+)/gi;

export default function mentions() {
  function replace(value, username, match) {
    if (
      /[\w`]/.test(match.input.charAt(match.index - 1)) ||
      /[/\w`]/.test(match.input.charAt(match.index + value.length)) ||
      username.length < 2 ||
      username.length > 64
    ) {
      return false;
    }

    let node = { type: "text", value };
    node = {
      type: "strong",
      children: [node],
      data: {
        hProperties: { accountId: username },
      },
    };

    return node;
  }

  function transform(markdownAST) {
    findAndReplace(markdownAST, mentionRegex, replace);
    return markdownAST;
  }

  return transform;
}

'''
'''--- src/lib/components/tables/BasicTable.js ---
import React from "react";

import { CompactTable } from "@table-library/react-table-library/compact";
import { useTheme } from "@table-library/react-table-library/theme";
import { getTheme } from "@table-library/react-table-library/baseline";
import { useSort } from "@table-library/react-table-library/sort";

export const BasicTable = (props) => {
    const { columns, data , sortFns } = props;

  const theme = useTheme(getTheme());

  const sort = useSort(
    data,
    {
      onChange: onSortChange,
    },
    {
      sortFns: sortFns,
    }
  );

  function onSortChange(action, state) {
    console.log(action, state);
  }

  return (
    <>
      <CompactTable columns={columns} data={data} theme={theme} sort={sort} />

    </>
  );
};

'''
'''--- src/lib/components/tables/Table.js ---
import React from "react";

import { CompactTable } from "@table-library/react-table-library/compact";
import { useTheme } from "@table-library/react-table-library/theme";
import { getTheme } from "@table-library/react-table-library/baseline";
import { useSort } from "@table-library/react-table-library/sort";

export const BasicTable = (props) => {
    const { columns, data , sortFns } = props;

  const theme = useTheme(getTheme());

  const sort = useSort(
    data,
    {
      onChange: onSortChange,
    },
    {
      sortFns: sortFns,
    }
  );

  function onSortChange(action, state) {
    console.log(action, state);
  }

  return (
    <>
      <CompactTable columns={columns} data={data} theme={theme} sort={sort} />

    </>
  );
};

'''
'''--- src/lib/data/account.js ---
import { singletonHook } from "react-singleton-hook";
import { useEffect, useState } from "react";
import { useNear } from "./near";
import ls from "local-storage";
import * as nearAPI from "near-api-js";

export const LsKey = "near-social-vm:v01:";
const LsKeyAccountId = LsKey + ":accountId:";
const LsKeyPretendAccountId = LsKey + ":pretendAccountId:";

const defaultAccount = {
  loading: true,
  signedAccountId: ls.get(LsKeyAccountId) ?? undefined,
  pretendAccountId: ls.get(LsKeyPretendAccountId) ?? undefined,
  accountId:
    ls.get(LsKeyPretendAccountId) ?? ls.get(LsKeyAccountId) ?? undefined,
  state: null,
  near: null,
};

async function updateAccount(near, walletState) {
  near.connectedContractId = walletState?.contract?.contractId;
  if (
    near.connectedContractId &&
    near.connectedContractId !== near.config.contractName
  ) {
    const selector = await near.selector;
    const wallet = await selector.wallet();
    await wallet.signOut();
    near.connectedContractId = null;
    walletState = selector.store.getState();
  }
  near.accountId = walletState?.accounts?.[0]?.accountId ?? null;
  if (near.accountId) {
    near.publicKey = null;
    try {
      if (walletState?.selectedWalletId === "here-wallet") {
        const hereKeystore = ls.get("herewallet:keystore");
        near.publicKey = nearAPI.KeyPair.fromString(
          hereKeystore[near.config.networkId].accounts[near.accountId]
        ).getPublicKey();
      }
    } catch (e) {
      console.error(e);
    }
    if (!near.publicKey) {
      try {
        near.publicKey = nearAPI.KeyPair.fromString(
          ls.get(
            walletState?.selectedWalletId === "meteor-wallet"
              ? `_meteor_wallet${near.accountId}:${near.config.networkId}`
              : `near-api-js:keystore:${near.accountId}:${near.config.networkId}`
          )
        ).getPublicKey();
      } catch (e) {
        console.error(e);
      }
    }
  }
}

const loadAccount = async (near, setAccount) => {
  const signedAccountId = near.accountId;
  if (signedAccountId) {
    ls.set(LsKeyAccountId, signedAccountId);
  } else {
    ls.remove(LsKeyAccountId);
  }
  const pretendAccountId = ls.get(LsKeyPretendAccountId) ?? undefined;
  const account = {
    loading: false,
    signedAccountId,
    pretendAccountId,
    accountId: pretendAccountId ?? signedAccountId,
    state: null,
    near,
    refresh: async () => await loadAccount(near, setAccount),
    startPretending: async (pretendAccountId) => {
      if (pretendAccountId) {
        ls.set(LsKeyPretendAccountId, pretendAccountId);
      } else {
        ls.remove(LsKeyPretendAccountId);
      }
      await loadAccount(near, setAccount);
    },
  };
  if (signedAccountId) {
    const [storageBalance, state] = await Promise.all([
      near.contract.storage_balance_of({
        account_id: signedAccountId,
      }),
      near.accountState(signedAccountId),
    ]);
    account.storageBalance = storageBalance;
    account.state = state;
  }

  setAccount(account);
};

export const useAccount = singletonHook(defaultAccount, () => {
  const [account, setAccount] = useState(defaultAccount);
  const near = useNear();

  useEffect(() => {
    if (!near) {
      return;
    }
    near.selector.then((selector) => {
      selector.store.observable.subscribe(async (walletState) => {
        await updateAccount(near, walletState);
        try {
          await loadAccount(near, setAccount);
        } catch (e) {
          console.error(e);
        }
      });
    });
  }, [near]);

  return account;
});

export const useAccountId = () => {
  const account = useAccount();
  return account.accountId;
};

'''
'''--- src/lib/data/cache.js ---
import { indexMatch, isObject, patternMatch } from "./utils";
import { openDB } from "idb";
import { singletonHook } from "react-singleton-hook";

const Action = {
  ViewCall: "ViewCall",
  Fetch: "Fetch",
  Block: "Block",
  LocalStorage: "LocalStorage",
  CustomPromise: "CustomPromise",
};

const CacheStatus = {
  NotStarted: "NotStarted",
  InProgress: "InProgress",
  Done: "Done",
  Invalidated: "Invalidated",
};

const ExpirationTimeoutMs = 1000 * 60 * 5; // 5 minutes
const CacheSubscriptionTimeoutMs = 5000;
const CacheDebug = false;

const CacheDb = "cacheDb";
const CacheDbObject = "cache-v1";

class Cache {
  constructor(finalSynchronizationDelayMs = 3000) {
    this.dbPromise = openDB(CacheDb, 1, {
      upgrade(db) {
        db.createObjectStore(CacheDbObject);
      },
    });
    this.cache = {};
    this.finalSynchronizationDelayMs = finalSynchronizationDelayMs;
  }

  invalidateCallbacks(cached, isFinal) {
    if (cached.invalidationCallbacks?.length) {
      const callbacks = cached.invalidationCallbacks;
      cached.invalidationCallbacks = [];
      setTimeout(
        () => {
          callbacks.forEach((cb) => {
            try {
              cb();
            } catch {
              // ignore
            }
          });
        },
        isFinal ? this.finalSynchronizationDelayMs + 50 : 50
      );
    }
  }

  async innerGet(key) {
    return (await this.dbPromise).get(CacheDbObject, key);
  }

  async innerSet(key, val) {
    return (await this.dbPromise).put(CacheDbObject, val, key);
  }

  cachedPromise(key, promise, invalidate, forceCachedValue) {
    key = JSON.stringify(key);
    const cached = this.cache[key] || {
      status: CacheStatus.NotStarted,
      invalidationCallbacks: [],
      result: null,
      time: new Date().getTime(),
    };
    this.cache[key] = cached;
    if (!isObject(invalidate)) {
      invalidate = {
        onInvalidate: invalidate,
      };
    }
    if (invalidate.onInvalidate) {
      cached.invalidationCallbacks.push(invalidate.onInvalidate);
    }
    if (!cached.subscription && invalidate.subscribe) {
      const makeTimer = () => {
        cached.subscription = setTimeout(() => {
          CacheDebug && console.log("Cached subscription invalidation", key);
          if (document.hidden) {
            makeTimer();
          } else {
            cached.subscription = null;
            cached.status = CacheStatus.Invalidated;
            this.invalidateCallbacks(cached, false);
          }
        }, CacheSubscriptionTimeoutMs);
      };
      makeTimer();
    }
    if (cached.status === CacheStatus.InProgress) {
      return cached.result;
    }
    if (
      cached.status === CacheStatus.Done &&
      cached.time + ExpirationTimeoutMs > new Date().getTime()
    ) {
      return cached.result;
    }
    if (cached.status === CacheStatus.NotStarted) {
      this.innerGet(key).then((cachedResult) => {
        if (
          (cachedResult || forceCachedValue) &&
          cached.status === CacheStatus.InProgress
        ) {
          CacheDebug && console.log("Cached value", key, cachedResult);
          cached.result = cachedResult;
          cached.time = new Date().getTime();
          this.invalidateCallbacks(cached, false);
        }
      });
    }
    cached.status = CacheStatus.InProgress;
    if (promise) {
      promise()
        .then((result) => {
          CacheDebug && console.log("Fetched result", key);
          cached.status = CacheStatus.Done;
          cached.time = new Date().getTime();
          if (JSON.stringify(result) !== JSON.stringify(cached.result)) {
            cached.result = result;
            this.innerSet(key, result);
            CacheDebug && console.log("Replacing value", key, result);
            this.invalidateCallbacks(cached, false);
          }
        })
        .catch((e) => {
          console.error(e);
          cached.status = CacheStatus.Done;
          const result = undefined;
          cached.time = new Date().getTime();
          if (JSON.stringify(result) !== JSON.stringify(cached.result)) {
            cached.result = result;
            this.innerSet(key, result);
            CacheDebug && console.log("Replacing value", key, result);
            this.invalidateCallbacks(cached, false);
          }
        });
    }
    CacheDebug && console.log("New cache request", key);
    return cached.result;
  }

  invalidateCache(near, data) {
    const affectedKeys = [];
    const indexUrl = `${near.config.apiUrl}/index`;
    Object.keys(this.cache).forEach((stringKey) => {
      let key;
      try {
        key = JSON.parse(stringKey);
      } catch (e) {
        console.error("Key deserialization failed", stringKey);
        return;
      }
      if (
        key.action === Action.ViewCall &&
        key.contractId === near.config.contractName &&
        (!key.blockId ||
          key.blockId === "optimistic" ||
          key.blockId === "final")
      ) {
        try {
          const keys = key.args?.keys;
          if (
            keys.some((pattern) => patternMatch(key.methodName, pattern, data))
          ) {
            affectedKeys.push([stringKey, key.blockId === "final"]);
          }
        } catch {
          // ignore
        }
      }
      // Trying to parse index
      if (key.action === Action.Fetch && key.url === indexUrl) {
        try {
          const { action, key: indexKey } = JSON.parse(key.options?.body);
          if (action && indexKey && indexMatch(action, indexKey, data)) {
            // console.log("Invalidating index", action, indexKey);
            affectedKeys.push([stringKey, true]);
          }
        } catch {
          // ignore
        }
      }
    });
    console.log("Cache invalidation", affectedKeys);
    affectedKeys.forEach(([stringKey, isFinal]) => {
      const cached = this.cache[stringKey];
      cached.status = CacheStatus.Invalidated;
      this.invalidateCallbacks(cached, isFinal);
    });
  }

  cachedBlock(near, blockId, invalidate) {
    return this.cachedPromise(
      {
        action: Action.Block,
        blockId,
      },
      () => near.block(blockId),
      invalidate
    );
  }

  cachedViewCall(near, contractId, methodName, args, blockId, invalidate) {
    return this.cachedPromise(
      {
        action: Action.ViewCall,
        contractId,
        methodName,
        args,
        blockId,
      },
      () => near.viewCall(contractId, methodName, args, blockId),
      invalidate
    );
  }

  async asyncFetch(url, options) {
    const responseType = options?.responseType?.toLowerCase();
    options = {
      method: options?.method,
      headers: options?.headers,
      body: options?.body,
    };
    try {
      const response = await fetch(url, options);
      const status = response.status;
      const ok = response.ok;
      const contentType = response.headers.get("content-type");
      const body = ok
        ? await (responseType === "arraybuffer"
            ? response.arrayBuffer()
            : responseType === "blob"
            ? response.blob()
            : responseType === "formdata"
            ? response.formData()
            : responseType === "json"
            ? response.json()
            : responseType === "text"
            ? response.text()
            : contentType && contentType.indexOf("application/json") !== -1
            ? response.json()
            : response.text())
        : undefined;
      return {
        ok,
        status,
        contentType,
        body,
      };
    } catch (e) {
      return {
        ok: false,
        error: e.message,
      };
    }
  }

  cachedFetch(url, options, invalidate) {
    return this.cachedPromise(
      {
        action: Action.Fetch,
        url,
        options,
      },
      () => this.asyncFetch(url, options),
      invalidate
    );
  }

  cachedCustomPromise(key, promise, invalidate) {
    return this.cachedPromise(
      {
        action: Action.CustomPromise,
        key,
      },
      () => promise(),
      invalidate
    );
  }

  socialGet(near, keys, recursive, blockId, options, invalidate) {
    if (!near) {
      return null;
    }
    keys = Array.isArray(keys) ? keys : [keys];
    keys = keys.map((key) => (recursive ? `${key}/**` : `${key}`));
    const args = {
      keys,
      options,
    };
    let data = this.cachedViewCall(
      near,
      near.config.contractName,
      "get",
      args,
      blockId,
      invalidate
    );
    if (data === null) {
      return null;
    }

    if (keys.length === 1) {
      const parts = keys[0].split("/");
      for (let i = 0; i < parts.length; i++) {
        const part = parts[i];
        if (part === "*" || part === "**") {
          break;
        }
        data = data?.[part];
      }
    }

    return data;
  }

  socialIndex(near, action, key, options, invalidate) {
    const res = this.cachedFetch(
      `${near.config.apiUrl}/index`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          action,
          key,
          options,
        }),
      },
      invalidate
    );

    return res?.ok ? res.body : null;
  }

  localStorageGet(domain, key, invalidate) {
    return this.cachedPromise(
      {
        action: Action.LocalStorage,
        domain,
        key,
      },
      undefined,
      invalidate,
      true
    );
  }

  asyncLocalStorageGet(domain, key) {
    key = JSON.stringify({
      action: Action.LocalStorage,
      domain,
      key,
    });

    return this.innerGet(key);
  }

  localStorageSet(domain, key, value) {
    key = JSON.stringify({
      action: Action.LocalStorage,
      domain,
      key,
    });
    const cached = this.cache[key] || {
      status: CacheStatus.NotStarted,
      invalidationCallbacks: [],
      result: null,
      time: new Date().getTime(),
    };
    this.cache[key] = cached;
    cached.status = CacheStatus.Done;
    if (JSON.stringify(value) !== JSON.stringify(cached.result)) {
      cached.result = value;
      this.innerSet(key, value);
      CacheDebug && console.log("Replacing value", key, value);
      this.invalidateCallbacks(cached, false);
    }
  }
}

const defaultCache = new Cache();
export const useCache = singletonHook(defaultCache, () => {
  return defaultCache;
});

'''
'''--- src/lib/data/commitData.js ---
import {
  bigMax,
  convertToStringLeaves,
  estimateDataSize,
  extractKeys,
  removeDuplicates,
  StorageCostPerByte,
  TGas,
} from "./utils";
import Big from "big.js";

const MinStorageBalance = StorageCostPerByte.mul(2000);
const InitialAccountStorageBalance = StorageCostPerByte.mul(500);
const ExtraStorageBalance = StorageCostPerByte.mul(500);
const StorageForPermission = StorageCostPerByte.mul(500);

const fetchCurrentData = async (near, data) => {
  const keys = extractKeys(data);
  return await near.contract.get({
    keys,
  });
};

export const prepareCommit = async (
  near,
  accountId,
  originalData,
  forceRewrite
) => {
  await near.selector;
  const signedAccountId = near.accountId;
  if (!signedAccountId) {
    alert("You're not logged in. Sign in to commit data.");
    return;
  }
  const [storageBalance, permissionGranted] = await Promise.all([
    near.viewCall(near.config.contractName, "storage_balance_of", {
      account_id: signedAccountId,
    }),
    signedAccountId !== accountId
      ? near.viewCall(near.config.contractName, "is_write_permission_granted", {
          predecessor_id: signedAccountId,
          key: accountId,
        })
      : near.publicKey
      ? near.viewCall(near.config.contractName, "is_write_permission_granted", {
          public_key: near.publicKey.toString(),
          key: accountId,
        })
      : Promise.resolve(false),
  ]);
  const availableStorage = Big(storageBalance?.available || "0");
  let data = {
    [accountId]: convertToStringLeaves(originalData),
  };
  let currentData = {};
  if (!forceRewrite) {
    currentData = await fetchCurrentData(near, data);
    data = removeDuplicates(data, currentData);
  }
  const expectedDataBalance = StorageCostPerByte.mul(
    estimateDataSize(data, currentData)
  )
    .add(storageBalance ? Big(0) : InitialAccountStorageBalance)
    .add(permissionGranted ? Big(0) : StorageForPermission)
    .add(ExtraStorageBalance);
  const deposit = bigMax(
    expectedDataBalance.sub(availableStorage),
    permissionGranted ? Big(0) : storageBalance ? Big(1) : MinStorageBalance
  );
  return {
    originalData,
    accountId,
    storageBalance,
    availableStorage,
    currentData,
    data,
    expectedDataBalance,
    deposit,
    permissionGranted,
  };
};

export const asyncCommit = async (near, data, deposit) => {
  console.log("Committing data", data);

  return await near.contract.set(
    {
      data,
    },
    TGas.mul(100).toFixed(0),
    deposit.toFixed(0)
  );
};

export const asyncCommitData = async (near, originalData, forceRewrite) => {
  const { data, deposit } = await prepareCommit(
    near,
    originalData,
    forceRewrite
  );
  return asyncCommit(near, data, deposit);
};

export const requestPermissionAndCommit = async (near, data, deposit) => {
  const wallet = await (await near.selector).wallet();
  const actions = [];
  if (near.publicKey) {
    actions.push({
      type: "FunctionCall",
      params: {
        methodName: "grant_write_permission",
        args: {
          public_key: near.publicKey.toString(),
          keys: [near.accountId],
        },
        gas: TGas.mul(100).toFixed(0),
        deposit: deposit.gt(0) ? deposit.toFixed(0) : "1",
      },
    });
    deposit = Big(0);
  }
  actions.push({
    type: "FunctionCall",
    params: {
      methodName: "set",
      args: {
        data,
      },
      gas: TGas.mul(100).toFixed(0),
      deposit: deposit.gt(0) ? deposit.toFixed(0) : "1",
    },
  });
  return await wallet.signAndSendTransaction({
    receiverId: near.config.contractName,
    actions,
  });
};

'''
'''--- src/lib/data/near.js ---
import * as nearAPI from "near-api-js";
import Big from "big.js";
import { useEffect, useMemo, useState } from "react";
import { singletonHook } from "react-singleton-hook";
import { MaxGasPerTransaction, TGas } from "./utils";

const TestNearConfig = {
  networkId: "testnet",
  nodeUrl: "https://rpc.testnet.near.org",
  archivalNodeUrl: "https://rpc.testnet.internal.near.org",
  contractName: "v1.social08.testnet",
  walletUrl: "https://wallet.testnet.near.org",
  wrapNearAccountId: "wrap.testnet",
  apiUrl: null,
  enableWeb4FastRpc: false,
};

export const MainNearConfig = {
  networkId: "mainnet",
  nodeUrl: "https://rpc.mainnet.near.org",
  archivalNodeUrl: "https://rpc.mainnet.internal.near.org",
  contractName: "social.near",
  walletUrl: "https://wallet.near.org",
  wrapNearAccountId: "wrap.near",
  apiUrl: "https://api.near.social",
  enableWeb4FastRpc: false,
};

const SupportedApiMethods = {
  get: true,
  keys: true,
};

const apiCall = async (config, methodName, args, blockId, fallback) => {
  if (!config.apiUrl || !(methodName in SupportedApiMethods)) {
    return fallback();
  }
  args = args || {};

  if (blockId) {
    args.blockHeight = blockId;
  }

  try {
    return await (
      await fetch(`${config.apiUrl}/${methodName}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(args),
      })
    ).json();
  } catch (e) {
    console.log("API call failed", methodName, args);
    console.error(e);
    return fallback();
  }
};

async function functionCall(
  near,
  contractName,
  methodName,
  args,
  gas,
  deposit
) {
  try {
    const wallet = await (await near.selector).wallet();
    return await wallet.signAndSendTransaction({
      receiverId: contractName,
      actions: [
        {
          type: "FunctionCall",
          params: {
            methodName,
            args,
            gas: gas ?? TGas.mul(30).toFixed(0),
            deposit: deposit ?? "0",
          },
        },
      ],
    });
  } catch (e) {
    // const msg = e.toString();
    // if (msg.indexOf("does not have enough balance") !== -1) {
    //   return await refreshAllowanceObj.refreshAllowance();
    // }
    throw e;
  }
}

async function accountState(near, accountId) {
  const account = new nearAPI.Account(
    near.nearConnection.connection,
    accountId
  );
  return await account.state();
}

async function sendTransactions(near, functionCalls) {
  try {
    const wallet = await (await near.selector).wallet();
    const transactions = [];
    let currentTotalGas = Big(0);
    functionCalls.forEach(
      ({ contractName, methodName, args, gas, deposit }) => {
        const newTotalGas = currentTotalGas.add(gas);
        const action = {
          type: "FunctionCall",
          params: {
            methodName,
            args,
            gas: gas.toFixed(0),
            deposit: deposit.toFixed(0),
          },
        };
        if (
          transactions[transactions.length - 1]?.receiverId !== contractName ||
          newTotalGas.gt(MaxGasPerTransaction)
        ) {
          transactions.push({
            receiverId: contractName,
            actions: [],
          });
          currentTotalGas = gas;
        } else {
          currentTotalGas = newTotalGas;
        }
        transactions[transactions.length - 1].actions.push(action);
      }
    );
    return await wallet.signAndSendTransactions({ transactions });
  } catch (e) {
    // const msg = e.toString();
    // if (msg.indexOf("does not have enough balance") !== -1) {
    //   return await refreshAllowanceObj.refreshAllowance();
    // }
    throw e;
  }
}

function setupContract(near, contractId, options) {
  const { viewMethods = [], changeMethods = [] } = options;
  const contract = {
    near,
    contractId,
  };
  viewMethods.forEach((methodName) => {
    contract[methodName] = (args) =>
      near.viewCall(contractId, methodName, args);
  });
  changeMethods.forEach((methodName) => {
    contract[methodName] = (args, gas, deposit) =>
      near.functionCall(contractId, methodName, args, gas, deposit);
  });
  return contract;
}

async function viewCall(
  provider,
  blockId,
  contractId,
  methodName,
  args,
  finality
) {
  args = args || {};
  const result = await provider.query({
    request_type: "call_function",
    account_id: contractId,
    method_name: methodName,
    args_base64: Buffer.from(JSON.stringify(args)).toString("base64"),
    block_id: blockId,
    finality,
  });

  return (
    result.result &&
    result.result.length > 0 &&
    JSON.parse(Buffer.from(result.result).toString())
  );
}

async function web4ViewCall(contractId, methodName, args, fallback) {
  args = args || {};
  const url = new URL(
    `https://rpc.web4.near.page/account/${contractId}/view/${methodName}`
  );
  Object.entries(args).forEach(([key, value]) => {
    if (value !== undefined) {
      url.searchParams.append(`${key}.json`, JSON.stringify(value));
    }
  });
  try {
    return await (await fetch(url.toString())).json();
  } catch (e) {
    console.log("Web4 view call failed", url.toString());
    console.error(e);
    return fallback();
  }
}

async function _initNear({ networkId, config, keyStore, selector } = {}) {
  if (!config) {
    config = {};
    if (!networkId) {
      config.networkId = "mainnet";
    }
  }
  if (networkId && !config.networkId) {
    config.networkId = networkId;
  }
  if (config.networkId === "mainnet") {
    config = Object.assign({}, config, MainNearConfig);
  } else if (config.networkId === "testnet") {
    config = Object.assign({}, config, TestNearConfig);
  }
  keyStore = keyStore ?? new nearAPI.keyStores.BrowserLocalStorageKeyStore();

  const nearConnection = await nearAPI.connect(
    Object.assign({ deps: { keyStore } }, config)
  );

  const _near = {
    config,
    selector,
    keyStore,
    nearConnection,
  };

  _near.nearArchivalConnection = nearAPI.Connection.fromConfig({
    networkId: config.networkId,
    provider: {
      type: "JsonRpcProvider",
      args: { url: config.archivalNodeUrl },
    },
    signer: { type: "InMemorySigner", keyStore },
  });

  const transformBlockId = (blockId) =>
    blockId === "optimistic" || blockId === "final"
      ? {
          finality: blockId,
          blockId: undefined,
        }
      : blockId !== undefined && blockId !== null
      ? {
          finality: undefined,
          blockId: parseInt(blockId),
        }
      : {
          finality: "optimistic",
          blockId: undefined,
        };

  _near.viewCall = (contractId, methodName, args, blockHeightOrFinality) => {
    const { blockId, finality } = transformBlockId(blockHeightOrFinality);
    const nearViewCall = () =>
      viewCall(
        blockId
          ? _near.nearArchivalConnection.provider
          : _near.nearConnection.connection.provider,
        blockId ?? undefined,
        contractId,
        methodName,
        args,
        finality
      );

    const fastRpcCall = () =>
      finality === "optimistic" && config.enableWeb4FastRpc
        ? web4ViewCall(contractId, methodName, args, nearViewCall)
        : nearViewCall();

    return contractId === config.contractName &&
      (blockId || finality === "final")
      ? apiCall(config, methodName, args, blockId, fastRpcCall)
      : fastRpcCall();
  };

  _near.block = (blockHeightOrFinality) => {
    const blockQuery = transformBlockId(blockHeightOrFinality);
    const provider = blockQuery.blockId
      ? _near.nearArchivalConnection.provider
      : _near.nearConnection.connection.provider;
    return provider.block(blockQuery);
  };
  _near.functionCall = (contractName, methodName, args, gas, deposit) =>
    functionCall(_near, contractName, methodName, args, gas, deposit);
  _near.sendTransactions = (transactions) =>
    sendTransactions(_near, transactions);

  _near.contract = setupContract(_near, config.contractName, {
    viewMethods: [
      "storage_balance_of",
      "get",
      "get_num_accounts",
      "get_accounts_paged",
      "is_write_permission_granted",
      "keys",
    ],
    changeMethods: [
      "set",
      "grant_write_permission",
      "storage_deposit",
      "storage_withdraw",
    ],
  });

  _near.accountState = (accountId) => accountState(_near, accountId);

  return _near;
}

export const useInitNear = singletonHook({}, () => {
  const [nearPromise, setNearPromise] = useState(null);

  return {
    nearPromise,
    initNear: useMemo(() => (args) => setNearPromise(_initNear(args)), []),
  };
});

const defaultNear = null;
export const useNear = singletonHook(defaultNear, () => {
  const [near, setNear] = useState(defaultNear);
  const { nearPromise } = useInitNear();

  useEffect(() => {
    nearPromise && nearPromise.then(setNear);
  }, [nearPromise]);

  return near;
});

'''
'''--- src/lib/data/utils.js ---
import Big from "big.js";
import React from "react";
import equal from "deep-equal";

export const TGas = Big(10).pow(12);
export const MaxGasPerTransaction = TGas.mul(250);
export const StorageCostPerByte = Big(10).pow(19);

const MinAccountIdLen = 2;
const MaxAccountIdLen = 64;
const ValidAccountRe = /^(([a-z\d]+[-_])*[a-z\d]+\.)*([a-z\d]+[-_])*[a-z\d]+$/;
export const OneNear = Big(10).pow(24);
const AccountSafetyMargin = OneNear.div(2);

export const Loading = (
  <span
    className="spinner-border spinner-border-sm text-info me-1"
    role="status"
    aria-hidden="true"
  />
);

export const ErrorFallback = ({ error }) => {
  return (
    <div role="alert">
      <p>Something went wrong:</p>
      <pre>{error.message}</pre>
    </div>
  );
};

export function isValidAccountId(accountId) {
  return (
    accountId &&
    accountId.length >= MinAccountIdLen &&
    accountId.length <= MaxAccountIdLen &&
    accountId.match(ValidAccountRe)
  );
}

const toCamel = (s) => {
  return s.replace(/([-_][a-z])/gi, ($1) => {
    return $1.toUpperCase().replace("-", "").replace("_", "");
  });
};

export const isArray = (a) => Array.isArray(a);

export const isObject = (o) =>
  o === Object(o) && !isArray(o) && typeof o !== "function";

export const isString = (s) => typeof s === "string";

export const keysToCamel = function (o) {
  if (isObject(o)) {
    const n = {};

    Object.keys(o).forEach((k) => {
      n[toCamel(k)] = keysToCamel(o[k]);
    });

    return n;
  } else if (isArray(o)) {
    return o.map((i) => {
      return keysToCamel(i);
    });
  }

  return o;
};

export const bigMin = (a, b) => {
  if (a && b) {
    return a.lt(b) ? a : b;
  }
  return a || b;
};

export const bigMax = (a, b) => {
  if (a && b) {
    return a.gt(b) ? a : b;
  }
  return a || b;
};

export const bigToString = (b, p, len) => {
  if (b === null) {
    return "???";
  }
  let s = b.toFixed();
  let pos = s.indexOf(".");
  p = p || 6;
  len = len || 7;
  if (pos > 0) {
    let ap = Math.min(p, Math.max(len - pos, 0));
    if (ap > 0) {
      ap += 1;
    }
    if (pos + ap < s.length) {
      s = s.substring(0, pos + ap);
    }
  } else {
    pos = s.length;
  }
  for (let i = pos - 4; i >= 0; i -= 3) {
    s = s.slice(0, i + 1) + "," + s.slice(i + 1);
  }

  if (s === "0.000000" && p === 6 && len === 7) {
    return "<0.000001";
  }

  return s;
};

export const displayNear = (balance) =>
  !balance ? (
    "???"
  ) : balance.eq(1) ? (
    <>
      1 <span className="text-secondary">yoctoNEAR</span>
    </>
  ) : (
    <>
      {bigToString(balance.div(OneNear))}{" "}
      <span className="text-secondary">NEAR</span>
    </>
  );

export const displayGas = (gas) =>
  gas ? (
    <>
      {bigToString(gas.div(TGas))} <span className="text-secondary">TGas</span>
    </>
  ) : (
    "???"
  );

export const dateToString = (d) => {
  return d.toLocaleString("en-us", {
    day: "numeric",
    month: "short",
    year: "numeric",
  });
};

export const displayTime = (d) => {
  return d.toLocaleString();
};

export const availableNearBalance = (account) => {
  if (account && !account.loading && account.state) {
    let balance = Big(account.state.amount).sub(
      Big(account.state.storage_usage).mul(Big(StorageCostPerByte))
    );
    if (balance.gt(AccountSafetyMargin)) {
      return balance.sub(AccountSafetyMargin);
    }
  }
  return Big(0);
};

export const isoDate = (d) =>
  d ? new Date(d).toISOString().substring(0, 10) : "";

export const ipfsUpload = async (f) => {
  const res = await fetch("https://ipfs.near.social/add", {
    method: "POST",
    headers: {
      Accept: "application/json",
    },
    body: f,
  });
  return (await res.json()).cid;
};

export const ipfsUrl = (cid) => `https://ipfs.near.social/ipfs/${cid}`;

const EstimatedKeyValueSize = 40 * 3 + 8 + 12;
const EstimatedNodeSize = 40 * 2 + 8 + 10;

export const estimateDataSize = (data, prevData) =>
  isObject(data)
    ? Object.entries(data).reduce(
        (s, [key, value]) => {
          const prevValue = isObject(prevData) ? prevData[key] : undefined;
          return (
            s +
            (prevValue !== undefined
              ? estimateDataSize(value, prevValue)
              : key.length * 2 +
                estimateDataSize(value, undefined) +
                EstimatedKeyValueSize)
          );
        },
        isObject(prevData) ? 0 : EstimatedNodeSize
      )
    : (data?.length || 8) - (isString(prevData) ? prevData.length : 0);

export const extractKeys = (data, prefix = "") =>
  Object.entries(data)
    .map(([key, value]) =>
      isObject(value)
        ? extractKeys(value, `${prefix}${key}/`)
        : `${prefix}${key}`
    )
    .flat();

export const removeDuplicates = (data, prevData) => {
  const obj = Object.entries(data).reduce((obj, [key, value]) => {
    const prevValue = isObject(prevData) ? prevData[key] : undefined;
    if (isObject(value)) {
      const newValue = isObject(prevValue)
        ? removeDuplicates(value, prevValue)
        : value;
      if (newValue !== undefined) {
        obj[key] = newValue;
      }
    } else if (value !== prevValue) {
      obj[key] = value;
    }

    return obj;
  }, {});
  return Object.keys(obj).length ? obj : undefined;
};

const stringify = (s) => (isString(s) || s === null ? s : JSON.stringify(s));

export const convertToStringLeaves = (data) => {
  return isObject(data)
    ? Object.entries(data).reduce((obj, [key, value]) => {
        obj[stringify(key)] = convertToStringLeaves(value);
        return obj;
      }, {})
    : stringify(data);
};

const matchGet = (obj, keys) => {
  const matchKey = keys[0];
  let isRecursiveMatch = matchKey === "**";
  if (isRecursiveMatch) {
    return keys.length === 1;
  }
  const values =
    matchKey === "*" || isRecursiveMatch
      ? Object.values(obj)
      : matchKey in obj
      ? [obj[matchKey]]
      : [];

  return values.some((value) =>
    isObject(value)
      ? keys.length > 1
        ? matchGet(value, keys.slice(1))
        : value[""] !== undefined
      : keys.length === 1
  );
};

const matchKeys = (obj, keys) => {
  const matchKey = keys[0];
  const values =
    matchKey === "*"
      ? Object.values(obj)
      : matchKey in obj
      ? [obj[matchKey]]
      : [];

  return values.some(
    (value) =>
      keys.length === 1 || (isObject(value) && matchKeys(value, keys.slice(1)))
  );
};

export const patternMatch = (method, pattern, data) => {
  const path = pattern.split("/");
  return method === "get"
    ? matchGet(data, path)
    : method === "keys" && matchKeys(data, path);
};

export const indexMatch = (action, key, data) => {
  return Object.values(data).some((value) => {
    const indexValue = value?.index?.[action];
    try {
      return (
        indexValue &&
        JSON.stringify(JSON.parse(indexValue).key) === JSON.stringify(key)
      );
    } catch {
      return false;
    }
  });
};

const KnownSecondLevelKeys = {
  graph: true,
  post: true,
  index: true,
  settings: true,
};

export const computeWritePermission = (previousPermissions, data) => {
  const permissions = isObject(previousPermissions)
    ? JSON.parse(JSON.stringify(previousPermissions))
    : {};

  if (isObject(data)) {
    Object.entries(data).forEach(([key, value]) => {
      if (key in KnownSecondLevelKeys) {
        if (isObject(value)) {
          const subPermissions = (permissions[key] = permissions[key] || {});
          Object.keys(value).forEach((key) => {
            subPermissions[key] = true;
          });
        } else {
          permissions[key] = true;
        }
      } else {
        permissions[key] = true;
      }
    });
  }

  // console.log(
  //   JSON.stringify(previousPermissions),
  //   JSON.stringify(data),
  //   JSON.stringify(permissions)
  // );
  return permissions;
};

function isGetter(obj, prop) {
  return !!Object.getOwnPropertyDescriptor(obj, prop)["get"];
}

export const deepFreeze = (obj) => {
  Object.keys(obj).forEach((prop) => {
    if (
      !isGetter(obj, prop) &&
      typeof obj[prop] === "object" &&
      !Object.isFrozen(obj[prop])
    ) {
      deepFreeze(obj[prop]);
    }
  });
  return Object.freeze(obj);
};

export const ReactKey = "$$typeof";
export const isReactObject = (o) =>
  o !== null && typeof o === "object" && !!o[ReactKey];

export const deepCopy = (o) => {
  if (Array.isArray(o)) {
    return o.map((v) => deepCopy(v));
  } else if (o instanceof Map) {
    return new Map(
      [...o.entries()].map(([k, v]) => [deepCopy(k), deepCopy(v)])
    );
  } else if (o instanceof Set) {
    return new Set([...o].map((v) => deepCopy(v)));
  } else if (Buffer.isBuffer(o)) {
    return Buffer.from(o);
  } else if (o instanceof URL) {
    return new URL(o);
  } else if (o instanceof File) {
    return new File([o], o.name, { type: o.type });
  } else if (o instanceof Blob) {
    return new Blob([o], { type: o.type });
  } else if (o instanceof Uint8Array || o instanceof ArrayBuffer) {
    return o.slice(0);
  } else if (isObject(o)) {
    if (isReactObject(o)) {
      return o;
    }
    return Object.fromEntries(
      Object.entries(o).map(([key, value]) => [key, deepCopy(value)])
    );
  } else if (o === undefined || typeof o === "function") {
    return o;
  } else {
    return JSON.parse(JSON.stringify(o));
  }
};

export const deepEqual = equal;

'''
'''--- src/lib/vm/vm.js ---
import React from "react";
import { Widget } from "../components/Widget";
import {
  deepCopy,
  deepFreeze,
  ipfsUpload,
  ipfsUrl,
  isArray,
  isObject,
  isReactObject,
  isString,
  Loading,
  ReactKey,
} from "../data/utils";
import Files from "react-files";
import { sanitizeUrl } from "@braintree/sanitize-url";
import { Markdown } from "../components/Markdown";
import InfiniteScroll from "react-infinite-scroller";
import { CommitButton } from "../components/Commit";

// import "react-bootstrap-typeahead/css/Typeahead.css";
// import "react-bootstrap-typeahead/css/Typeahead.bs5.css";

import { Typeahead } from "react-bootstrap-typeahead";
import styled, { isStyledComponent, keyframes } from "styled-components";
import { OverlayTrigger, Tooltip } from "react-bootstrap";
import Big from "big.js";
import * as elliptic from "elliptic";
import BN from "bn.js";
import * as nacl from "tweetnacl";
import SecureIframe from "../components/SecureIframe";

import { CohortEl } from "../components/graphs/CohortEl";
import { BarEl } from "../components/graphs/BarEl";
import { ChartEl } from "../components/graphs/ChartEl";
import { PieEl } from "../components/graphs/PieEl";

import { ScatterEl } from "../components/graphs/ScatterEl";
import { BubbleEl } from "../components/graphs/BubbleEl";

import { LineEl } from "../components/graphs/LineEl";

import { ReactChart } from "../components/react_chart/main";

import { BasicTable } from "../components/tables/BasicTable";

const frozenNacl = Object.freeze({
  randomBytes: deepFreeze(nacl.randomBytes),
  secretbox: deepFreeze(nacl.secretbox),
  scalarMult: deepFreeze(nacl.scalarMult),
  box: deepFreeze(nacl.box),
  sign: deepFreeze(nacl.sign),
  hash: deepFreeze(nacl.hash),
  verify: deepFreeze(nacl.verify),
});

const frozenElliptic = Object.freeze({
  version: deepFreeze(elliptic.version),
  utils: deepFreeze(elliptic.utils),
  curve: deepFreeze(elliptic.curve),
  curves: deepFreeze(elliptic.curves),
  ec: Object.freeze(elliptic.ec),
  eddsa: Object.freeze(elliptic.eddsa),
});

const LoopLimit = 1000000;
const MaxDepth = 32;

const StakeKey = "state";

const ExpressionDebug = false;
const StatementDebug = false;

const MAX_INTERVALS = 16;

const StorageType = {
  Private: "private",
  Public: "public",
};

const ApprovedTagsSimple = {
  em: true,
  nav: true,
  h1: true,
  h2: true,
  h3: true,
  h4: true,
  h5: true,
  h6: true,
  div: true,
  span: true,
  strong: true,
  sub: true,
  sup: true,
  pre: true,
  i: true,
  b: true,
  p: true,
  input: true,
  button: true,
  ul: true,
  ol: true,
  li: true,
  table: true,
  tr: true,
  th: true,
  td: true,
  thead: true,
  tbody: true,
  tfoot: true,
  br: false,
  hr: false,
  img: false,
  textarea: true,
  select: true,
  option: true,
  label: true,
  small: true,
  // svg begin
  svg: true,
  animate: false,
  animateMotion: false,
  animateTransform: false,
  defs: true,
  circle: true,
  clipPath: true,
  ellipse: true,
  g: true,
  image: false,
  line: true,
  linearGradient: true,
  marker: true,
  mask: true,
  mpath: false,
  path: true,
  pattern: true,
  polyline: true,
  radialGradient: true,
  rect: true,
  set: false,
  stop: false,
  symbol: true,
  text: true,
  textPath: true,
  tspan: true,
  use: false,
  // svg ends
  a: true,
};

const ApprovedTagsCustom = {
  Widget: false,
  CommitButton: true,
  IpfsImageUpload: false,
  Markdown: false,
  Fragment: true,
  InfiniteScroll: true,
  Typeahead: false,
  Tooltip: true,
  OverlayTrigger: true,
  Files: true,
  iframe: false,
  BarEl: true,
  CohortEl: true,
  ChartEl: true,
  BasicTable: true,
  RTable: true,
  PieEl: true,
  ScatterEl: true,
  BubbleEl: true,
  LineEl: true,
  ReactChart: true,

};

const ApprovedTags = {
  ...ApprovedTagsSimple,
  ...ApprovedTagsCustom,
};

const Keywords = {
  JSON: true,
  Social: true,
  Storage: true,
  Near: true,
  State: true,
  console: true,
  styled: true,
  Object: true,
  Date,
  Number,
  Big,
  Math,
  Buffer,
  Audio,
  Image,
  File,
  Blob,
  FileReader,
  URL,
  Array,
  BN,
  Uint8Array,
  Map,
  Set,
  clipboard: true,
};

const ReservedKeys = {
  [ReactKey]: true,
  constructor: true,
  prototype: true,
  __proto__: true,
  __defineGetter__: true,
  __defineSetter__: true,
  __lookupGetter__: true,
  __lookupSetter__: true,
};

const assertNotReservedKey = (key) => {
  if (ReservedKeys[key] === true) {
    throw new Error(`${key} is reserved and can't be used`);
  }
};

const assertNotReactObject = (o) => {
  if (isReactObject(o)) {
    throw new Error("React objects shouldn't dereferenced");
  }
};

const assertValidObject = (o) => {
  if (o !== null && typeof o === "object") {
    Object.entries(o).forEach(([key, value]) => {
      assertNotReservedKey(key);
      assertValidObject(value);
    });
  }
};

const maybeSubscribe = (subscribe, blockId) =>
  subscribe &&
  (blockId === undefined ||
    blockId === null ||
    blockId === "final" ||
    blockId === "optimistic");

const requireIdentifier = (id) => {
  if (id.type !== "Identifier") {
    throw new Error("Non identifier: " + id.type);
  }
  const name = id.name;
  assertNotReservedKey(name);
  if (name in Keywords) {
    throw new Error("Cannot use keyword: " + name);
  }
  return {
    type: "Identifier",
    name,
  };
};

const requireJSXIdentifier = (id) => {
  if (id.type !== "JSXIdentifier") {
    throw new Error("Non JSXIdentifier: " + id.type);
  }
  return id.name;
};

const requirePattern = (id) => {
  if (id.type === "Identifier") {
    return requireIdentifier(id);
  } else if (id.type === "ArrayPattern") {
    return {
      type: "ArrayPattern",
      elements: id.elements.map(requirePattern),
    };
  } else if (id.type === "ObjectPattern") {
    return {
      type: "ObjectPattern",
      properties: id.properties.map((p) => {
        if (p.type === "Property") {
          return {
            key: requireIdentifier(p.key),
            value: requirePattern(p.value),
          };
        } else if (p.type === "RestElement") {
          return {
            type: "RestElement",
            argument: requireIdentifier(p.argument),
          };
        } else {
          throw new Error("Unknown property type: " + p.type);
        }
      }),
    };
  } else if (id.type === "RestElement") {
    return {
      type: "RestElement",
      argument: requireIdentifier(id.argument),
    };
  } else {
    throw new Error("Unknown pattern: " + id.type);
  }
};

class Stack {
  constructor(prevStack, state) {
    this.prevStack = prevStack;
    this.state = state;
  }

  findObj(name) {
    if (name in this.state) {
      return this.state;
    }
    return this.prevStack ? this.prevStack.findObj(name) : undefined;
  }

  get(name) {
    if (name in this.state) {
      return this.state[name];
    }
    return this.prevStack ? this.prevStack.get(name) : undefined;
  }
}

class VmStack {
  constructor(vm, prevStack, state, isTrusted) {
    this.gIndex = 0;
    this.vm = vm;
    this.isTrusted = !!isTrusted;
    this.stack = new Stack(prevStack, state);
  }

  newStack(isTrusted) {
    return new VmStack(this.vm, this.stack, {}, this.isTrusted || !!isTrusted);
  }

  executeExpression(code) {
    ExpressionDebug && console.log("Executing code:", code?.type);
    const res = this.executeExpressionInternal(code);
    ExpressionDebug && console.log(code?.type, res);
    return res;
  }

  renderElement(code) {
    let element =
      code.type === "JSXFragment"
        ? "Fragment"
        : requireJSXIdentifier(code.openingElement.name);

    let withChildren = ApprovedTags[element];
    const styledComponent =
      withChildren === undefined && this.stack.get(element);
    if (withChildren === undefined) {
      if (styledComponent === undefined) {
        throw new Error("Unknown element: " + element);
      }
      if (!isStyledComponent(styledComponent)) {
        throw new Error("Not a styled component: " + element);
      }
    }

    const attributes = {};
    const status = {};
    if (element === "input") {
      attributes.className = "form-control";
    } else if (element === "CommitButton") {
      attributes.className = "btn btn-success";
    } else if (element === "button") {
      attributes.className = "btn btn-primary";
    } else if (element === "IpfsImageUpload") {
      attributes.className = "btn btn-outline-primary";
    }

    const rawAttributes = {};

    (code.type === "JSXFragment"
      ? code.openingFragment
      : code.openingElement
    ).attributes.forEach((attribute) => {
      if (attribute.type === "JSXAttribute") {
        const name = requireJSXIdentifier(attribute.name);
        attributes[name] =
          attribute.value === null
            ? true
            : this.executeExpression(attribute.value);
        if (name === "value" || name === "image" || name === "onChange") {
          rawAttributes[name] = attribute.value;
        }
      } else if (attribute.type === "JSXSpreadAttribute") {
        const value = this.executeExpression(attribute.argument);
        Object.assign(attributes, value);
      } else {
        throw new Error("Unknown attribute type: " + attribute.type);
      }
    });

    Object.entries(rawAttributes).forEach(([name, value]) => {
      if (
        name === "value" &&
        element === "input" &&
        attributes.type === "text" &&
        value.type === "JSXExpressionContainer" &&
        !("onChange" in rawAttributes)
      ) {
        const { obj, key } = this.resolveMemberExpression(value.expression, {
          requireState: true,
          left: true,
        });
        attributes.value = obj?.[key] || "";
        attributes.onChange = (e) => {
          e.preventDefault();
          obj[key] = e.target.value;
          this.vm.setReactState(this.vm.state.state);
        };
      } else if (
        name === "image" &&
        element === "IpfsImageUpload" &&
        value.type === "JSXExpressionContainer"
      ) {
        const { obj, key } = this.resolveMemberExpression(value.expression, {
          requireState: true,
          left: true,
        });
        status.img = obj[key];
        attributes.onChange = (files) => {
          if (files?.length > 0) {
            obj[key] = {
              uploading: true,
              cid: null,
            };
            this.vm.setReactState(this.vm.state.state);
            ipfsUpload(files[0]).then((cid) => {
              if (!this.vm.alive) {
                return;
              }
              const { obj, key } = this.vm.vmStack.resolveMemberExpression(
                value.expression,
                {
                  requireState: true,
                  left: true,
                }
              );
              obj[key] = {
                cid,
              };
              this.vm.setReactState(this.vm.state.state);
            });
          } else {
            obj[key] = null;
            this.vm.setReactState(this.vm.state.state);
          }
        };
      }
    });
    attributes.key =
      attributes.key ?? `${this.vm.widgetSrc}-${element}-${this.vm.gIndex}`;
    delete attributes.dangerouslySetInnerHTML;
    const basicElement = styledComponent?.target || element;

    if (attributes.as && !ApprovedTagsSimple[attributes.as]) {
      delete attributes.as;
    }
    if (attributes.forwardedAs && !ApprovedTagsSimple[attributes.forwardedAs]) {
      delete attributes.forwardedAs;
    }

    if (basicElement === "img") {
      attributes.alt = attributes.alt ?? "not defined";
    } else if (basicElement === "a") {
      if ("href" in attributes) {
        attributes.href = sanitizeUrl(attributes.href);
      }
    } else if (element === "Widget") {
      attributes.depth = this.vm.depth + 1;
      attributes.config = [attributes.config, ...this.vm.widgetConfigs].filter(
        Boolean
      );
    }

    if (withChildren === false && code.children.length) {
      throw new Error(
        "And element '" + element + "' contains children, but shouldn't"
      );
    }

    const children = code.children.map((child, i) => {
      this.vm.gIndex = i;
      return this.executeExpression(child);
    });

    if (element === "Widget") {
      return <Widget {...attributes} />;
    } else if (element === "CommitButton") {
      return (
        <CommitButton {...attributes} widgetSrc={this.vm.widgetSrc}>
          {children}
        </CommitButton>
      );
    } else if (element === "InfiniteScroll") {
      return <InfiniteScroll {...attributes}>{children}</InfiniteScroll>;
    } else if (element === "Tooltip") {
      return <Tooltip {...attributes}>{children}</Tooltip>;
    } else if (element === "OverlayTrigger") {
      return (
        <OverlayTrigger {...attributes}>
          {children.filter((c) => !isString(c) || !!c.trim())[0]}
        </OverlayTrigger>
      );
    } else if (element === "Typeahead") {
      return <Typeahead {...attributes} />;
    } else if (element === "Markdown") {
      return <Markdown {...attributes} />;
    } else if (element === "Fragment") {
      return <React.Fragment {...attributes}>{children}</React.Fragment>;
    } else if (element === "BarEl") {
      return <BarEl {...attributes} />;
    } else if (element === "CohortEl") {
      return <CohortEl {...attributes} />;
    }
    else if (element === "ChartEl") {
      return <ChartEl {...attributes} />;
    } else if (element === "ScatterEl") {
      return <ScatterEl {...attributes} />;
    } else if (element === "LineEl") {
      return <LineEl {...attributes} />;
    } else if (element === "BubbleEl") {
      return <BubbleEl {...attributes} />;
    } else if (element === "PieEl") {
      return <PieEl {...attributes} />;
    } else if (element === "BasicTable") {
      return <BasicTable {...attributes} />;
    } else if (element === "ReactChart") {
      return <ReactChart {...attributes} />;
    } else if (element === "IpfsImageUpload") {
      return (
        <div className="d-inline-block" key={attributes.key}>
          {status.img?.cid && (
            <div
              className="d-inline-block me-2 overflow-hidden align-middle"
              style={{ width: "2.5em", height: "2.5em" }}
            >
              <img
                className="rounded w-100 h-100"
                style={{ objectFit: "cover" }}
                src={ipfsUrl(status.img?.cid)}
                alt="upload preview"
              />
            </div>
          )}
          <Files
            multiple={false}
            accepts={["image/*"]}
            minFileSize={1}
            clickable
            {...attributes}
          >
            {status.img?.uploading ? (
              <>{Loading} Uploading</>
            ) : status.img?.cid ? (
              "Replace"
            ) : (
              "Upload an Image"
            )}
          </Files>
        </div>
      );
    } else if (element === "Files") {
      return <Files {...attributes}>{children}</Files>;
    } else if (element === "iframe") {
      return <SecureIframe {...attributes} />;
    } else if (styledComponent) {
      return React.createElement(
        styledComponent,
        { ...attributes },
        ...children
      );
    } else if (withChildren === true) {
      return React.createElement(element, { ...attributes }, ...children);
    } else if (withChildren === false) {
      return React.createElement(element, { ...attributes });
    } else {
      throw new Error("Unsupported element: " + element);
    }
  }

  resolveKey(code, computed) {
    const key =
      !computed && code.type === "Identifier"
        ? code.name
        : this.executeExpression(code);
    assertNotReservedKey(key);
    return key;
  }

  callFunction(keyword, callee, args, optional, isNew) {
    const keywordType = Keywords[keyword];
    if (keywordType === true || keywordType === undefined) {
      if (
        (keyword === "Social" && callee === "getr") ||
        callee === "socialGetr"
      ) {
        if (args.length < 1) {
          throw new Error("Missing argument 'keys' for Social.getr");
        }
        return this.vm.cachedSocialGet(args[0], true, args[1], args[2]);
      } else if (
        (keyword === "Social" && callee === "get") ||
        callee === "socialGet"
      ) {
        if (args.length < 1) {
          throw new Error("Missing argument 'keys' for Social.get");
        }
        return this.vm.cachedSocialGet(args[0], false, args[1], args[2]);
      } else if (keyword === "Social" && callee === "keys") {
        if (args.length < 1) {
          throw new Error("Missing argument 'keys' for Social.keys");
        }
        return this.vm.cachedSocialKeys(args[0], args[1], args[2]);
      } else if (keyword === "Social" && callee === "index") {
        if (args.length < 2) {
          throw new Error(
            "Missing argument 'action' and 'key` for Social.index"
          );
        }
        return this.vm.cachedIndex(args[0], args[1], args[2]);
      } else if (keyword === "Social" && callee === "set") {
        if (args.length < 1) {
          throw new Error("Missing argument 'data' for Social.set");
        }
        return this.vm.socialSet(args[0], args[1]);
      } else if (keyword === "Near" && callee === "view") {
        if (args.length < 2) {
          throw new Error(
            "Method: Near.view. Required arguments: 'contractName', 'methodName'. Optional: 'args', 'blockId/finality', 'subscribe'"
          );
        }
        const [contractName, methodName, viewArg, blockId, subscribe] = args;

        return this.vm.cachedNearView(
          contractName,
          methodName,
          viewArg,
          blockId,
          maybeSubscribe(subscribe, blockId)
        );
      } else if (keyword === "Near" && callee === "asyncView") {
        if (args.length < 2) {
          throw new Error(
            "Method: Near.asyncView. Required arguments: 'contractName', 'methodName'. Optional: 'args', 'blockId/finality'"
          );
        }
        return this.vm.asyncNearView(...args);
      } else if (keyword === "Near" && callee === "block") {
        const [blockId, subscribe] = args;
        return this.vm.cachedNearBlock(
          blockId,
          maybeSubscribe(subscribe, blockId)
        );
      } else if (keyword === "Near" && callee === "call") {
        if (args.length === 1) {
          if (isObject(args[0])) {
            return this.vm.confirmTransactions([args[0]]);
          } else if (isArray(args[0])) {
            return this.vm.confirmTransactions(args[0]);
          } else {
            throw new Error(
              "Method: Near.call. Required argument: 'tx/txs'. A single argument call requires an TX object or an array of TX objects."
            );
          }
        } else {
          if (args.length < 2 || args.length > 5) {
            throw new Error(
              "Method: Near.call. Required argument: 'contractName'. If the first argument is a string: 'methodName'. Optional: 'args', 'gas' (defaults to 300Tg), 'deposit' (defaults to 0)"
            );
          }

          return this.vm.confirmTransactions([
            {
              contractName: args[0],
              methodName: args[1],
              args: args[2] ?? {},
              gas: args[3],
              deposit: args[4],
            },
          ]);
        }
      } else if (callee === "fetch") {
        if (args.length < 1) {
          throw new Error(
            "Method: fetch. Required arguments: 'url'. Optional: 'options'"
          );
        }
        return this.vm.cachedFetch(...args);
      } else if (callee === "asyncFetch") {
        if (args.length < 1) {
          throw new Error(
            "Method: asyncFetch. Required arguments: 'url'. Optional: 'options'"
          );
        }
        return this.vm.asyncFetch(...args);
      } else if (callee === "useCache") {
        if (args.length < 2) {
          throw new Error(
            "Method: useCache. Required arguments: 'promiseGenerator', 'dataKey'. Optional: 'options'"
          );
        }
        if (!(args[0] instanceof Function)) {
          throw new Error(
            "Method: useCache. The first argument 'promiseGenerator' must be a function"
          );
        }
        return this.vm.useCache(...args);
      } else if (callee === "parseInt") {
        return parseInt(...args);
      } else if (callee === "parseFloat") {
        return parseFloat(...args);
      } else if (callee === "isNaN") {
        return isNaN(...args);
      } else if (callee === "setTimeout") {
        const [callback, timeout] = args;
        const timer = setTimeout(() => {
          if (!this.vm.alive) {
            return;
          }
          callback();
        }, timeout);
        this.vm.timeouts.add(timer);
        return timer;
      } else if (callee === "setInterval") {
        if (this.vm.intervals.size >= MAX_INTERVALS) {
          throw new Error(`Too many intervals. Max allowed: ${MAX_INTERVALS}`);
        }
        const [callback, timeout] = args;
        const timer = setInterval(() => {
          if (!this.vm.alive) {
            return;
          }
          callback();
        }, timeout);
        this.vm.intervals.add(timer);
        return timer;
      } else if (callee === "clearTimeout") {
        const timer = args[0];
        this.vm.timeouts.delete(timer);
        return clearTimeout(timer);
      } else if (callee === "clearInterval") {
        const timer = args[0];
        this.vm.intervals.delete(timer);
        return clearInterval(timer);
      } else if (
        (keyword === "JSON" && callee === "stringify") ||
        callee === "stringify"
      ) {
        if (args.length < 1) {
          throw new Error("Missing argument 'obj' for JSON.stringify");
        }
        assertNotReactObject(args[0]);
        return JSON.stringify(args[0], args[1], args[2]);
      } else if (keyword === "JSON" && callee === "parse") {
        if (args.length < 1) {
          throw new Error("Missing argument 's' for JSON.parse");
        }
        try {
          const obj = JSON.parse(args[0]);
          assertValidObject(obj);
          return obj;
        } catch (e) {
          return null;
        }
      } else if (keyword === "Object") {
        if (callee === "keys") {
          if (args.length < 1) {
            throw new Error("Missing argument 'obj' for Object.keys");
          }
          assertNotReactObject(args[0]);
          return Object.keys(args[0]);
        } else if (callee === "values") {
          if (args.length < 1) {
            throw new Error("Missing argument 'obj' for Object.values");
          }
          assertNotReactObject(args[0]);
          return Object.values(args[0]);
        } else if (callee === "entries") {
          if (args.length < 1) {
            throw new Error("Missing argument 'obj' for Object.entries");
          }
          assertNotReactObject(args[0]);
          return Object.entries(args[0]);
        } else if (callee === "assign") {
          args.forEach((arg) => assertNotReactObject(arg));
          const obj = Object.assign(...args);
          assertValidObject(obj);
          return obj;
        } else if (callee === "fromEntries") {
          const obj = Object.fromEntries(args[0]);
          assertValidObject(obj);
          return obj;
        }
      } else if (
        (keyword === "State" && callee === "init") ||
        callee === "initState"
      ) {
        if (args.length < 1) {
          throw new Error("Missing argument 'initialState' for State.init");
        }
        if (
          args[0] === null ||
          typeof args[0] !== "object" ||
          isReactObject(args[0])
        ) {
          throw new Error("'initialState' is not an object");
        }
        if (this.vm.state.state === undefined) {
          const newState = args[0];
          this.vm.state.state = newState;
          this.vm.setReactState(newState);
        }
        return this.vm.state.state;
      } else if (keyword === "State" && callee === "update") {
        if (isObject(args[0])) {
          this.vm.state.state = this.vm.state.state ?? {};
          Object.assign(this.vm.state.state, deepCopy(args[0]));
        } else if (args[0] instanceof Function) {
          this.vm.state.state = this.vm.state.state ?? {};
          this.vm.state.state = args[0](this.vm.state.state);
        }
        if (this.vm.state.state === undefined) {
          throw new Error("The state was not initialized");
        }
        this.vm.setReactState(this.vm.state.state);
        return this.vm.state.state;
      } else if (keyword === "Storage" && callee === "privateSet") {
        if (args.length < 2) {
          throw new Error(
            "Missing argument 'key' or 'value' for Storage.privateSet"
          );
        }
        return this.vm.storageSet(
          {
            src: this.vm.widgetSrc,
            type: StorageType.Private,
          },
          args[0],
          args[1]
        );
      } else if (keyword === "Storage" && callee === "privateGet") {
        if (args.length < 1) {
          throw new Error("Missing argument 'key' for Storage.privateGet");
        }
        return this.vm.storageGet(
          {
            src: this.vm.widgetSrc,
            type: StorageType.Private,
          },
          args[0]
        );
      } else if (keyword === "Storage" && callee === "set") {
        if (args.length < 2) {
          throw new Error("Missing argument 'key' or 'value' for Storage.set");
        }
        return this.vm.storageSet(
          {
            src: this.vm.widgetSrc,
            type: StorageType.Public,
          },
          args[0],
          args[1]
        );
      } else if (keyword === "Storage" && callee === "get") {
        if (args.length < 1) {
          throw new Error("Missing argument 'key' for Storage.get");
        }
        return this.vm.storageGet(
          {
            src: args[1] ?? this.vm.widgetSrc,
            type: StorageType.Public,
          },
          args[0]
        );
      } else if (keyword === "console" && callee === "log") {
        return console.log(this.vm.widgetSrc, ...args);
      } else if (keyword === "clipboard" && callee === "writeText") {
        return this.isTrusted
          ? navigator.clipboard.writeText(...args)
          : Promise.reject(new Error("Not trusted (not a click)"));
      }
    } else {
      const f = callee === keyword ? keywordType : keywordType[callee];
      if (typeof f === "function") {
        return isNew ? new f(...args) : f(...args);
      }
    }

    if (optional) {
      return undefined;
    }

    throw new Error(
      keyword && keyword !== callee
        ? `Unsupported callee method '${keyword}.${callee}'`
        : `Unsupported callee method '${callee}'`
    );
  }

  /// Resolves the underlying object and the key to modify.
  /// Should only be used by left hand expressions for assignments.
  /// Options:
  /// - requireState requires the top object key be `state`
  resolveMemberExpression(code, options) {
    if (code.type === "Identifier") {
      const key = code.name;
      assertNotReservedKey(key);
      if (options?.requireState && key !== StakeKey) {
        throw new Error(`The top object should be ${StakeKey}`);
      }
      const obj = this.stack.findObj(key) ?? this.stack.state;
      assertNotReactObject(obj);
      if (obj === this.stack.state) {
        if (key in Keywords) {
          if (options?.left) {
            throw new Error("Cannot assign to keyword '" + key + "'");
          }
          return { obj, key, keyword: key };
        }
      }
      if (options?.left) {
        if (!obj || !(key in obj)) {
          throw new Error(`Accessing undeclared identifier '${code.name}'`);
        }
      }
      return { obj, key };
    } else if (code.type === "MemberExpression") {
      if (code.object?.type === "Identifier") {
        const keyword = code.object.name;
        if (keyword in Keywords) {
          if (!options?.callee) {
            throw new Error(
              "Cannot dereference keyword '" +
                keyword +
                "' in non-call expression"
            );
          }
          return {
            obj: this.stack.state,
            key: this.resolveKey(code.property, code.computed),
            keyword,
          };
        }
      }
      const obj = this.executeExpression(code.object);
      assertNotReactObject(obj);
      const key = this.resolveKey(code.property, code.computed);
      return { obj, key };
    } else {
      throw new Error("Unsupported member type: '" + code.type + "'");
    }
  }

  getArray(elements) {
    const result = [];
    elements.forEach((element) => {
      if (element.type === "SpreadElement") {
        result.push(...this.executeExpression(element.argument));
      } else {
        result.push(this.executeExpression(element));
      }
    });
    return result;
  }

  executeExpressionInternal(code) {
    if (!code) {
      return null;
    }
    const type = code?.type;
    if (type === "AssignmentExpression") {
      const { obj, key } = this.resolveMemberExpression(code.left, {
        left: true,
      });
      const right = this.executeExpression(code.right);

      if (code.operator === "=") {
        return (obj[key] = right);
      } else if (code.operator === "+=") {
        return (obj[key] += right);
      } else if (code.operator === "-=") {
        return (obj[key] -= right);
      } else if (code.operator === "*=") {
        return (obj[key] *= right);
      } else if (code.operator === "/=") {
        return (obj[key] /= right);
      } else if (code.operator === "??=") {
        return (obj[key] ??= right);
      } else {
        throw new Error(
          "Unknown AssignmentExpression operator '" + code.operator + "'"
        );
      }
    } else if (type === "ChainExpression") {
      return this.executeExpression(code.expression);
    } else if (type === "MemberExpression") {
      const { obj, key } = this.resolveMemberExpression(code);
      return obj?.[key];
    } else if (type === "Identifier") {
      return this.stack.get(code.name);
    } else if (type === "JSXExpressionContainer") {
      return this.executeExpression(code.expression);
    } else if (type === "TemplateLiteral") {
      const quasis = [];
      for (let i = 0; i < code.quasis.length; i++) {
        const element = code.quasis[i];
        if (element.type !== "TemplateElement") {
          throw new Error("Unknown quasis type: " + element.type);
        }
        quasis.push(element.value.cooked);
        if (!element.tail) {
          quasis.push(this.executeExpression(code.expressions[i]));
        }
      }
      return quasis.join("");
    } else if (type === "CallExpression" || type === "NewExpression") {
      const isNew = type === "NewExpression";
      const { obj, key, keyword } = this.resolveMemberExpression(code.callee, {
        callee: true,
      });
      const args = this.getArray(code.arguments);
      if (!keyword && obj?.[key] instanceof Function) {
        return isNew ? new obj[key](...args) : obj[key](...args);
      } else if (keyword || obj === this.stack.state || obj === this.vm.state) {
        return this.callFunction(
          keyword ?? "",
          key,
          args,
          code.optional,
          isNew
        );
      } else {
        if (code.optional) {
          return undefined;
        }
        throw new Error("Not a function call expression");
      }
    } else if (type === "Literal" || type === "JSXText") {
      return code.value;
    } else if (type === "JSXElement" || type === "JSXFragment") {
      return this.renderElement(code);
    } else if (type === "JSXExpressionContainer") {
      return this.executeExpression(code.expression);
    } else if (type === "BinaryExpression") {
      const left = this.executeExpression(code.left);
      const right = this.executeExpression(code.right);
      if (code.operator === "+") {
        return left + right;
      } else if (code.operator === "-") {
        return left - right;
      } else if (code.operator === "%") {
        return left % right;
      } else if (code.operator === "*") {
        return left * right;
      } else if (code.operator === "/") {
        return left / right;
      } else if (code.operator === "<") {
        return left < right;
      } else if (code.operator === "|") {
        return left | right;
      } else if (code.operator === "&") {
        return left & right;
      } else if (code.operator === ">") {
        return left > right;
      } else if (code.operator === "<=") {
        return left <= right;
      } else if (code.operator === ">=") {
        return left >= right;
      } else if (code.operator === "===" || code.operator === "==") {
        return left === right;
      } else if (code.operator === "!==" || code.operator === "!=") {
        return left !== right;
      } else if (code.operator === "in") {
        return left in right;
      } else {
        throw new Error(
          "Unknown BinaryExpression operator '" + code.operator + "'"
        );
      }
    } else if (type === "UnaryExpression") {
      if (code.operator === "delete") {
        const { obj, key } = this.resolveMemberExpression(code.argument, {
          left: true,
        });
        return delete obj?.[key];
      }
      const argument = this.executeExpression(code.argument);
      if (code.operator === "-") {
        return -argument;
      } else if (code.operator === "!") {
        return !argument;
      } else if (code.operator === "typeof") {
        return typeof argument;
      } else {
        throw new Error(
          "Unknown UnaryExpression operator '" + code.operator + "'"
        );
      }
    } else if (type === "LogicalExpression") {
      const left = this.executeExpression(code.left);
      if (code.operator === "||") {
        return left || this.executeExpression(code.right);
      } else if (code.operator === "&&") {
        return left && this.executeExpression(code.right);
      } else if (code.operator === "??") {
        return left ?? this.executeExpression(code.right);
      } else {
        throw new Error(
          "Unknown LogicalExpression operator '" + code.operator + "'"
        );
      }
    } else if (type === "ConditionalExpression") {
      const test = this.executeExpression(code.test);
      return test
        ? this.executeExpression(code.consequent)
        : this.executeExpression(code.alternate);
    } else if (type === "UpdateExpression") {
      const { obj, key } = this.resolveMemberExpression(code.argument, {
        left: true,
      });
      if (code.operator === "++") {
        return code.prefix ? ++obj[key] : obj[key]++;
      } else if (code.operator === "--") {
        return code.prefix ? --obj[key] : obj[key]--;
      } else {
        throw new Error(
          "Unknown UpdateExpression operator '" + code.operator + "'"
        );
      }
    } else if (type === "ObjectExpression") {
      return code.properties.reduce((object, property) => {
        if (property.type === "Property") {
          const key = this.resolveKey(property.key, property.computed);
          object[key] = this.executeExpression(property.value);
        } else if (property.type === "SpreadElement") {
          const value = this.executeExpression(property.argument);
          assertNotReactObject(value);
          Object.assign(object, value);
        } else {
          throw new Error("Unknown property type: " + property.type);
        }
        return object;
      }, {});
    } else if (type === "ArrayExpression") {
      return this.getArray(code.elements);
    } else if (type === "JSXEmptyExpression") {
      return null;
    } else if (type === "ArrowFunctionExpression") {
      return this.createFunction(code.params, code.body, code.expression);
    } else if (type === "TaggedTemplateExpression") {
      // Currently on `styled` component is supported.

      let styledTemplate, styledKey;

      if (
        code.tag.type === "MemberExpression" ||
        code.tag.type === "CallExpression"
      ) {
        const { key, keyword } = this.resolveMemberExpression(
          code.tag.type === "MemberExpression" ? code.tag : code.tag.callee,
          {
            callee: true,
          }
        );
        if (keyword !== "styled") {
          throw new Error(
            "TaggedTemplateExpression is only supported for `styled` components"
          );
        }

        if (code.tag.type === "CallExpression") {
          const args = this.getArray(code.tag.arguments);
          const arg = args?.[0];
          if (!isStyledComponent(arg)) {
            throw new Error("styled() can only take `styled` components");
          }
          styledTemplate = styled(arg);
        } else {
          if (key === "keyframes") {
            styledTemplate = keyframes;
          } else if (key in ApprovedTagsSimple) {
            styledTemplate = styled(key);
          } else {
            throw new Error("Unsupported styled tag: " + key);
          }
          styledKey = key;
        }
      } else {
        throw new Error(
          "TaggedTemplateExpression is only supported for `styled` components"
        );
      }

      if (code.quasi.type !== "TemplateLiteral") {
        throw new Error("Unknown quasi type: " + code.quasi.type);
      }
      const quasis = code.quasi.quasis.map((element) => {
        if (element.type !== "TemplateElement") {
          throw new Error("Unknown quasis type: " + element.type);
        }
        return element.value.cooked;
      });

      const canCache =
        code.quasi.expressions.length === 0 &&
        code.tag.type !== "CallExpression";

      const cacheKey = JSON.stringify([styledKey, ...quasis]);

      if (canCache && this.vm.cachedStyledComponents.has(cacheKey)) {
        return this.vm.cachedStyledComponents.get(cacheKey);
      }

      const expressions = code.quasi.expressions.map((expression) =>
        this.executeExpression(expression)
      );

      if (styledTemplate instanceof Function) {
        const result = styledTemplate(quasis, ...expressions);
        if (canCache) {
          this.vm.cachedStyledComponents.set(cacheKey, result);
        }
        return result;
      } else {
        throw new Error("styled error");
      }
    } else {
      throw new Error("Unknown expression type '" + type + "'");
    }
  }

  createFunction(params, body, isExpression) {
    params = params.map(requirePattern);
    return (...args) => {
      if (!this.vm.alive) {
        return;
      }
      const isTrusted = !!(
        args?.[0]?.nativeEvent instanceof Event &&
        args?.[0]?.nativeEvent.isTrusted
      );
      const stack = this.newStack(isTrusted);
      params.forEach((param, i) => {
        let v = undefined;
        let arg = args?.[i];
        if (arg !== undefined) {
          try {
            if (arg?.nativeEvent instanceof Event) {
              arg.preventDefault();
              arg = arg.nativeEvent;
              arg = {
                target: {
                  value: arg?.target?.value,
                  id: arg?.target?.id,
                  dataset: arg?.target?.dataset,
                  href: arg?.target?.href,
                  checked: arg?.target?.checked,
                },
                data: arg?.data,
                code: arg?.code,
                key: arg?.key,
                ctrlKey: arg?.ctrlKey,
                altKey: arg?.altKey,
                shiftKey: arg?.shiftKey,
                metaKey: arg?.metaKey,
                button: arg?.button,
                buttons: arg?.buttons,
                clientX: arg?.clientX,
                clientY: arg?.clientY,
                screenX: arg?.screenX,
                screenY: arg?.screenY,
                touches: arg?.touches,
              };
            }
            v = deepCopy(arg);
          } catch (e) {
            console.warn(e);
          }
        }
        stack.stackDeclare(param, v);
      });
      return isExpression
        ? stack.executeExpression(body)
        : stack.executeStatement(body)?.["result"];
    };
  }

  stackDeclare(pattern, value) {
    if (pattern.type === "Identifier") {
      this.stack.state[pattern.name] = value;
    } else if (pattern.type === "ArrayPattern") {
      assertNotReactObject(value);
      pattern.elements.forEach((element, i) => {
        if (element.type === "RestElement") {
          this.stackDeclare(element.argument, value.slice(i));
        } else {
          this.stackDeclare(element, value?.[i]);
        }
      });
    } else if (pattern.type === "ObjectPattern") {
      assertNotReactObject(value);
      const seen = new Set();
      pattern.properties.forEach((property) => {
        if (property.type === "RestElement") {
          const rest = {};
          if (isObject(value)) {
            Object.assign(rest, value);
            seen.forEach((key) => delete rest[key]);
          }
          this.stackDeclare(property.argument, rest);
        } else {
          this.stackDeclare(property.value, value?.[property.key.name]);
          seen.add(property.key.name);
        }
      });
    } else {
      throw new Error("Unknown pattern type: " + pattern.type);
    }
  }

  executeStatement(token) {
    StatementDebug && console.log(token);
    if (!token || token.type === "EmptyStatement") {
      return null;
    } else if (token.type === "VariableDeclaration") {
      token.declarations.forEach((declaration) => {
        if (declaration.type === "VariableDeclarator") {
          this.stackDeclare(
            requirePattern(declaration.id),
            this.executeExpression(declaration.init)
          );
        } else {
          throw new Error(
            "Unknown variable declaration type '" + declaration.type + "'"
          );
        }
      });
    } else if (token.type === "ReturnStatement") {
      return {
        result: this.executeExpression(token.argument),
      };
    } else if (token.type === "FunctionDeclaration") {
      this.stackDeclare(
        requireIdentifier(token.id),
        this.createFunction(token.params, token.body, token.expression)
      );
    } else if (token.type === "ExpressionStatement") {
      this.executeExpression(token.expression);
    } else if (token.type === "BlockStatement" || token.type === "Program") {
      const body = token.body;
      const stack = this.newStack();
      for (let i = 0; i < body.length; i++) {
        const result = stack.executeStatement(body[i]);
        if (result) {
          return result;
        }
      }
    } else if (token.type === "ForStatement") {
      const stack = this.newStack();
      stack.executeStatement(token.init);
      while (this.vm.loopLimit-- > 0) {
        if (token.test) {
          const test = stack.executeExpression(token.test);
          if (!test) {
            break;
          }
        }
        const result = stack.executeStatement(token.body);
        if (result) {
          if (result.break) {
            break;
          } else if (result.continue) {
            // continue
          } else {
            return result;
          }
        }
        stack.executeExpression(token.update);
      }
      if (this.vm.loopLimit <= 0) {
        throw new Error("Exceeded loop limit");
      }
    } else if (token.type === "ForOfStatement") {
      const stack = this.newStack();
      const right = stack.executeExpression(token.right);
      assertNotReactObject(right);
      for (const value of right) {
        if (this.vm.loopLimit-- <= 0) {
          throw new Error("Exceeded loop limit");
        }
        if (token.left.type === "VariableDeclaration") {
          if (token.left.declarations.length !== 1) {
            throw new Error("Invalid for-of statement");
          }
          token.left.declarations.forEach((declaration) => {
            if (declaration.type === "VariableDeclarator") {
              this.stackDeclare(requirePattern(declaration.id), value);
            } else {
              throw new Error(
                "Unknown variable declaration type '" + declaration.type + "'"
              );
            }
          });
        } else {
          const { obj, key } = this.resolveMemberExpression(token.left, {
            left: true,
          });
          obj[key] = value;
        }
        const result = stack.executeStatement(token.body);
        if (result) {
          if (result.break) {
            break;
          } else if (result.continue) {
            // continue
          } else {
            return result;
          }
        }
      }
    } else if (token.type === "WhileStatement") {
      const stack = this.newStack();
      while (this.vm.loopLimit-- > 0) {
        const test = stack.executeExpression(token.test);
        if (!test) {
          break;
        }
        const result = stack.executeStatement(token.body);
        if (result) {
          if (result.break) {
            break;
          } else if (result.continue) {
            // continue
          } else {
            return result;
          }
        }
      }
      if (this.vm.loopLimit <= 0) {
        throw new Error("Exceeded loop limit");
      }
    } else if (token.type === "IfStatement") {
      const test = this.executeExpression(token.test);
      const stack = this.newStack();
      const result = !!test
        ? stack.executeStatement(token.consequent)
        : stack.executeStatement(token.alternate);
      if (result) {
        return result;
      }
    } else if (token.type === "BreakStatement") {
      return {
        break: true,
      };
    } else if (token.type === "ContinueStatement") {
      return {
        continue: true,
      };
    } else if (token.type === "ThrowStatement") {
      throw this.executeExpression(token.argument);
    } else if (token.type === "TryStatement") {
      try {
        const stack = this.newStack();
        const result = stack.executeStatement(token.block);
        if (result) {
          return result;
        }
      } catch (e) {
        if (!this.vm.alive || !token.handler) {
          return null;
        }
        if (token.handler.type !== "CatchClause") {
          throw new Error(
            "Unknown try statement handler type '" + token.handler.type + "'"
          );
        }
        const stack = this.newStack();
        if (token.handler.param) {
          stack.stackDeclare(
            requireIdentifier(token.handler.param),
            deepCopy(
              e instanceof Error
                ? {
                    name: e?.name,
                    message: e?.message,
                    toString: () => e.toString(),
                  }
                : e
            )
          );
        }
        const result = stack.executeStatement(token.handler.body);
        if (result) {
          return result;
        }
      } finally {
        if (this.vm.alive) {
          const stack = this.newStack();
          stack.executeStatement(token.finalizer);
        }
      }
    } else if (token.type === "SwitchStatement") {
      const discriminant = this.executeExpression(token.discriminant);
      const stack = this.newStack();
      const cases = token.cases;
      let found = false;
      for (const caseToken of cases) {
        if (caseToken.type !== "SwitchCase") {
          throw new Error("Unknown switch case type '" + caseToken.type + "'");
        }
        if (!found && caseToken.test) {
          const test = stack.executeExpression(caseToken.test);
          if (test !== discriminant) {
            continue;
          }
          found = true;
        }
        if (found) {
          let isBreak = false;
          for (const statement of caseToken.consequent) {
            const result = stack.executeStatement(statement);
            if (result) {
              if (result.break) {
                isBreak = true;
                break;
              } else {
                return result;
              }
            }
          }
          if (isBreak) {
            break;
          }
        }
      }
    } else {
      throw new Error("Unknown token type '" + token.type + "'");
    }
    return null;
  }
}

export default class VM {
  constructor(options) {
    const {
      near,
      code,
      setReactState,
      cache,
      refreshCache,
      confirmTransactions,
      depth,
      widgetSrc,
      requestCommit,
      version,
      widgetConfigs,
    } = options;

    if (!code) {
      throw new Error("Not a program");
    }

    this.alive = true;

    this.near = near;
    this.code = code;
    this.setReactState = (s) => setReactState(deepCopy(s));
    this.cache = cache;
    this.refreshCache = refreshCache;
    this.confirmTransactions = confirmTransactions;
    this.depth = depth;
    this.widgetSrc = widgetSrc;
    this.requestCommit = requestCommit;
    this.version = version;
    this.cachedStyledComponents = new Map();
    this.widgetConfigs = widgetConfigs;

    this.timeouts = new Set();
    this.intervals = new Set();
  }

  stop() {
    this.alive = false;
    this.timeouts.forEach((timeout) => clearTimeout(timeout));
    this.intervals.forEach((interval) => clearInterval(interval));
  }

  cachedPromise(promise, subscribe) {
    const invalidate = {
      onInvalidate: () => {
        if (this.alive) {
          this.refreshCache();
        }
      },
      subscribe: !!subscribe,
    };
    return deepCopy(promise(invalidate));
  }

  cachedSocialGet(keys, recursive, blockId, options) {
    keys = Array.isArray(keys) ? keys : [keys];
    return this.cachedPromise(
      (invalidate) =>
        this.cache.socialGet(
          this.near,
          keys,
          recursive,
          blockId,
          options,
          invalidate
        ),
      options?.subscribe
    );
  }

  storageGet(domain, key) {
    return this.cachedPromise((invalidate) =>
      this.cache.localStorageGet(domain, key, invalidate)
    );
  }

  storageSet(domain, key, value) {
    return this.cache.localStorageSet(domain, key, value);
  }

  cachedSocialKeys(keys, blockId, options) {
    keys = Array.isArray(keys) ? keys : [keys];
    return this.cachedPromise(
      (invalidate) =>
        this.cache.cachedViewCall(
          this.near,
          this.near.config.contractName,
          "keys",
          {
            keys,
            options,
          },
          blockId,
          invalidate
        ),
      options?.subscribe
    );
  }

  asyncNearView(contractName, methodName, args, blockId) {
    return this.near.viewCall(contractName, methodName, args, blockId);
  }

  cachedNearView(contractName, methodName, args, blockId, subscribe) {
    return this.cachedPromise(
      (invalidate) =>
        this.cache.cachedViewCall(
          this.near,
          contractName,
          methodName,
          args,
          blockId,
          invalidate
        ),
      subscribe
    );
  }

  cachedNearBlock(blockId, subscribe) {
    return this.cachedPromise(
      (invalidate) => this.cache.cachedBlock(this.near, blockId, invalidate),
      subscribe
    );
  }

  asyncFetch(url, options) {
    return this.cache.asyncFetch(url, options);
  }

  cachedFetch(url, options) {
    return this.cachedPromise(
      (invalidate) => this.cache.cachedFetch(url, options, invalidate),
      options?.subscribe
    );
  }

  cachedIndex(action, key, options) {
    return this.cachedPromise(
      (invalidate) =>
        this.cache.socialIndex(this.near, action, key, options, invalidate),
      options?.subscribe
    );
  }

  useCache(promiseGenerator, dataKey, options) {
    return this.cachedPromise(
      (invalidate) =>
        this.cache.cachedCustomPromise(
          {
            widgetSrc: this.widgetSrc,
            dataKey,
          },
          promiseGenerator,
          invalidate
        ),
      options?.subscribe
    );
  }

  socialSet(data, options) {
    return this.requestCommit({
      data,
      force: options?.force,
      onCommit: options?.onCommit,
      onCancel: options?.onCancel,
    });
  }

  renderCode({ props, context, state }) {
    if (this.depth >= MaxDepth) {
      return "Too deep";
    }
    this.gIndex = 0;
    this.state = {
      props: deepCopy(props),
      context,
      state: deepCopy(state),
      nacl: frozenNacl,
      elliptic: frozenElliptic,
    };
    this.loopLimit = LoopLimit;
    this.vmStack = new VmStack(this, undefined, this.state);
    const executionResult = this.vmStack.executeStatement(this.code);
    if (executionResult?.break) {
      throw new Error("BreakStatement outside of a loop");
    }
    if (executionResult?.continue) {
      throw new Error("ContinueStatement outside of a loop");
    }
    const result = executionResult?.result;

    return isReactObject(result) ||
      typeof result === "string" ||
      typeof result === "number" ? (
      result
    ) : (
      <pre>{JSON.stringify(result, undefined, 2)}</pre>
    );
  }
}

'''
'''--- src/styles/global.css ---
@import 'tailwindcss/base';
@import 'tailwindcss/components';
@import 'tailwindcss/utilities';
'''
'''--- tailwind.config.js ---
/** @type {import('tailwindcss').Config} */

module.exports = {
  darkMode: 'class',
  content: [
    "./src/**/*.{js,jsx,ts,tsx}",
  ],
  theme: {
    extend: {
      fontFamily: {
        sans: [
          'ui-sans-serif',
          'system-ui',
          'sans-serif',
          '"Apple Color Emoji"',
          '"Segoe UI Emoji"',
          '"Segoe UI Symbol"',
          '"Noto Color Emoji"',
        ],
        serif: ['ui-serif', 'Georgia', 'Cambria', '"Times New Roman"', 'Times', 'serif'],
        mono: [
          'ui-monospace',
          'SFMono-Regular',
          'Menlo',
          'Monaco',
          'Consolas',
          '"Liberation Mono"',
          '"Courier New"',
          'monospace',
        ],
      },
    },
  },
  plugins: [
    require('@tailwindcss/forms'),

    ],
}

'''
'''--- webpack.config.js ---
const webpack = require("webpack");
const paths = require("./config/paths");
const path = require("path");
const { CleanWebpackPlugin } = require("clean-webpack-plugin");
const { merge } = require("webpack-merge");
const loadPreset = require("./config/presets/loadPreset");
const loadConfig = (mode) => require(`./config/webpack.${mode}.js`)(mode);
const nodeExternals = require("webpack-node-externals");

module.exports = function (env) {
  const { mode = "production" } = env || {};
  return merge(
    {
      mode,
      entry: `${paths.srcPath}/index.js`,
      output: {
        path: paths.distPath,
        filename: "index.js",
        libraryTarget: "umd",
      },
      externals: [
        nodeExternals(),
        {
          react: {
            commonjs: "react",
            commonjs2: "react",
            amd: "react",
            root: "React",
          },
          "react-dom": {
            commonjs: "react-dom",
            commonjs2: "react-dom",
            amd: "react-dom",
            root: "ReactDOM",
          },
        },
      ],
      module: {
        rules: [
          {
            test: /\.m?js/,
            resolve: {
              fullySpecified: false,
            },
          },
          {
            test: /\.js$/,
            use: ["babel-loader"],
            exclude: path.resolve(__dirname, "node_modules"),
          },
          // Images: Copy image files to build folder
          { test: /\.(?:ico|gif|png|jpg|jpeg)$/i, type: "asset/resource" },

          // Fonts and SVGs: Inline files
          { test: /\.(woff(2)?|eot|ttf|otf|svg|)$/, type: "asset/inline" },
        ],
      },
      resolve: {
        modules: [paths.srcPath, "node_modules"],
        extensions: [".js", ".jsx", ".json"],
        fallback: {
          crypto: require.resolve("crypto-browserify"),
          stream: require.resolve("stream-browserify"),
        },
      },
      target: "node",
      plugins: [
        // new webpack.EnvironmentPlugin({
        //   // Configure environment variables here.
        //   ENVIRONMENT: "browser",
        // }),
        new CleanWebpackPlugin(),
        new webpack.ProgressPlugin(),
        new webpack.ProvidePlugin({
          process: "process/browser",
          Buffer: [require.resolve("buffer/"), "Buffer"],
        }),
      ],
    },
    loadConfig(mode),
    loadPreset(env)
  );
};

'''