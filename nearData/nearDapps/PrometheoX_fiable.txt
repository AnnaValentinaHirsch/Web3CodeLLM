*GitHub Repository "PrometheoX/fiable"*

'''--- README.md ---
ğŸ’» Fiable
==================

 Fiable es un smart contract para llevar a cabo licitaciones en blockchain. Cuenta con las siguientes funciones:
 
 1. Crear una licitaciÃ³n.
 2. Obtener una lista de las licitaciones creadas.
 3. Postular una cotizaciÃ³n.
 4. Cambiar el estado de una licitaciÃ³n de abierta a cerrada.
 5. Eliminar una licitaciÃ³n.
 6. Eliminar una cotizaciÃ³n.
 

ğŸ‘¨â€ğŸ’» InstalaciÃ³n en local
===========

Para correr este proyecto en local debes seguir los siguientes pasos:

Paso 1: Pre - Requisitos
------------------------------

1. AsegÃºrese de haber instalado [Node.js] â‰¥ 12 ((recomendamos usar [nvm])
2. AsegÃºrese de haber instalado yarn: `npm install -g yarn`
3. Instalar dependencias: `yarn install`
4. Crear un test near account [NEAR test account]
5. Instalar el NEAR CLI globally: [near-cli] es una interfaz de linea de comando (CLI) para interacturar con NEAR blockchain

    yarn install --global near-cli

Step 2: Configura tu NEAR CLI
-------------------------------

Configura tu near-cli para autorizar su cuenta de prueba creada recientemente:

    near login
    
Step 3: Clonar Repositorio
-------------------------------    

Este comando nos permite clonar el repositorio del proyecto

```bash
git clone https://github.com/PrometheoX/fiable.git
```

Una vez que hayas descargado el repositorio, asegurate de ejecutar los comandos dentro del repositorio descargado. Puedes hacerlo con
```bash
cd fiable
```

Step 4: Realiza el BUILD para implementaciÃ³n de desarrollo de contrato inteligente 
------------------------------------------------------------------------------------

Instale el gestor de dependencia de Node.js dentro del repositorio

```bash
npm install
```

Cree el cÃ³digo de contrato inteligente e implemente el servidor de desarrollo local: 
```bash
yarn deploy
```

Â¡Felicitaciones, ahora tendrÃ¡ un entorno de desarrollo local ejecutÃ¡ndose en NEAR TestNet!

âœï¸ Comando para CREAR una LICITACIÃ“N
-----------------------------------------------
Antes de ejecutar el comando brindado, modifica <your deployed contract> por el nÃºmero de contrato generado. Por ejemplo: 'dev-1630622185346-59088620194720'. AdemÃ¡s, modifica <username> por tu nombre de usuario en testnet. Por ejemplo: 'aval1'

Para Linux:
```bash
near call <your deployed contract> CrearLicitaciÃ³n '{"tÃ­tulo":"string","razÃ³n_social":"string","descripciÃ³n":"string","presupuesto_max":<number>,"anticipo":<number>,"fecha_cierre":"string"}' --account-id <username>.testnet
```

âœï¸ Comando que LISTA todas las LICITACIONES:
--------------------------------------------
Permite listar las licitaciones que existen en nuestro contrato inteligente. 

Para Linux:
```bash
near view <your deployed contract> MostrarLicitaciones --account-id <username>.testnet
```

âœï¸ Comando para CAMBIAR EL ESTADO de una LICITACIÃ“N
------------------------------------------------

Permite cambiar el estado de una licitaciÃ³n de "abierta" a "cerrada".

Para Linux:
```bash
near call <your deployed contract> CambiarEstado '{"id":1}' --account-id <username>.testnet
```

âœï¸ Comando para ELIMINAR una LICITACIÃ“N
--------------------------------------------

Para Linux:
```bash
near call <your deployed contract> BorrarLicitaciÃ³n '{"id":1}' --account-id <username>.testnet
``` 

âœï¸ Comando para POSTULAR una COTIZACIÃ“N
-----------------------------------------------
Permite postular una cotizaciÃ³n a una licitaciÃ³n especificando el id de esta.

Para Linux:
```bash
near call <your deployed contract> PostularCotizaciÃ³n '{"razÃ³n_social":"string","licitaciÃ³n_destino":<id de la licitaciÃ³n>,"precio_ofertado":<number>,"anticipo":<number>}' --account-id <username>.testnet
```

âœï¸ Comando que LISTA todas las COTIZACIONES:
--------------------------------------------
Esta funciÃ³n se encuentra actualmente bajo desarrollo.

 

ğŸ¤– Test 
==================

Las pruebas son parte del desarrollo, para ejecutar las pruebas en el contrato inteligente, debe ejecutar el siguiente comando:

    yarn test

Esto ejecutarÃ¡ los mÃ©todos de prueba en el `assembly/__tests__/example.spec.js` archivo

ğŸ‘©ğŸ¼â€ğŸ« Exploring and Explaining The Code 
====================================
This is a explanation of the smart contract file system

```bash
â”œâ”€â”€ README.md                                       # this file
â”œâ”€â”€ as-pect.config.js                               # configuration for as-pect (AssemblyScript unit testing)
â”œâ”€â”€ asconfig.json                                   # configuration file for Assemblyscript compiler
â”œâ”€â”€ assembly
â”‚   â”œâ”€â”€ __tests__
â”‚   â”‚   â”œâ”€â”€ as-pect.d.ts                            # as-pect unit testing headers for type hints
â”‚   â”‚   â””â”€â”€ main.spec.ts                            # unit test for the contract
â”‚   â”œâ”€â”€ as_types.d.ts                               # AssemblyScript headers for type hint
â”‚   â”œâ”€â”€ index.ts                                    # contains the smart contract code
â”‚   â”œâ”€â”€ models.ts                                   # contains code for the models accesible to the smart contract
â”‚   â””â”€â”€ tsconfig.json                               # Typescript configuration file
â”œâ”€â”€ neardev
â”‚   â”œâ”€â”€ dev-account                                 #in this file the provisional deploy smart contract account is saved
â”‚   â””â”€â”€ dev-account.env                             #in this file the provisional deploy smart contract account is saved like a environment variable                             
â”œâ”€â”€ out
â”‚   â””â”€â”€ main.wasm                                   # compiled smart contract code using to deploy
â”œâ”€â”€ package-lock.json                               # project manifest lock version
â”œâ”€â”€ package.json                                    # Node.js project manifest (scripts and dependencies)
â””â”€â”€ yarn.lock                                       # project manifest lock version
```
1. El cÃ³digo de contrato inteligente vive en la carpeta `/assambly` folder.
2. Para realizar una implementaciÃ³n de prueba, use los scripts en el `/package.json` file.

==============================================

[Propuesta de diseÃ±o]  Este mockup es una presentaciÃ³n con las diferentes pantallas de la app, para avanzar puede utilizar las flechas del teclado, hacer click en el slide o esperar 5 segundos a que avance automÃ¡ticamente.

  [create-near-app]: https://github.com/near/create-near-app
  [Node.js]: https://nodejs.org/en/download/package-manager/
  [NEAR accounts]: https://docs.near.org/docs/concepts/account
  [NEAR Wallet]: https://wallet.testnet.near.org/
  [near-cli]: https://github.com/near/near-cli
  [NEAR test account]: https://docs.near.org/docs/develop/basics/create-account#creating-a-testnet-account
  [nvm]: https://github.com/nvm-sh/nvm
  [Propuesta de diseÃ±o]: https://docs.google.com/presentation/d/e/2PACX-1vQo6i_5OxctyPXELi8aB6vI_PuFWW2hVWgI8M-b0ueAlzV01v1vJUXhcnLFWMFyVFWAjeGJWtWfxpDX/pub?start=true&loop=false&delayms=5000

'''
'''--- as-pect.config.js ---
module.exports = require("near-sdk-as/imports")
  
'''
'''--- asconfig.json ---
{
    "extends": "near-sdk-as/asconfig.json",
    "entry": "assembly/index.ts",
    "options": {
        "binaryFile": "out/main.wasm"
}
}
'''
'''--- assembly/__tests__/as-pect.d.ts ---
/// <reference types="@as-pect/assembly/types/as-pect" />

'''
'''--- assembly/__tests__/example.spec.ts ---
import { CrearLicitaciÃ³n} from "..";
import { Context } from "near-sdk-as";
import * as contract from '..';

/*Test para la funciÃ³n createProject*/
describe("Crea una licitaciÃ³n",()=>{
  it("Guarda la clase FormatoLicitaciÃ³n en un vector persistente con los valores definidos por el usuario", () => {
      expect(() => {
          contract.CrearLicitaciÃ³n("LicitaciÃ³n de servidores","razÃ³n_social","descripciÃ³n",5000,2500,"fecha_cierre");
      });
});
   it("deberÃ­a fallar si se introduce un nÃºmero en vez de un string en el tÃ­tulo", () => {
        expect(() => {
       //contract.CrearLicitaciÃ³n (3,"razÃ³n_social","descripciÃ³n",5000,2500,"fecha_cierre");
    }).not.toThrow();
});

 it("deberÃ­a fallar si el presupuesto es 0", () => {
        expect(() => {
       contract.CrearLicitaciÃ³n("LicitaciÃ³n de servidores","razÃ³n_social","descripciÃ³n",0,2500,"fecha_cierre");
    }).toThrow();
 });

})

'''
'''--- assembly/as_types.d.ts ---
/// <reference types="near-sdk-as/assembly/as_types" /> 
'''
'''--- assembly/index.ts ---
import { Context } from "near-sdk-as";
import { FormatoLicitaciÃ³n, licitaciones, FormatoCotizaciÃ³n, cotizaciones, Estado } from "./models";

export function CrearLicitaciÃ³n(
  tÃ­tulo: string,
    razÃ³n_social: string,
    descripciÃ³n: string,
    presupuesto_max: i32,
    anticipo: i32,
    fecha_cierre: string,
): void {
assert(tÃ­tulo.length>0,"Incluye un nombre para tu licitaciÃ³n")
assert(razÃ³n_social.length>0, "Incluye tu razÃ³n social")
assert(descripciÃ³n.length>0, "Incluye una descripciÃ³n donde especifiques todos los requisitos de tu adquisiciÃ³n: Tipo de equipo, modelo, marca, SKU, garantÃ­as, tiempos de entrega etc.")
assert(<i32>presupuesto_max>0, "Escribe tu presupuesto mÃ¡ximo para esta compra")
assert(<i32>anticipo>0, "Escribe el anticipo que ofreces como un nÃºmero")
assert(fecha_cierre.length>0 && fecha_cierre.length<11, "Incluye la fecha de cierre, mÃ¡ximo de 11 caracteres")

licitaciones.push(
  new FormatoLicitaciÃ³n(licitaciones.length, tÃ­tulo, razÃ³n_social, descripciÃ³n, presupuesto_max, anticipo, fecha_cierre)
  );
}

export function MostrarLicitaciones(): Array<FormatoLicitaciÃ³n> {
    const resultado_licitaciÃ³n = new Array<FormatoLicitaciÃ³n>(licitaciones.length);
    for (let i = 0; i < licitaciones.length; i++) {
      resultado_licitaciÃ³n[i] = licitaciones[i];
    }
    return resultado_licitaciÃ³n;
  }

 
  export function CambiarEstado(id: i32): FormatoLicitaciÃ³n {
    let licitaciÃ³n  = licitaciones[id]
    licitaciÃ³n.Estado = Estado.cerrada
    licitaciones.replace(<i32>id, licitaciÃ³n)
    return licitaciÃ³n
  }

  export function BorrarLicitaciÃ³n(id: i32): void {
    assert(id>=0,"No hay licitaciones con id negativo")
    licitaciones.swap_remove(<i32>id)
  }

  export function PostularCotizaciÃ³n(
      razÃ³n_social: string,
      licitaciÃ³n_destino: i32,
      precio_ofertado: i32,
      anticipo: i32,
  ): void {
  assert(razÃ³n_social.length>0, "Incluye tu razÃ³n social")
  assert(<i32>precio_ofertado>0, "Indica tu mejor precio para esta licitaciÃ³n")
  assert(<i32>anticipo>0, "Indica el anticipo mÃ­nimo que requieres")
  
  
  cotizaciones.push(
    new FormatoCotizaciÃ³n(cotizaciones.length, razÃ³n_social, licitaciÃ³n_destino, precio_ofertado, anticipo)
    );
  }

  export function MostrarCotizaciones(): Array<FormatoCotizaciÃ³n> {
    const resultado_cotizaciÃ³n = new Array<FormatoCotizaciÃ³n>(cotizaciones.length);
    for (let i = 0; i < cotizaciones.length; i++) {
      resultado_cotizaciÃ³n[i] = cotizaciones[i];
    }
    return resultado_cotizaciÃ³n;
  }  

  export function BorrarCotizaciÃ³n(id: i32): void {
    assert(id>=0,"No hay cotizaciones con id negativo")
    cotizaciones.swap_remove(<i32>id)
  }
'''
'''--- assembly/models.ts ---
import { Context, PersistentVector } from "near-sdk-as";

export enum Estado {
    abierta,
    cerrada,
  }

@nearBindgen
export class FormatoLicitaciÃ³n {
    id:u64
    tÃ­tulo: string;
    razÃ³n_social: string;
    descripciÃ³n: string;
    presupuesto_max: i32;
    anticipo: i32;
    fecha_cierre: string;
    Estado: Estado;

  constructor(
      id:u64,
      tÃ­tulo: string,
      razÃ³n_social: string,
      descripciÃ³n: string,
      presupuesto_max: i32,
      anticipo: i32,
      fecha_cierre: string
      ) {
    this.id = id; 
    this.tÃ­tulo = tÃ­tulo;
    this.razÃ³n_social = razÃ³n_social;
    this.descripciÃ³n = descripciÃ³n;
    this.presupuesto_max = presupuesto_max;
    this.anticipo = anticipo;
    this.fecha_cierre = fecha_cierre;
    this.Estado = Estado.abierta;
  }
}

export class FormatoCotizaciÃ³n {
  id:u64
  razÃ³n_social: string;
  licitaciÃ³n_destino: i32;
  precio_ofertado: i32;
  anticipo: i32;

constructor(
    id:u64,
    razÃ³n_social: string,
    licitaciÃ³n_destino: i32,
    precio_ofertado: i32,
    anticipo: i32,
    ) {
  this.id = id; 
  this.razÃ³n_social = razÃ³n_social;
  this.licitaciÃ³n_destino = licitaciÃ³n_destino;
  this.precio_ofertado = precio_ofertado;
  this.anticipo = anticipo;
}
}

/* STORAGE */
export let licitaciones = new PersistentVector<FormatoLicitaciÃ³n>("licitaciÃ³n")
export let cotizaciones = new PersistentVector<FormatoCotizaciÃ³n>("cotizaciÃ³n")
'''
'''--- assembly/tsconfig.json ---
{
"extends": "assemblyscript/std/assembly.json"
}
'''
'''--- neardev/dev-account.env ---
CONTRACT_NAME=dev-1630474769938-25898026952681
'''
'''--- package.json ---
{
  "name": "fiable_licitaciones",
  "version": "0.0.1",
  "license": "UNLICENSED",
  "description": "Smart contract para crear y listar licitaciones",
  "main": "index.js",
  "scripts": {
    "test": "asp",
    "build": "asb",
    "deploy": "yarn build && near dev-deploy"
  },
  
  "devDependencies": {
    "near-sdk-as": "^3.2.3"
  }
}

'''